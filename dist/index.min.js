!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.MicRecorder=t()}(this,function(){function e(e){var t=e.filter(function(e){return"audio"===e.kind}),a=e.filter(function(e){return"video"===e.kind});for(e=[];t.length||a.length;)t.length&&e.push(t.shift()),a.length&&e.push(a.shift());return e}function t(e,t){var a=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var n="string"==typeof r;return n&&(r=[r]),r=r.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!a?(a=!0,!0):0===e.indexOf("stun:")&&t>=14393}),delete e.url,e.urls=n?r[0]:r,!!r.length}return!1})}function a(e,t){var a={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var a=0;a<t.length;a++)if(t[a].payloadType===e||t[a].preferredPayloadType===e)return t[a]},n=function(e,t,a,n){var s=r(e.parameters.apt,a),i=r(t.parameters.apt,n);return s&&i&&s.name.toLowerCase()===i.name.toLowerCase()};return e.codecs.forEach(function(r){for(var s=0;s<t.codecs.length;s++){var i=t.codecs[s];if(r.name.toLowerCase()===i.name.toLowerCase()&&r.clockRate===i.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&i.parameters.apt&&!n(r,i,e.codecs,t.codecs))continue;(i=JSON.parse(JSON.stringify(i))).numChannels=Math.min(r.numChannels,i.numChannels),a.codecs.push(i),i.rtcpFeedback=i.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var n=t.headerExtensions[r];if(e.uri===n.uri){a.headerExtensions.push(n);break}}}),a}function r(e,t,a){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(a)}function n(e){return new Int16Array(e)}function s(e){return new Int32Array(e)}function i(e){return new Float32Array(e)}function o(e){if(1==e.length)return i(e[0]);var t=e[0];e=e.slice(1);for(var a=[],r=0;r<t;r++)a.push(o(e));return a}function l(e){if(1==e.length)return s(e[0]);var t=e[0];e=e.slice(1);for(var a=[],r=0;r<t;r++)a.push(l(e));return a}function c(e){if(1==e.length)return n(e[0]);var t=e[0];e=e.slice(1);for(var a=[],r=0;r<t;r++)a.push(c(e));return a}function _(e){if(1==e.length)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var a=[],r=0;r<t;r++)a.push(_(e));return a}function f(e){this.ordinal=e}function u(e){this.ordinal=e}function p(){function e(e){var t,a;if(0!=e.ATH.useAdjust)if(a=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(a+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(a+=a,t+=t),2==e.mode_gr&&(a=Math.max(a,t)),a*=.5,(a*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var r=31.98*a+625e-6;e.ATH.adjust>=r?(e.ATH.adjust*=.075*r+.925,e.ATH.adjust<r&&(e.ATH.adjust=r)):e.ATH.adjustLimit>=r?e.ATH.adjust=r:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=r}else e.ATH.adjust=1}function t(e){var t,a;for(he(0<=e.bitrate_index&&e.bitrate_index<16),he(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(a=0;a<e.channels_out;++a){var r=0|e.l3_side.tt[t][a].block_type;0!=e.l3_side.tt[t][a].mixed_block_flag&&(r=4),e.bitrate_blockType_Hist[e.bitrate_index][r]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][r]++,e.bitrate_blockType_Hist[15][5]++}}function a(e,t){var a,r,n=e.internal_flags;if(0==n.lame_encode_frame_init){var s,i,o=fe(2014),l=fe(2014);for(n.lame_encode_frame_init=1,s=0,i=0;s<286+576*(1+n.mode_gr);++s)s<576*n.mode_gr?(o[s]=0,2==n.channels_out&&(l[s]=0)):(o[s]=t[0][i],2==n.channels_out&&(l[s]=t[1][i]),++i);for(r=0;r<n.mode_gr;r++)for(a=0;a<n.channels_out;a++)n.l3_side.tt[r][a].block_type=p.SHORT_TYPE;f.mdct_sub48(n,o,l),he(576>=p.FFTOFFSET),he(n.mf_size>=p.BLKSIZE+e.framesize-p.FFTOFFSET),he(n.mf_size>=512+e.framesize-32)}}var r=ae,n=oe,s=p.FFTOFFSET,i=p.MPG_MD_MS_LR,o=null;this.psy=null;var l=null,c=null,_=null;this.setModules=function(e,t,a,r){o=e,this.psy=t,l=t,c=r,_=a};var f=new r;this.lame_encode_mp3_frame=function(r,u,h,d,m,b){var v,g=_e([2,2]);g[0][0]=new n,g[0][1]=new n,g[1][0]=new n,g[1][1]=new n;var S=_e([2,2]);S[0][0]=new n,S[0][1]=new n,S[1][0]=new n,S[1][1]=new n;var R,y,T,M,w=[null,null],E=r.internal_flags,A=ue([2,4]),k=[.5,.5],B=[[0,0],[0,0]],P=[[0,0],[0,0]];if(w[0]=u,w[1]=h,0==E.lame_encode_frame_init&&a(r,w),E.padding=0,(E.slot_lag-=E.frac_SpF)<0&&(E.slot_lag+=r.out_samplerate,E.padding=1),0!=E.psymodel){var x=[null,null],C=0,O=pe(2);for(M=0;M<E.mode_gr;M++){for(T=0;T<E.channels_out;T++)x[T]=w[T],C=576+576*M-p.FFTOFFSET;if(0!=(r.VBR==ce.vbr_mtrh||r.VBR==ce.vbr_mt?l.L3psycho_anal_vbr(r,x,C,M,g,S,B[M],P[M],A[M],O):l.L3psycho_anal_ns(r,x,C,M,g,S,B[M],P[M],A[M],O)))return-4;for(r.mode==MPEGMode.JOINT_STEREO&&(k[M]=A[M][2]+A[M][3],k[M]>0&&(k[M]=A[M][3]/k[M])),T=0;T<E.channels_out;T++){var I=E.l3_side.tt[M][T];I.block_type=O[T],I.mixed_block_flag=0}}}else for(M=0;M<E.mode_gr;M++)for(T=0;T<E.channels_out;T++)E.l3_side.tt[M][T].block_type=p.NORM_TYPE,E.l3_side.tt[M][T].mixed_block_flag=0,P[M][T]=B[M][T]=700;if(e(E),f.mdct_sub48(E,w[0],w[1]),E.mode_ext=p.MPG_MD_LR_LR,r.force_ms)E.mode_ext=p.MPG_MD_MS_LR;else if(r.mode==MPEGMode.JOINT_STEREO){var L=0,D=0;for(M=0;M<E.mode_gr;M++)for(T=0;T<E.channels_out;T++)L+=P[M][T],D+=B[M][T];if(L<=1*D){var N=E.l3_side.tt[0],V=E.l3_side.tt[E.mode_gr-1];N[0].block_type==N[1].block_type&&V[0].block_type==V[1].block_type&&(E.mode_ext=p.MPG_MD_MS_LR)}}if(E.mode_ext==i?(R=S,y=P):(R=g,y=B),r.analysis&&null!=E.pinfo)for(M=0;M<E.mode_gr;M++)for(T=0;T<E.channels_out;T++)E.pinfo.ms_ratio[M]=E.ms_ratio[M],E.pinfo.ms_ener_ratio[M]=k[M],E.pinfo.blocktype[M][T]=E.l3_side.tt[M][T].block_type,E.pinfo.pe[M][T]=y[M][T],le.arraycopy(E.l3_side.tt[M][T].xr,0,E.pinfo.xr[M][T],0,576),E.mode_ext==i&&(E.pinfo.ers[M][T]=E.pinfo.ers[M][T+2],le.arraycopy(E.pinfo.energy[M][T+2],0,E.pinfo.energy[M][T],0,E.pinfo.energy[M][T].length));if(r.VBR==ce.vbr_off||r.VBR==ce.vbr_abr){var H,j;for(H=0;H<18;H++)E.nsPsy.pefirbuf[H]=E.nsPsy.pefirbuf[H+1];for(j=0,M=0;M<E.mode_gr;M++)for(T=0;T<E.channels_out;T++)j+=y[M][T];for(E.nsPsy.pefirbuf[18]=j,j=E.nsPsy.pefirbuf[9],H=0;H<9;H++)j+=(E.nsPsy.pefirbuf[H]+E.nsPsy.pefirbuf[18-H])*p.fircoef[H];for(j=3350*E.mode_gr*E.channels_out/j,M=0;M<E.mode_gr;M++)for(T=0;T<E.channels_out;T++)y[M][T]*=j}if(E.iteration_loop.iteration_loop(r,y,k,R),o.format_bitstream(r),v=o.copy_buffer(E,d,m,b,1),r.bWriteVbrTag&&c.addVbrFrame(r),r.analysis&&null!=E.pinfo){for(T=0;T<E.channels_out;T++){var X;for(X=0;X<s;X++)E.pinfo.pcmdata[T][X]=E.pinfo.pcmdata[T][X+r.framesize];for(X=s;X<1600;X++)E.pinfo.pcmdata[T][X]=w[T][X-s]}_.set_frame_pinfo(r,R)}return t(E),v}}function h(e){var t=e;this.ordinal=function(){return t}}function d(){var e=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=Ze([2,d.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new Ne,this.ms_ratio=Ke(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Qe(2),this.CurrentStep=Qe(2),this.masking_lower=0,this.bv_scf=Qe(576),this.pseudohalf=Qe(Ce.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*d.BPC+1),this.itime=ze(2),this.sideinfo_len=0,this.sb_sample=Ze([2,2,18,de.SBLIMIT]),this.amp_filter=Ke(32),this.header=new Array(d.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new je,this.minval_l=Ke(de.CBANDS),this.minval_s=Ke(de.CBANDS),this.nb_1=Ze([4,de.CBANDS]),this.nb_2=Ze([4,de.CBANDS]),this.nb_s1=Ze([4,de.CBANDS]),this.nb_s2=Ze([4,de.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Ke(4),this.loudness_sq=Ze([2,2]),this.loudness_sq_save=Ke(2),this.mld_l=Ke(de.SBMAX_l),this.mld_s=Ke(de.SBMAX_s),this.bm_l=Qe(de.SBMAX_l),this.bo_l=Qe(de.SBMAX_l),this.bm_s=Qe(de.SBMAX_s),this.bo_s=Qe(de.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=We([de.CBANDS,2]),this.s3ind_s=We([de.CBANDS,2]),this.numlines_s=Qe(de.CBANDS),this.numlines_l=Qe(de.CBANDS),this.rnumlines_l=Ke(de.CBANDS),this.mld_cb_l=Ke(de.CBANDS),this.mld_cb_s=Ke(de.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Ke(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Qe(2),this.nsPsy=new qe,this.VBR_seek_table=new Ye,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=We([16,5]),this.bitrate_blockType_Hist=We([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(t=0;t<this.en.length;t++)this.en[t]=new ie;for(t=0;t<this.thm.length;t++)this.thm[t]=new ie;for(var t=0;t<this.header.length;t++)this.header[t]=new function(){this.write_timing=0,this.ptr=0,this.buf=Ue(e)}}function m(){function e(e,t,a,r,n,s){for(;0!=n--;)a[r]=1e-10+e[t+0]*s[0]-a[r-1]*s[1]+e[t-1]*s[2]-a[r-2]*s[3]+e[t-2]*s[4]-a[r-3]*s[5]+e[t-3]*s[6]-a[r-4]*s[7]+e[t-4]*s[8]-a[r-5]*s[9]+e[t-5]*s[10]-a[r-6]*s[11]+e[t-6]*s[12]-a[r-7]*s[13]+e[t-7]*s[14]-a[r-8]*s[15]+e[t-8]*s[16]-a[r-9]*s[17]+e[t-9]*s[18]-a[r-10]*s[19]+e[t-10]*s[20],++r,++t}function t(e,t,a,r,n,s){for(;0!=n--;)a[r]=e[t+0]*s[0]-a[r-1]*s[1]+e[t-1]*s[2]-a[r-2]*s[3]+e[t-2]*s[4],++r,++t}function a(e,t){for(var a=0;a<MAX_ORDER;a++)e.linprebuf[a]=e.lstepbuf[a]=e.loutbuf[a]=e.rinprebuf[a]=e.rstepbuf[a]=e.routbuf[a]=0;switch(0|t){case 48e3:e.reqindex=0;break;case 44100:e.reqindex=1;break;case 32e3:e.reqindex=2;break;case 24e3:e.reqindex=3;break;case 22050:e.reqindex=4;break;case 16e3:e.reqindex=5;break;case 12e3:e.reqindex=6;break;case 11025:e.reqindex=7;break;case 8e3:e.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return e.sampleWindow=0|(t*o+l-1)/l,e.lsum=0,e.rsum=0,e.totsamp=0,at.ill(e.A,0),INIT_GAIN_ANALYSIS_OK}function r(e){return e*e}function n(e,t){var a,r=0;for(a=0;a<t;a++)r+=e[a];if(0==r)return GAIN_NOT_ENOUGH_SAMPLES;var n=0|Math.ceil(r*(1-i));for(a=t;a-- >0&&!((n-=e[a])<=0););return s-a/m.STEPS_per_dB}var s=64.82,i=(m.YULE_ORDER,.95),o=(m.MAX_SAMP_FREQ,m.RMS_WINDOW_TIME_NUMERATOR),l=m.RMS_WINDOW_TIME_DENOMINATOR,c=(m.MAX_SAMPLES_PER_WINDOW,[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]]),_=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];this.InitGainAnalysis=function(e,t){return a(e,t)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(e.linpre=MAX_ORDER,e.rinpre=MAX_ORDER,e.lstep=MAX_ORDER,e.rstep=MAX_ORDER,e.lout=MAX_ORDER,e.rout=MAX_ORDER,at.fill(e.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(a,n,s,i,o,l,f){var u,p,h,d,b,v,g;if(0==l)return GAIN_ANALYSIS_OK;switch(g=0,b=l,f){case 1:i=n,o=s;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(l<MAX_ORDER?(tt.arraycopy(n,s,a.linprebuf,MAX_ORDER,l),tt.arraycopy(i,o,a.rinprebuf,MAX_ORDER,l)):(tt.arraycopy(n,s,a.linprebuf,MAX_ORDER,MAX_ORDER),tt.arraycopy(i,o,a.rinprebuf,MAX_ORDER,MAX_ORDER));b>0;){v=b>a.sampleWindow-a.totsamp?a.sampleWindow-a.totsamp:b,g<MAX_ORDER?(u=a.linpre+g,p=a.linprebuf,h=a.rinpre+g,d=a.rinprebuf,v>MAX_ORDER-g&&(v=MAX_ORDER-g)):(u=s+g,p=n,h=o+g,d=i),e(p,u,a.lstepbuf,a.lstep+a.totsamp,v,c[a.reqindex]),e(d,h,a.rstepbuf,a.rstep+a.totsamp,v,c[a.reqindex]),t(a.lstepbuf,a.lstep+a.totsamp,a.loutbuf,a.lout+a.totsamp,v,_[a.reqindex]),t(a.rstepbuf,a.rstep+a.totsamp,a.routbuf,a.rout+a.totsamp,v,_[a.reqindex]),u=a.lout+a.totsamp,p=a.loutbuf,h=a.rout+a.totsamp,d=a.routbuf;for(var S=v%8;0!=S--;)a.lsum+=r(p[u++]),a.rsum+=r(d[h++]);for(S=v/8;0!=S--;)a.lsum+=r(p[u+0])+r(p[u+1])+r(p[u+2])+r(p[u+3])+r(p[u+4])+r(p[u+5])+r(p[u+6])+r(p[u+7]),u+=8,a.rsum+=r(d[h+0])+r(d[h+1])+r(d[h+2])+r(d[h+3])+r(d[h+4])+r(d[h+5])+r(d[h+6])+r(d[h+7]),h+=8;if(b-=v,g+=v,a.totsamp+=v,a.totsamp==a.sampleWindow){var R=10*m.STEPS_per_dB*Math.log10((a.lsum+a.rsum)/a.totsamp*.5+1e-37),y=R<=0?0:0|R;y>=a.A.length&&(y=a.A.length-1),a.A[y]++,a.lsum=a.rsum=0,tt.arraycopy(a.loutbuf,a.totsamp,a.loutbuf,0,MAX_ORDER),tt.arraycopy(a.routbuf,a.totsamp,a.routbuf,0,MAX_ORDER),tt.arraycopy(a.lstepbuf,a.totsamp,a.lstepbuf,0,MAX_ORDER),tt.arraycopy(a.rstepbuf,a.totsamp,a.rstepbuf,0,MAX_ORDER),a.totsamp=0}if(a.totsamp>a.sampleWindow)return GAIN_ANALYSIS_ERROR}return l<MAX_ORDER?(tt.arraycopy(a.linprebuf,l,a.linprebuf,0,MAX_ORDER-l),tt.arraycopy(a.rinprebuf,l,a.rinprebuf,0,MAX_ORDER-l),tt.arraycopy(n,s,a.linprebuf,MAX_ORDER-l,l),tt.arraycopy(i,o,a.rinprebuf,MAX_ORDER-l,l)):(tt.arraycopy(n,s+l-MAX_ORDER,a.linprebuf,0,MAX_ORDER),tt.arraycopy(i,o+l-MAX_ORDER,a.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){for(var t=n(e.A,e.A.length),a=0;a<e.A.length;a++)e.B[a]+=e.A[a],e.A[a]=0;for(a=0;a<MAX_ORDER;a++)e.linprebuf[a]=e.lstepbuf[a]=e.loutbuf[a]=e.rinprebuf[a]=e.rstepbuf[a]=e.routbuf[a]=0;return e.totsamp=0,e.lsum=e.rsum=0,t}}function b(e,t,a,r){this.xlen=e,this.linmax=t,this.table=a,this.hlen=r}function v(){function e(e){return gt(0<=e+v.Q_MAX2&&e<v.Q_MAX),u[e+v.Q_MAX2]}function t(e,t){var a=i.ATHformula(t,e);return a-=_,a=Math.pow(10,a/10+e.ATHlower)}function a(e){for(var a=e.internal_flags.ATH.l,r=e.internal_flags.ATH.psfb21,n=e.internal_flags.ATH.s,s=e.internal_flags.ATH.psfb12,i=e.internal_flags,o=e.out_samplerate,l=0;l<de.SBMAX_l;l++){var c=i.scalefac_band.l[l],_=i.scalefac_band.l[l+1];a[l]=dt.MAX_VALUE;for(f=c;f<_;f++){p=t(e,u=f*o/1152);a[l]=Math.min(a[l],p)}}for(l=0;l<de.PSFB21;l++){var c=i.scalefac_band.psfb21[l],_=i.scalefac_band.psfb21[l+1];r[l]=dt.MAX_VALUE;for(f=c;f<_;f++){p=t(e,u=f*o/1152);r[l]=Math.min(r[l],p)}}for(l=0;l<de.SBMAX_s;l++){var c=i.scalefac_band.s[l],_=i.scalefac_band.s[l+1];n[l]=dt.MAX_VALUE;for(f=c;f<_;f++){p=t(e,u=f*o/384);n[l]=Math.min(n[l],p)}n[l]*=i.scalefac_band.s[l+1]-i.scalefac_band.s[l]}for(l=0;l<de.PSFB12;l++){var c=i.scalefac_band.psfb12[l],_=i.scalefac_band.psfb12[l+1];s[l]=dt.MAX_VALUE;for(var f=c;f<_;f++){var u=f*o/384,p=t(e,u);s[l]=Math.min(s[l],p)}s[l]*=i.scalefac_band.s[13]-i.scalefac_band.s[12]}if(e.noATH){for(l=0;l<de.SBMAX_l;l++)a[l]=1e-20;for(l=0;l<de.PSFB21;l++)r[l]=1e-20;for(l=0;l<de.SBMAX_s;l++)n[l]=1e-20;for(l=0;l<de.PSFB12;l++)s[l]=1e-20}i.ATH.floor=10*Math.log10(t(e,-1))}function r(e){this.s=e}var n=null,s=null,i=null;this.setModules=function(e,t,a){n=e,s=t,i=a},this.IPOW20=function(e){return gt(0<=e&&e<v.Q_MAX),p[e]};var o=v.IXMAX_VAL+2,l=v.Q_MAX,c=v.Q_MAX2,_=(v.LARGE_BITS,100);this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var f=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=f,this.sfBandIndex=[new je([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new je([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new je([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new je([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new je([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new je([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new je([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new je([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new je([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var u=bt(l+c+1),p=bt(l),h=bt(o),d=bt(o);this.adj43=d,this.iteration_init=function(e){var t,r=e.internal_flags,s=r.l3_side;if(0==r.iteration_init_init){for(r.iteration_init_init=1,s.main_data_begin=0,a(e),h[0]=0,t=1;t<o;t++)h[t]=Math.pow(t,4/3);for(t=0;t<o-1;t++)d[t]=t+1-Math.pow(.5*(h[t]+h[t+1]),.75);for(d[t]=.5,t=0;t<l;t++)p[t]=Math.pow(2,-.1875*(t-210));for(t=0;t<=l+c;t++)u[t]=Math.pow(2,.25*(t-210-c));n.huffman_init(r);var i,_,f,m;for((t=e.exp_nspsytune>>2&63)>=32&&(t-=64),i=Math.pow(10,t/4/10),(t=e.exp_nspsytune>>8&63)>=32&&(t-=64),_=Math.pow(10,t/4/10),(t=e.exp_nspsytune>>14&63)>=32&&(t-=64),f=Math.pow(10,t/4/10),(t=e.exp_nspsytune>>20&63)>=32&&(t-=64),m=f*Math.pow(10,t/4/10),t=0;t<de.SBMAX_l;t++){b=t<=6?i:t<=13?_:t<=20?f:m,r.nsPsy.longfact[t]=b}for(t=0;t<de.SBMAX_s;t++){var b;b=t<=5?i:t<=10?_:t<=11?f:m,r.nsPsy.shortfact[t]=b}}},this.on_pe=function(e,t,a,r,n,i){var o,l,c=e.internal_flags,_=0,f=vt(2),u=new ot(_),p=s.ResvMaxBits(e,r,u,i),h=(_=u.bits)+p;for(h>Je.MAX_BITS_PER_GRANULE&&(h=Je.MAX_BITS_PER_GRANULE),o=0,l=0;l<c.channels_out;++l)a[l]=Math.min(Je.MAX_BITS_PER_CHANNEL,_/c.channels_out),f[l]=0|a[l]*t[n][l]/700-a[l],f[l]>3*r/4&&(f[l]=3*r/4),f[l]<0&&(f[l]=0),f[l]+a[l]>Je.MAX_BITS_PER_CHANNEL&&(f[l]=Math.max(0,Je.MAX_BITS_PER_CHANNEL-a[l])),o+=f[l];if(o>p)for(l=0;l<c.channels_out;++l)f[l]=p*f[l]/o;for(l=0;l<c.channels_out;++l)a[l]+=f[l],p-=f[l];for(o=0,l=0;l<c.channels_out;++l)o+=a[l];if(o>Je.MAX_BITS_PER_GRANULE){var d=0;for(l=0;l<c.channels_out;++l)a[l]*=Je.MAX_BITS_PER_GRANULE,a[l]/=o,d+=a[l];gt(d<=Je.MAX_BITS_PER_GRANULE)}return h},this.reduce_side=function(e,t,a,r){gt(r<=Je.MAX_BITS_PER_GRANULE),gt(e[0]+e[1]<=Je.MAX_BITS_PER_GRANULE);var n=.33*(.5-t)/.5;n<0&&(n=0),n>.5&&(n=.5);var s=0|.5*n*(e[0]+e[1]);s>Je.MAX_BITS_PER_CHANNEL-e[0]&&(s=Je.MAX_BITS_PER_CHANNEL-e[0]),s<0&&(s=0),e[1]>=125&&(e[1]-s>125?(e[0]<a&&(e[0]+=s),e[1]-=s):(e[0]+=e[1]-125,e[1]=125)),(s=e[0]+e[1])>r&&(e[0]=r*e[0]/s,e[1]=r*e[1]/s),gt(e[0]<=Je.MAX_BITS_PER_CHANNEL),gt(e[1]<=Je.MAX_BITS_PER_CHANNEL),gt(e[0]+e[1]<=Je.MAX_BITS_PER_GRANULE)},this.athAdjust=function(e,t,a){var r=90.30873362,n=mt.FAST_LOG10_X(t,10),s=e*e,i=0;return n-=a,s>1e-20&&(i=1+mt.FAST_LOG10_X(s,10/r)),i<0&&(i=0),n*=i,n+=a+r-94.82444863,Math.pow(10,.1*n)},this.calc_xmin=function(e,t,a,r){var n,s=0,i=e.internal_flags,o=0,l=0,c=i.ATH,_=a.xr,f=e.VBR==ht.vbr_mtrh?1:0,u=i.masking_lower;for(e.VBR!=ht.vbr_mtrh&&e.VBR!=ht.vbr_mt||(u=1),n=0;n<a.psy_lmax;n++){S=(g=e.VBR==ht.vbr_rh||e.VBR==ht.vbr_mtrh?athAdjust(c.adjust,c.l[n],c.floor):c.adjust*c.l[n])/(m=a.width[n]),R=2.220446049250313e-16,T=m>>1,y=0;do{y+=M=_[o]*_[o],R+=M<S?M:S,y+=w=_[++o]*_[o],R+=w<S?w:S,o++}while(--T>0);if(y>g&&l++,n==de.SBPSY_l&&R<(A=g*i.nsPsy.longfact[n])&&(R=A),0!=f&&(g=R),!e.ATHonly&&(E=t.en.l[n])>0){A=y*t.thm.l[n]*u/E,0!=f&&(A*=i.nsPsy.longfact[n]),g<A&&(g=A)}r[s++]=0!=f?g:g*i.nsPsy.longfact[n]}var p=575;if(a.block_type!=de.SHORT_TYPE)for(var h=576;0!=h--&&BitStream.EQ(_[h],0);)p=h;a.max_nonzero_coeff=p;for(var d=a.sfb_smin;n<a.psymax;d++,n+=3){var m,b,v;for(v=e.VBR==ht.vbr_rh||e.VBR==ht.vbr_mtrh?athAdjust(c.adjust,c.s[d],c.floor):c.adjust*c.s[d],m=a.width[n],b=0;b<3;b++){var g,S,R,y=0,T=m>>1;S=v/m,R=2.220446049250313e-16;do{var M,w;y+=M=_[o]*_[o],R+=M<S?M:S,y+=w=_[++o]*_[o],R+=w<S?w:S,o++}while(--T>0);if(y>v&&l++,d==de.SBPSY_s&&R<(A=v*i.nsPsy.shortfact[d])&&(R=A),g=0!=f?R:v,!e.ATHonly&&!e.ATHshort){var E=t.en.s[d][b];if(E>0){var A;A=y*t.thm.s[d][b]*u/E,0!=f&&(A*=i.nsPsy.shortfact[d]),g<A&&(g=A)}}r[s++]=0!=f?g:g*i.nsPsy.shortfact[d]}e.useTemporal&&(r[s-3]>r[s-3+1]&&(r[s-3+1]+=(r[s-3]-r[s-3+1])*i.decay),r[s-3+1]>r[s-3+2]&&(r[s-3+2]+=(r[s-3+1]-r[s-3+2])*i.decay))}return l},this.calc_noise_core=function(e,t,a,r){var n=0,s=t.s,i=e.l3_enc;if(s>e.count1)for(;0!=a--;){l=e.xr[s],s++,n+=l*l,l=e.xr[s],s++,n+=l*l}else if(s>e.big_values){var o=bt(2);for(o[0]=0,o[1]=r;0!=a--;){l=Math.abs(e.xr[s])-o[i[s]],s++,n+=l*l,l=Math.abs(e.xr[s])-o[i[s]],s++,n+=l*l}}else for(;0!=a--;){var l;l=Math.abs(e.xr[s])-h[i[s]]*r,s++,n+=l*l,l=Math.abs(e.xr[s])-h[i[s]]*r,s++,n+=l*l}return t.s=s,n},this.calc_noise=function(t,a,n,s,i){var o,l,c=0,_=0,u=0,p=0,h=0,d=-20,m=0,b=t.scalefac,v=0;for(s.over_SSD=0,o=0;o<t.psymax;o++){var g=t.global_gain-(b[v++]+(0!=t.preflag?f[o]:0)<<t.scalefac_scale+1)-8*t.subblock_gain[t.window[o]],S=0;if(null!=i&&i.step[o]==g)S=i.noise[o],m+=t.width[o],n[c++]=S/a[_++],S=i.noise_log[o];else{var R=e(g);if(l=t.width[o]>>1,m+t.width[o]>t.max_nonzero_coeff){var y;l=(y=t.max_nonzero_coeff-m+1)>0?y>>1:0}var T=new r(m);S=this.calc_noise_core(t,T,l,R),m=T.s,null!=i&&(i.step[o]=g,i.noise[o]=S),S=n[c++]=S/a[_++],S=mt.FAST_LOG10(Math.max(S,1e-20)),null!=i&&(i.noise_log[o]=S)}if(null!=i&&(i.global_gain=t.global_gain),h+=S,S>0){var M;M=Math.max(0|10*S+.5,1),s.over_SSD+=M*M,u++,p+=S}d=Math.max(d,S)}return s.over_count=u,s.tot_noise=h,s.over_noise=p,s.max_noise=d,u},this.set_pinfo=function(e,t,a,r,n){var s,i,o,l,c,_=e.internal_flags,u=0==t.scalefac_scale?.5:1,p=t.scalefac,h=bt(L3Side.SFBMAX),d=bt(L3Side.SFBMAX),m=new CalcNoiseResult;calc_xmin(e,a,t,h),calc_noise(t,h,d,m,null);var b=0;for(i=t.sfb_lmax,t.block_type!=de.SHORT_TYPE&&0==t.mixed_block_flag&&(i=22),s=0;s<i;s++){var v=_.scalefac_band.l[s],g=(S=_.scalefac_band.l[s+1])-v;for(l=0;b<S;b++)l+=t.xr[b]*t.xr[b];l/=g,c=1e15,_.pinfo.en[r][n][s]=c*l,_.pinfo.xfsf[r][n][s]=c*h[s]*d[s]/g,a.en.l[s]>0&&!e.ATHonly?l/=a.en.l[s]:l=0,_.pinfo.thr[r][n][s]=c*Math.max(l*a.thm.l[s],_.ATH.l[s]),_.pinfo.LAMEsfb[r][n][s]=0,0!=t.preflag&&s>=11&&(_.pinfo.LAMEsfb[r][n][s]=-u*f[s]),s<de.SBPSY_l&&(gt(p[s]>=0),_.pinfo.LAMEsfb[r][n][s]-=u*p[s])}if(t.block_type==de.SHORT_TYPE)for(i=s,s=t.sfb_smin;s<de.SBMAX_s;s++)for(var v=_.scalefac_band.s[s],S=_.scalefac_band.s[s+1],g=S-v,R=0;R<3;R++){for(l=0,o=v;o<S;o++)l+=t.xr[b]*t.xr[b],b++;l=Math.max(l/g,1e-20),c=1e15,_.pinfo.en_s[r][n][3*s+R]=c*l,_.pinfo.xfsf_s[r][n][3*s+R]=c*h[i]*d[i]/g,a.en.s[s][R]>0?l/=a.en.s[s][R]:l=0,(e.ATHonly||e.ATHshort)&&(l=0),_.pinfo.thr_s[r][n][3*s+R]=c*Math.max(l*a.thm.s[s][R],_.ATH.s[s]),_.pinfo.LAMEsfb_s[r][n][3*s+R]=-2*t.subblock_gain[R],s<de.SBPSY_s&&(_.pinfo.LAMEsfb_s[r][n][3*s+R]-=u*p[i]),i++}_.pinfo.LAMEqss[r][n]=t.global_gain,_.pinfo.LAMEmainbits[r][n]=t.part2_3_length+t.part2_length,_.pinfo.LAMEsfbits[r][n]=t.part2_length,_.pinfo.over[r][n]=m.over_count,_.pinfo.max_noise[r][n]=10*m.max_noise,_.pinfo.over_noise[r][n]=10*m.over_noise,_.pinfo.tot_noise[r][n]=10*m.tot_noise,_.pinfo.over_SSD[r][n]=m.over_SSD}}function g(){function e(e){this.bits=0|e}function t(e,t,a,r,n,s){var i=.5946/t;for(Mt(e>0),e>>=1;0!=e--;)n[s++]=i>a[r++]?0:1,n[s++]=i>a[r++]?0:1}function a(e,t,a,r,n,s){Mt(e>0);var i=(e>>=1)%2;for(e>>=1;0!=e--;){var o,l,c,_;f=a[r++]*t,u=a[r++]*t,p=0|f,o=a[r++]*t,d=0|u,l=a[r++]*t,c=0|o,f+=h.adj43[p],_=0|l,u+=h.adj43[d],n[s++]=0|f,o+=h.adj43[c],n[s++]=0|u,l+=h.adj43[_],n[s++]=0|o,n[s++]=0|l}if(0!=i){var f,u,p,d;p=0|(f=a[r++]*t),d=0|(u=a[r++]*t),f+=h.adj43[p],u+=h.adj43[d],n[s++]=0|f,n[s++]=0|u}}function r(e,r,n,s,i){var o,l,c,_=0,f=0,u=0,p=0,d=r,m=0,b=d,v=0,g=e,S=0;for(c=null!=i&&s.global_gain==i.global_gain,l=s.block_type==de.SHORT_TYPE?38:21,o=0;o<=l;o++){var R=-1;if((c||s.block_type==de.NORM_TYPE)&&(R=s.global_gain-(s.scalefac[o]+(0!=s.preflag?h.pretab[o]:0)<<s.scalefac_scale+1)-8*s.subblock_gain[s.window[o]]),Mt(s.width[o]>=0),c&&i.step[o]==R)0!=f&&(a(f,n,g,S,b,v),f=0),0!=u&&(t(u,n,g,S,b,v),u=0);else{var y=s.width[o];if(_+s.width[o]>s.max_nonzero_coeff){var T;T=s.max_nonzero_coeff-_+1,yt.fill(r,s.max_nonzero_coeff,576,0),(y=T)<0&&(y=0),o=l+1}if(0==f&&0==u&&(b=d,v=m,g=e,S=p),null!=i&&i.sfb_count1>0&&o>=i.sfb_count1&&i.step[o]>0&&R>=i.step[o]?(0!=f&&(a(f,n,g,S,b,v),f=0,b=d,v=m,g=e,S=p),u+=y):(0!=u&&(t(u,n,g,S,b,v),u=0,b=d,v=m,g=e,S=p),f+=y),y<=0){0!=u&&(t(u,n,g,S,b,v),u=0),0!=f&&(a(f,n,g,S,b,v),f=0);break}}o<=l&&(m+=s.width[o],p+=s.width[o],_+=s.width[o])}0!=f&&(a(f,n,g,S,b,v),f=0),0!=u&&(t(u,n,g,S,b,v),u=0)}function n(e,t,a){var r=0,n=0;do{var s=e[t++],i=e[t++];r<s&&(r=s),n<i&&(n=i)}while(t<a);return r<n&&(r=n),r}function s(e,t,a,r,n,s){var i,o=65536*pt.ht[r].xlen+pt.ht[n].xlen,l=0;do{var c=e[t++],_=e[t++];0!=c&&(c>14&&(c=15,l+=o),c*=16),0!=_&&(_>14&&(_=15,l+=o),c+=_),l+=pt.largetbl[c]}while(t<a);return i=65535&l,(l>>=16)>i&&(l=i,r=n),s.bits+=l,r}function i(e,t,a,r){var n=0,s=pt.ht[1].hlen;do{var i=2*e[t+0]+e[t+1];t+=2,n+=s[i]}while(t<a);return r.bits+=n,1}function o(e,t,a,r,n){var s,i,o=0,l=pt.ht[r].xlen;i=2==r?pt.table23:pt.table56;do{var c=e[t+0]*l+e[t+1];t+=2,o+=i[c]}while(t<a);return s=65535&o,(o>>=16)>s&&(o=s,r++),n.bits+=o,r}function l(e,t,a,r,n){var s=0,i=0,o=0,l=pt.ht[r].xlen,c=pt.ht[r].hlen,_=pt.ht[r+1].hlen,f=pt.ht[r+2].hlen;do{var u=e[t+0]*l+e[t+1];t+=2,s+=c[u],i+=_[u],o+=f[u]}while(t<a);var p=r;return s>i&&(s=i,p++),s>o&&(s=o,p=r+2),n.bits+=s,p}function c(e,t,a,r){var c=n(e,t,a);switch(c){case 0:return c;case 1:return i(e,t,a,r);case 2:case 3:return o(e,t,a,m[c-1],r);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return l(e,t,a,m[c-1],r);default:if(c>St.IXMAX_VAL)return r.bits=St.LARGE_BITS,-1;c-=15;var _;for(_=24;_<32&&!(pt.ht[_].linmax>=c);_++);var f;for(f=_-8;f<24&&!(pt.ht[f].linmax>=c);f++);return s(e,t,a,f,_,r)}}function _(t,a,r,n,s,i,o){for(var l=a.big_values,_=0;_<=22;_++)n[_]=St.LARGE_BITS;for(_=0;_<16;_++){var f=t.scalefac_band.l[_+1];if(f>=l)break;var u=0,p=new e(u),h=c(r,0,f,p);u=p.bits;for(var d=0;d<8;d++){var m=t.scalefac_band.l[_+d+2];if(m>=l)break;var b=u,v=c(r,f,m,p=new e(b));b=p.bits,n[_+d]>b&&(n[_+d]=b,s[_+d]=_,i[_+d]=h,o[_+d]=v)}}}function f(t,a,r,n,s,i,o,l){for(var _=a.big_values,f=2;f<de.SBMAX_l+1;f++){var u=t.scalefac_band.l[f];if(u>=_)break;var p=s[f-2]+a.count1bits;if(r.part2_3_length<=p)break;var h=new e(p),d=c(n,u,_,h);p=h.bits,r.part2_3_length<=p||(r.assign(a),r.part2_3_length=p,r.region0_count=i[f-2],r.region1_count=f-2-i[f-2],r.table_select[0]=o[f-2],r.table_select[1]=l[f-2],r.table_select[2]=d)}}function u(e,t){for(var a,r=t.tt[1][e],n=t.tt[0][e],s=0;s<pt.scfsi_band.length-1;s++){for(a=pt.scfsi_band[s];a<pt.scfsi_band[s+1]&&!(n.scalefac[a]!=r.scalefac[a]&&r.scalefac[a]>=0);a++);if(a==pt.scfsi_band[s+1]){for(a=pt.scfsi_band[s];a<pt.scfsi_band[s+1];a++)r.scalefac[a]=-1;t.scfsi[e][s]=1}}var i=0,o=0;for(a=0;a<11;a++)-1!=r.scalefac[a]&&(o++,i<r.scalefac[a]&&(i=r.scalefac[a]));for(var l=0,c=0;a<de.SBPSY_l;a++)-1!=r.scalefac[a]&&(c++,l<r.scalefac[a]&&(l=r.scalefac[a]));for(s=0;s<16;s++)if(i<b[s]&&l<v[s]){var _=S[s]*o+R[s]*c;r.part2_length>_&&(r.part2_length=_,r.scalefac_compress=s)}}function p(e,t){for(var a=0;a<t;++a)if(e[a]<0)return!1;return!0}var h=null;this.qupvt=null,this.setModules=function(e){this.qupvt=e,h=e};var d=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]],m=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];this.noquant_count_bits=function(t,a,r){var n=a.l3_enc,s=Math.min(576,a.max_nonzero_coeff+2>>1<<1);for(null!=r&&(r.sfb_count1=0);s>1&&0==(n[s-1]|n[s-2]);s-=2);a.count1=s;for(var i=0,o=0;s>3;s-=4){var l;if((2147483647&(n[s-1]|n[s-2]|n[s-3]|n[s-4]))>1)break;l=2*(2*(2*n[s-4]+n[s-3])+n[s-2])+n[s-1],i+=pt.t32l[l],o+=pt.t33l[l]}var _=i;if(a.count1table_select=0,i>o&&(_=o,a.count1table_select=1),a.count1bits=_,a.big_values=s,0==s)return _;if(a.block_type==de.SHORT_TYPE)(i=3*t.scalefac_band.s[3])>a.big_values&&(i=a.big_values),o=a.big_values;else if(a.block_type==de.NORM_TYPE){if(Mt(s<=576),i=a.region0_count=t.bv_scf[s-2],o=a.region1_count=t.bv_scf[s-1],Mt(i+o+2<de.SBPSY_l),o=t.scalefac_band.l[i+o+2],i=t.scalefac_band.l[i+1],o<s){f=new e(_);a.table_select[2]=c(n,o,s,f),_=f.bits}}else a.region0_count=7,a.region1_count=de.SBMAX_l-1-7-1,(i=t.scalefac_band.l[8])>(o=s)&&(i=o);if(i=Math.min(i,s),o=Math.min(o,s),Mt(i>=0),Mt(o>=0),0<i){f=new e(_);a.table_select[0]=c(n,0,i,f),_=f.bits}if(i<o){var f=new e(_);a.table_select[1]=c(n,i,o,f),_=f.bits}if(2==t.use_best_huffman&&(a.part2_3_length=_,best_huffman_divide(t,a),_=a.part2_3_length),null!=r&&a.block_type==de.NORM_TYPE){for(var u=0;t.scalefac_band.l[u]<a.big_values;)u++;r.sfb_count1=u}return _},this.count_bits=function(e,t,a,n){var s=a.l3_enc,i=St.IXMAX_VAL/h.IPOW20(a.global_gain);if(a.xrpow_max>i)return St.LARGE_BITS;if(r(t,s,h.IPOW20(a.global_gain),a,n),0!=(2&e.substep_shaping))for(var o=0,l=a.global_gain+a.scalefac_scale,c=.634521682242439/h.IPOW20(l),_=0;_<a.sfbmax;_++){var f=a.width[_];if(Mt(f>=0),0==e.pseudohalf[_])o+=f;else{var u;for(u=o,o+=f;u<o;++u)s[u]=t[u]>=c?s[u]:0}}return this.noquant_count_bits(e,a,n)},this.best_huffman_divide=function(t,a){var r=new Le,n=a.l3_enc,s=Tt(23),i=Tt(23),o=Tt(23),l=Tt(23);if(a.block_type!=de.SHORT_TYPE||1!=t.mode_gr){r.assign(a),a.block_type==de.NORM_TYPE&&(_(t,a,n,s,i,o,l),f(t,r,a,n,s,i,o,l));var u=r.big_values;if(!(0==u||(n[u-2]|n[u-1])>1||(u=a.count1+2)>576)){r.assign(a),r.count1=u;var p=0,h=0;for(Mt(u<=576);u>r.big_values;u-=4){var d=2*(2*(2*n[u-4]+n[u-3])+n[u-2])+n[u-1];p+=pt.t32l[d],h+=pt.t33l[d]}if(r.big_values=u,r.count1table_select=0,p>h&&(p=h,r.count1table_select=1),r.count1bits=p,r.block_type==de.NORM_TYPE)f(t,r,a,n,s,i,o,l);else{if(r.part2_3_length=p,(p=t.scalefac_band.l[8])>u&&(p=u),p>0){m=new e(r.part2_3_length);r.table_select[0]=c(n,0,p,m),r.part2_3_length=m.bits}if(u>p){var m=new e(r.part2_3_length);r.table_select[1]=c(n,p,u,m),r.part2_3_length=m.bits}a.part2_3_length>r.part2_3_length&&a.assign(r)}}}};var b=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],v=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],S=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],R=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];g.slen1_tab=S,g.slen2_tab=R,this.best_scalefac_store=function(e,t,a,r){var n,s,i,o,l=r.tt[t][a],c=0;for(i=0,n=0;n<l.sfbmax;n++){var _=l.width[n];for(Mt(_>=0),i+=_,o=-_;o<0&&0==l.l3_enc[o+i];o++);0==o&&(l.scalefac[n]=c=-2)}if(0==l.scalefac_scale&&0==l.preflag){var f=0;for(n=0;n<l.sfbmax;n++)l.scalefac[n]>0&&(f|=l.scalefac[n]);if(0==(1&f)&&0!=f){for(n=0;n<l.sfbmax;n++)l.scalefac[n]>0&&(l.scalefac[n]>>=1);l.scalefac_scale=c=1}}if(0==l.preflag&&l.block_type!=de.SHORT_TYPE&&2==e.mode_gr){for(n=11;n<de.SBPSY_l&&!(l.scalefac[n]<h.pretab[n]&&-2!=l.scalefac[n]);n++);if(n==de.SBPSY_l){for(n=11;n<de.SBPSY_l;n++)l.scalefac[n]>0&&(l.scalefac[n]-=h.pretab[n]);l.preflag=c=1}}for(s=0;s<4;s++)r.scfsi[a][s]=0;for(2==e.mode_gr&&1==t&&r.tt[0][a].block_type!=de.SHORT_TYPE&&r.tt[1][a].block_type!=de.SHORT_TYPE&&(u(a,r),c=0),n=0;n<l.sfbmax;n++)-2==l.scalefac[n]&&(l.scalefac[n]=0);0!=c&&(2==e.mode_gr?this.scale_bitcount(l):this.scale_bitcount_lsf(e,l))};var y=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],T=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],M=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var t,a,r,n=0,s=0,i=e.scalefac;if(Mt(p(i,e.sfbmax)),e.block_type==de.SHORT_TYPE)r=y,0!=e.mixed_block_flag&&(r=T);else if(r=M,0==e.preflag){for(a=11;a<de.SBPSY_l&&!(i[a]<h.pretab[a]);a++);if(a==de.SBPSY_l)for(e.preflag=1,a=11;a<de.SBPSY_l;a++)i[a]-=h.pretab[a]}for(a=0;a<e.sfbdivide;a++)n<i[a]&&(n=i[a]);for(;a<e.sfbmax;a++)s<i[a]&&(s=i[a]);for(e.part2_length=St.LARGE_BITS,t=0;t<16;t++)n<b[t]&&s<v[t]&&e.part2_length>r[t]&&(e.part2_length=r[t],e.scalefac_compress=t);return e.part2_length==St.LARGE_BITS};var w=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,t){var a,r,n,s,i,o,l,c,_=Tt(4),f=t.scalefac;for(a=0!=t.preflag?2:0,l=0;l<4;l++)_[l]=0;if(t.block_type==de.SHORT_TYPE){r=1;u=h.nr_of_sfb_block[a][r];for(c=0,n=0;n<4;n++)for(s=u[n]/3,l=0;l<s;l++,c++)for(i=0;i<3;i++)f[3*c+i]>_[n]&&(_[n]=f[3*c+i])}else{r=0;var u=h.nr_of_sfb_block[a][r];for(c=0,n=0;n<4;n++)for(s=u[n],l=0;l<s;l++,c++)f[c]>_[n]&&(_[n]=f[c])}for(o=!1,n=0;n<4;n++)_[n]>w[a][n]&&(o=!0);if(!o){var p,d,m,b;for(t.sfb_partition_table=h.nr_of_sfb_block[a][r],n=0;n<4;n++)t.slen[n]=E[_[n]];switch(p=t.slen[0],d=t.slen[1],m=t.slen[2],b=t.slen[3],a){case 0:t.scalefac_compress=(5*p+d<<4)+(m<<2)+b;break;case 1:t.scalefac_compress=400+(5*p+d<<2)+m;break;case 2:t.scalefac_compress=500+3*p+d;break;default:Rt.err.printf("intensity stereo not implemented yet\n")}}if(!o)for(Mt(null!=t.sfb_partition_table),t.part2_length=0,n=0;n<4;n++)t.part2_length+=t.slen[n]*t.sfb_partition_table[n];return o};var E=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var a,r=0;e.scalefac_band.l[++r]<t;);for(a=d[r][0];e.scalefac_band.l[a+1]>t;)a--;for(a<0&&(a=d[r][0]),e.bv_scf[t-2]=a,a=d[r][1];e.scalefac_band.l[a+e.bv_scf[t-2]+2]>t;)a--;a<0&&(a=d[r][1]),e.bv_scf[t-1]=a}}}function S(){function e(e){Et.arraycopy(e.header[e.w_ptr].buf,0,R,T,e.sideinfo_len),T+=e.sideinfo_len,y+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&Je.MAX_HEADER_BUF-1}function t(t,a,r){for(xt(r<m-2);r>0;){var n;0==M&&(M=8,xt(++T<Lame.LAME_MAXMP3BUFFER),xt(t.header[t.w_ptr].write_timing>=y),t.header[t.w_ptr].write_timing==y&&e(t),R[T]=0),n=Math.min(r,M),M-=n,xt((r-=n)<m),xt(M<m),R[T]|=a>>r<<M,y+=n}}function a(e,t,a){for(xt(a<m-2);a>0;){var r;0==M&&(M=8,xt(++T<Lame.LAME_MAXMP3BUFFER),R[T]=0),r=Math.min(a,M),M-=r,xt((a-=r)<m),xt(M<m),R[T]|=t>>a<<M,y+=r}}function r(e,a){var r,n=e.internal_flags;if(xt(a>=0),a>=8&&(t(n,76,8),a-=8),a>=8&&(t(n,65,8),a-=8),a>=8&&(t(n,77,8),a-=8),a>=8&&(t(n,69,8),a-=8),a>=32){var s=g.getLameShortVersion();if(a>=32)for(r=0;r<s.length&&a>=8;++r)a-=8,t(n,s.charAt(r),8)}for(;a>=1;a-=1)t(n,n.ancillary_flag,1),n.ancillary_flag^=e.disable_reservoir?0:1;xt(0==a)}function n(e,t,a){for(var r=e.header[e.h_ptr].ptr;a>0;){var n=Math.min(a,8-(7&r));xt((a-=n)<m),e.header[e.h_ptr].buf[r>>3]|=t>>a<<8-(7&r)-n,r+=n}e.header[e.h_ptr].ptr=r}function s(e,t){e<<=8;for(var a=0;a<8;a++)0!=(65536&((t<<=1)^(e<<=1)))&&(t^=d);return t}function i(e,t){var a,r,s,i=e.internal_flags;if(a=i.l3_side,i.header[i.h_ptr].ptr=0,At.fill(i.header[i.h_ptr].buf,0,i.sideinfo_len,0),e.out_samplerate<16e3?n(i,4094,12):n(i,4095,12),n(i,e.version,1),n(i,1,2),n(i,e.error_protection?0:1,1),n(i,i.bitrate_index,4),n(i,i.samplerate_index,2),n(i,i.padding,1),n(i,e.extension,1),n(i,e.mode.ordinal(),2),n(i,i.mode_ext,2),n(i,e.copyright,1),n(i,e.original,1),n(i,e.emphasis,2),e.error_protection&&n(i,0,16),1==e.version){for(xt(a.main_data_begin>=0),n(i,a.main_data_begin,9),2==i.channels_out?n(i,a.private_bits,3):n(i,a.private_bits,5),s=0;s<i.channels_out;s++){var o;for(o=0;o<4;o++)n(i,a.scfsi[s][o],1)}for(r=0;r<2;r++)for(s=0;s<i.channels_out;s++)n(i,(l=a.tt[r][s]).part2_3_length+l.part2_length,12),n(i,l.big_values/2,9),n(i,l.global_gain,8),n(i,l.scalefac_compress,4),l.block_type!=de.NORM_TYPE?(n(i,1,1),n(i,l.block_type,2),n(i,l.mixed_block_flag,1),14==l.table_select[0]&&(l.table_select[0]=16),n(i,l.table_select[0],5),14==l.table_select[1]&&(l.table_select[1]=16),n(i,l.table_select[1],5),n(i,l.subblock_gain[0],3),n(i,l.subblock_gain[1],3),n(i,l.subblock_gain[2],3)):(n(i,0,1),14==l.table_select[0]&&(l.table_select[0]=16),n(i,l.table_select[0],5),14==l.table_select[1]&&(l.table_select[1]=16),n(i,l.table_select[1],5),14==l.table_select[2]&&(l.table_select[2]=16),n(i,l.table_select[2],5),xt(0<=l.region0_count&&l.region0_count<16),xt(0<=l.region1_count&&l.region1_count<8),n(i,l.region0_count,4),n(i,l.region1_count,3)),n(i,l.preflag,1),n(i,l.scalefac_scale,1),n(i,l.count1table_select,1)}else for(xt(a.main_data_begin>=0),n(i,a.main_data_begin,8),n(i,a.private_bits,i.channels_out),r=0,s=0;s<i.channels_out;s++){var l=a.tt[r][s];n(i,l.part2_3_length+l.part2_length,12),n(i,l.big_values/2,9),n(i,l.global_gain,8),n(i,l.scalefac_compress,9),l.block_type!=de.NORM_TYPE?(n(i,1,1),n(i,l.block_type,2),n(i,l.mixed_block_flag,1),14==l.table_select[0]&&(l.table_select[0]=16),n(i,l.table_select[0],5),14==l.table_select[1]&&(l.table_select[1]=16),n(i,l.table_select[1],5),n(i,l.subblock_gain[0],3),n(i,l.subblock_gain[1],3),n(i,l.subblock_gain[2],3)):(n(i,0,1),14==l.table_select[0]&&(l.table_select[0]=16),n(i,l.table_select[0],5),14==l.table_select[1]&&(l.table_select[1]=16),n(i,l.table_select[1],5),14==l.table_select[2]&&(l.table_select[2]=16),n(i,l.table_select[2],5),xt(0<=l.region0_count&&l.region0_count<16),xt(0<=l.region1_count&&l.region1_count<8),n(i,l.region0_count,4),n(i,l.region1_count,3)),n(i,l.scalefac_scale,1),n(i,l.count1table_select,1)}e.error_protection&&CRC_writeheader(i,i.header[i.h_ptr].buf);var c=i.h_ptr;xt(i.header[c].ptr==8*i.sideinfo_len),i.h_ptr=c+1&Je.MAX_HEADER_BUF-1,i.header[i.h_ptr].write_timing=i.header[c].write_timing+t,i.h_ptr==i.w_ptr&&Et.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}function o(e,a){var r,n=pt.ht[a.count1table_select+32],s=0,i=a.big_values,o=a.big_values;for(xt(a.count1table_select<2),r=(a.count1-a.big_values)/4;r>0;--r){var l,c=0,_=0;0!=(l=a.l3_enc[i+0])&&(_+=8,a.xr[o+0]<0&&c++,xt(l<=1)),0!=(l=a.l3_enc[i+1])&&(_+=4,c*=2,a.xr[o+1]<0&&c++,xt(l<=1)),0!=(l=a.l3_enc[i+2])&&(_+=2,c*=2,a.xr[o+2]<0&&c++,xt(l<=1)),0!=(l=a.l3_enc[i+3])&&(_++,c*=2,a.xr[o+3]<0&&c++,xt(l<=1)),i+=4,o+=4,t(e,c+n.table[_],n.hlen[_]),s+=n.hlen[_]}return s}function l(e,a,r,n,s){var i=pt.ht[a],o=0;if(xt(a<32),0==a)return o;for(var l=r;l<n;l+=2){var c=0,_=0,f=i.xlen,u=i.xlen,p=0,h=s.l3_enc[l],d=s.l3_enc[l+1];if(0!=h&&(s.xr[l]<0&&p++,c--),a>15){if(h>14){var b=h-15;xt(b<=i.linmax),p|=b<<1,_=f,h=15}if(d>14){var v=d-15;xt(v<=i.linmax),p<<=f,p|=v,_+=f,d=15}u=16}0!=d&&(p<<=1,s.xr[l+1]<0&&p++,c--),xt((h|d)<16),h=h*u+d,_-=c,c+=i.hlen[h],xt(c<=m),xt(_<=m),t(e,i.table[h],c),t(e,p,_),o+=c+_}return o}function c(e,t){var a=3*e.scalefac_band.s[3];a>t.big_values&&(a=t.big_values);var r=l(e,t.table_select[0],0,a,t);return r+=l(e,t.table_select[1],a,t.big_values,t)}function _(e,t){var a,r,n,s;a=t.big_values,xt(0<=a&&a<=576);var i=t.region0_count+1;return xt(0<=i),xt(i<e.scalefac_band.l.length),n=e.scalefac_band.l[i],i+=t.region1_count+1,xt(0<=i),xt(i<e.scalefac_band.l.length),s=e.scalefac_band.l[i],n>a&&(n=a),s>a&&(s=a),r=l(e,t.table_select[0],0,n,t),r+=l(e,t.table_select[1],n,s,t),r+=l(e,t.table_select[2],s,a,t)}function f(e){var a,r,n,s,i=0,l=e.internal_flags,f=l.l3_side;if(1==e.version)for(a=0;a<2;a++)for(r=0;r<l.channels_out;r++){var u=f.tt[a][r],p=wt.slen1_tab[u.scalefac_compress],h=wt.slen2_tab[u.scalefac_compress];for(s=0,n=0;n<u.sfbdivide;n++)-1!=u.scalefac[n]&&(t(l,u.scalefac[n],p),s+=p);for(;n<u.sfbmax;n++)-1!=u.scalefac[n]&&(t(l,u.scalefac[n],h),s+=h);xt(s==u.part2_length),u.block_type==de.SHORT_TYPE?s+=c(l,u):s+=_(l,u),s+=o(l,u),xt(s==u.part2_3_length+u.part2_length),i+=s}else for(a=0,r=0;r<l.channels_out;r++){var d,m,u=f.tt[a][r],b=0;if(xt(null!=u.sfb_partition_table),s=0,n=0,m=0,u.block_type==de.SHORT_TYPE){for(;m<4;m++){var v=u.sfb_partition_table[m]/3,g=u.slen[m];for(d=0;d<v;d++,n++)t(l,Math.max(u.scalefac[3*n+0],0),g),t(l,Math.max(u.scalefac[3*n+1],0),g),t(l,Math.max(u.scalefac[3*n+2],0),g),b+=3*g}s+=c(l,u)}else{for(;m<4;m++){var v=u.sfb_partition_table[m],g=u.slen[m];for(d=0;d<v;d++,n++)t(l,Math.max(u.scalefac[n],0),g),b+=g}s+=_(l,u)}s+=o(l,u),xt(s==u.part2_3_length),xt(b==u.part2_length),i+=b+s}return i}function u(){this.total=0}function p(e,t){var a,r,n,s,i,o=e.internal_flags;return i=o.w_ptr,-1==(s=o.h_ptr-1)&&(s=Je.MAX_HEADER_BUF-1),a=o.header[s].write_timing-y,t.total=a,a>=0&&(r=1+s-i,s<i&&(r=1+s-i+Je.MAX_HEADER_BUF),a-=8*r*o.sideinfo_len),n=h.getframebits(e),a+=n,t.total+=n,t.total%8!=0?t.total=1+t.total/8:t.total=t.total/8,t.total+=T+1,a<0&&Et.err.println("strange error flushing buffer ... \n"),a}var h=this,d=32773,m=32,b=null,v=null,g=null,S=null;this.setModules=function(e,t,a,r){b=e,v=t,g=a,S=r};var R=null,y=0,T=0,M=0;this.getframebits=function(e){var t,a=e.internal_flags;return t=0!=a.bitrate_index?pt.bitrate_table[e.version][a.bitrate_index]:e.brate,xt(8<=t&&t<=640),8*(0|72e3*(e.version+1)*t/e.out_samplerate+a.padding)},this.CRC_writeheader=function(e,t){var a=65535;a=s(255&t[2],a),a=s(255&t[3],a);for(var r=6;r<e.sideinfo_len;r++)a=s(255&t[r],a);t[4]=byte(a>>8),t[5]=byte(255&a)},this.flush_bitstream=function(e){var t,a,n=e.internal_flags,s=n.h_ptr-1;if(-1==s&&(s=Je.MAX_HEADER_BUF-1),t=n.l3_side,!((a=p(e,new u))<0)){if(r(e,a),xt(n.header[s].write_timing+this.getframebits(e)==y),n.ResvSize=0,t.main_data_begin=0,n.findReplayGain){var i=b.GetTitleGain(n.rgdata);xt(NEQ(i,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),n.RadioGain=0|Math.floor(10*i+.5)}n.findPeakSample&&(n.noclipGainChange=0|Math.ceil(20*Math.log10(n.PeakSample/32767)*10),n.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?n.noclipScale=Math.floor(32767/n.PeakSample*100)/100:n.noclipScale=-1)}},this.add_dummy_byte=function(e,t,r){for(var n,s=e.internal_flags;r-- >0;)for(a(0,t,8),n=0;n<Je.MAX_HEADER_BUF;++n)s.header[n].write_timing+=8},this.format_bitstream=function(e){var t,a=e.internal_flags;t=a.l3_side;var n=this.getframebits(e);r(e,t.resvDrain_pre),i(e,n);var s=8*a.sideinfo_len;if(s+=f(e),r(e,t.resvDrain_post),s+=t.resvDrain_post,t.main_data_begin+=(n-s)/8,p(e,new u)!=a.ResvSize&&Et.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*t.main_data_begin!=a.ResvSize&&(Et.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*t.main_data_begin,a.ResvSize,t.resvDrain_post,t.resvDrain_pre,8*a.sideinfo_len,s-t.resvDrain_post-8*a.sideinfo_len,s,s%8,n),Et.err.println("This is a fatal error.  It has several possible causes:"),Et.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),Et.err.println(" 9%%  Your system is overclocked"),Et.err.println(" 1%%  bug in LAME encoding library"),a.ResvSize=8*t.main_data_begin),xt(y%8==0),y>1e9){var o;for(o=0;o<Je.MAX_HEADER_BUF;++o)a.header[o].write_timing-=y;y=0}return 0},this.copy_buffer=function(e,t,a,r,n){var s=T+1;if(s<=0)return 0;if(0!=r&&s>r)return-1;if(Et.arraycopy(R,0,t,a,s),T=-1,M=0,0!=n){var i=Pt(1);if(i[0]=e.nMusicCRC,S.updateMusicCRC(i,t,a,s),e.nMusicCRC=i[0],s>0&&(e.VBR_seek_table.nBytesWritten+=s),e.decode_on_the_fly)for(var o,l=Bt([2,1152]),c=s,_=-1;0!=_;)if(_=v.hip_decode1_unclipped(e.hip,t,a,c,l[0],l[1]),c=0,-1==_&&(_=0),_>0){if(xt(_<=1152),e.findPeakSample){for(o=0;o<_;o++)l[0][o]>e.PeakSample?e.PeakSample=l[0][o]:-l[0][o]>e.PeakSample&&(e.PeakSample=-l[0][o]);if(e.channels_out>1)for(o=0;o<_;o++)l[1][o]>e.PeakSample?e.PeakSample=l[1][o]:-l[1][o]>e.PeakSample&&(e.PeakSample=-l[1][o])}if(e.findReplayGain&&b.AnalyzeSamples(e.rgdata,l[0],0,l[1],0,_,e.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}return s},this.init_bit_stream_w=function(e){R=kt(Lame.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,T=-1,M=0,y=0}}function R(){function e(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=Dt(de.SBMAX_l),this.bo_s_weight=Dt(de.SBMAX_s)}function t(){this.lowerlimit=0}function a(e,t){this.lowpass=t}function r(e){var t;return e.class_id=L,t=e.internal_flags=new Je,e.mode=MPEGMode.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=It.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=de.ENCDELAY+de.POSTDELAY,e.encoder_padding=0,t.mf_size=de.ENCDELAY-de.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0}function n(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function s(e,t){var a=44100;return t>=48e3?a=48e3:t>=44100?a=44100:t>=32e3?a=32e3:t>=24e3?a=24e3:t>=22050?a=22050:t>=16e3?a=16e3:t>=12e3?a=12e3:t>=11025?a=11025:t>=8e3&&(a=8e3),-1==e?a:(e<=15960&&(a=44100),e<=15250&&(a=32e3),e<=11220&&(a=24e3),e<=9970&&(a=22050),e<=7230&&(a=16e3),e<=5420&&(a=12e3),e<=4510&&(a=11025),e<=3970&&(a=8e3),t<a?t>44100?48e3:t>32e3?44100:t>24e3?32e3:t>22050?24e3:t>16e3?22050:t>12e3?16e3:t>11025?12e3:t>8e3?11025:8e3:a)}function i(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:return t.version=0,0;case 24e3:return t.version=0,1;case 16e3:return t.version=0,2;case 11025:return t.version=0,0;case 12e3:return t.version=0,1;case 8e3:return t.version=0,2;default:return t.version=0,-1}}function o(e,t,a){a<16e3&&(t=2);for(var r=pt.bitrate_table[t][1],n=2;n<=14;n++)pt.bitrate_table[t][n]>0&&Math.abs(pt.bitrate_table[t][n]-e)<Math.abs(r-e)&&(r=pt.bitrate_table[t][n]);return r}function l(e,t,a){a<16e3&&(t=2);for(var r=0;r<=14;r++)if(pt.bitrate_table[t][r]>0&&pt.bitrate_table[t][r]==e)return r;return-1}function c(e,t){var r=[new a(8,2e3),new a(16,3700),new a(24,3900),new a(32,5500),new a(40,7e3),new a(48,7500),new a(56,1e4),new a(64,11e3),new a(80,13500),new a(96,15100),new a(112,15600),new a(128,17e3),new a(160,17500),new a(192,18600),new a(224,19400),new a(256,19700),new a(320,20500)],n=M.nearestBitrateFullIndex(t);e.lowerlimit=r[n].lowpass}function _(e){var t=e.internal_flags,a=32,r=-1;if(t.lowpass1>0){for(var s=999,i=0;i<=31;i++)(_=i/31)>=t.lowpass2&&(a=Math.min(a,i)),t.lowpass1<_&&_<t.lowpass2&&(s=Math.min(s,i));t.lowpass1=999==s?(a-.75)/31:(s-.75)/31,t.lowpass2=a/31}if(t.highpass2>0&&t.highpass2<.75/31*.9&&(t.highpass1=0,t.highpass2=0,Ot.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),t.highpass2>0){for(var o=-1,i=0;i<=31;i++)(_=i/31)<=t.highpass1&&(r=Math.max(r,i)),t.highpass1<_&&_<t.highpass2&&(o=Math.max(o,i));t.highpass1=r/31,t.highpass2=-1==o?(r+.75)/31:(o+.75)/31}for(i=0;i<32;i++){var l,c,_=i/31;l=t.highpass2>t.highpass1?n((t.highpass2-_)/(t.highpass2-t.highpass1+1e-20)):1,c=t.lowpass2>t.lowpass1?n((_-t.lowpass1)/(t.lowpass2-t.lowpass1+1e-20)):1,t.amp_filter[i]=l*c}}function f(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}function u(e){var t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&C.id3tag_write_v2(e),t.bitrate_stereoMode_Hist=Nt([16,5]),t.bitrate_blockType_Hist=Nt([16,6]),t.PeakSample=0,e.bWriteVbrTag&&P.InitVbrTag(e)}function p(e,t){(null==e.in_buffer_0||e.in_buffer_nsamples<t)&&(e.in_buffer_0=Dt(t),e.in_buffer_1=Dt(t),e.in_buffer_nsamples=t)}function h(e){var t=de.BLKSIZE+e.framesize-de.FFTOFFSET;return t=Math.max(t,512+e.framesize-32),Ht(Je.MFSIZE>=t),t}function d(e,t,a,r,n,s,i){var o,l,c,_,f,u=e.internal_flags,p=0,d=[null,null],v=[null,null];if(u.Class_ID!=L)return-3;if(0==r)return 0;if((f=E.copy_buffer(u,n,s,i,0))<0)return f;if(s+=f,p+=f,v[0]=t,v[1]=a,Ct.NEQ(e.scale,0)&&Ct.NEQ(e.scale,1))for(l=0;l<r;++l)v[0][l]*=e.scale,2==u.channels_out&&(v[1][l]*=e.scale);if(Ct.NEQ(e.scale_left,0)&&Ct.NEQ(e.scale_left,1))for(l=0;l<r;++l)v[0][l]*=e.scale_left;if(Ct.NEQ(e.scale_right,0)&&Ct.NEQ(e.scale_right,1))for(l=0;l<r;++l)v[1][l]*=e.scale_right;if(2==e.num_channels&&1==u.channels_out)for(l=0;l<r;++l)v[0][l]=.5*(v[0][l]+v[1][l]),v[1][l]=0;_=h(e),d[0]=u.mfbuf[0],d[1]=u.mfbuf[1];for(var g=0;r>0;){var S=[null,null],R=0,y=0;S[0]=v[0],S[1]=v[1];var M=new b;if(T(e,d,S,g,r,M),R=M.n_in,y=M.n_out,u.findReplayGain&&!u.decode_on_the_fly&&w.AnalyzeSamples(u.rgdata,d[0],u.mf_size,d[1],u.mf_size,y,u.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(r-=R,g+=R,u.channels_out,u.mf_size+=y,Ht(u.mf_size<=Je.MFSIZE),u.mf_samples_to_encode<1&&(u.mf_samples_to_encode=de.ENCDELAY+de.POSTDELAY),u.mf_samples_to_encode+=y,u.mf_size>=_){var A=i-p;if(0==i&&(A=0),(o=m(e,d[0],d[1],n,s,A))<0)return o;for(s+=o,p+=o,u.mf_size-=e.framesize,u.mf_samples_to_encode-=e.framesize,c=0;c<u.channels_out;c++)for(l=0;l<u.mf_size;l++)d[c][l]=d[c][l+e.framesize]}}return Ht(0==r),p}function m(e,t,a,r,n,s){var i=M.enc.lame_encode_mp3_frame(e,t,a,r,n,s);return e.frameNum++,i}function b(){this.n_in=0,this.n_out=0}function v(){this.num_used=0}function g(e,t){return 0!=t?g(t,e%t):e}function S(e,t,a){var r=Math.PI*t;(e/=a)<0&&(e=0),e>1&&(e=1);var n=e-.5,s=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(n)<1e-9?r/Math.PI:s*Math.sin(a*r*n)/(Math.PI*a*n)}function y(e,t,a,r,n,s,i,o,l){var c,_,f=e.internal_flags,u=0,p=e.out_samplerate/g(e.out_samplerate,e.in_samplerate);p>Je.BPC&&(p=Je.BPC);var h=Math.abs(f.resample_ratio-Math.floor(.5+f.resample_ratio))<1e-4?1:0,d=1/f.resample_ratio;d>1&&(d=1);var m=31;0==m%2&&--m;var b=(m+=h)+1;if(0==f.fill_buffer_resample_init){for(f.inbuf_old[0]=Dt(b),f.inbuf_old[1]=Dt(b),c=0;c<=2*p;++c)f.blackfilt[c]=Dt(b);for(f.itime[0]=0,f.itime[1]=0,u=0;u<=2*p;u++){var v=0,R=(u-p)/(2*p);for(c=0;c<=m;c++)v+=f.blackfilt[u][c]=S(c-R,d,m);for(c=0;c<=m;c++)f.blackfilt[u][c]/=v}f.fill_buffer_resample_init=1}var y=f.inbuf_old[l];for(_=0;_<r;_++){var T,M;if(T=_*f.resample_ratio,u=0|Math.floor(T-f.itime[l]),m+u-m/2>=i)break;R=T-f.itime[l]-(u+m%2*.5);Ht(Math.abs(R)<=.501),M=0|Math.floor(2*R*p+p+.5);var w=0;for(c=0;c<=m;++c){var E=c+u-m/2;Ht(E<i),Ht(E+b>=0),w+=(E<0?y[b+E]:n[s+E])*f.blackfilt[M][c]}t[a+_]=w}if(o.num_used=Math.min(i,m+u-m/2),f.itime[l]+=o.num_used-_*f.resample_ratio,o.num_used>=b)for(c=0;c<b;c++)y[c]=n[s+o.num_used+c-b];else{var A=b-o.num_used;for(c=0;c<A;++c)y[c]=y[c+o.num_used];for(u=0;c<b;++c,++u)y[c]=n[s+u];Ht(u==o.num_used)}return _}function T(e,t,a,r,n,s){var i=e.internal_flags;if(i.resample_ratio<.9999||i.resample_ratio>1.0001)for(var o=0;o<i.channels_out;o++){var l=new v;s.n_out=y(e,t[o],i.mf_size,e.framesize,a[o],r,n,l,o),s.n_in=l.num_used}else{s.n_out=Math.min(e.framesize,n),s.n_in=s.n_out;for(var c=0;c<s.n_out;++c)t[0][i.mf_size+c]=a[0][r+c],2==i.channels_out&&(t[1][i.mf_size+c]=a[1][r+c])}}var M=this;R.V9=410,R.V8=420,R.V7=430,R.V6=440,R.V5=450,R.V4=460,R.V3=470,R.V2=480,R.V1=490,R.V0=500,R.R3MIX=1e3,R.STANDARD=1001,R.EXTREME=1002,R.INSANE=1003,R.STANDARD_FAST=1004,R.EXTREME_FAST=1005,R.MEDIUM=1006,R.MEDIUM_FAST=1007;R.LAME_MAXMP3BUFFER=147456;var w,E,A,k,B,P,x,C,O,I=new ke;this.enc=new de,this.setModules=function(e,t,a,r,n,s,i,o,l){w=e,E=t,A=a,k=r,B=n,P=s,x=i,C=o,O=l,this.enc.setModules(E,I,k,P)};var L=4294479419;this.lame_init=function(){var e=new Pe;return 0!=r(e)?null:(e.lame_allocated_gfp=1,e)},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],a=0,r=0,n=0,s=0;s=t[16],n=16,r=t[16],a=16;for(var i=0;i<16;i++)if(Math.max(e,t[i+1])!=e){s=t[i+1],n=i+1,r=t[i],a=i;break}return s-e>e-r?a:n},this.lame_init_params=function(a){var r=a.internal_flags;if(r.Class_ID=0,null==r.ATH&&(r.ATH=new et),null==r.PSY&&(r.PSY=new e),null==r.rgdata&&(r.rgdata=new it),r.channels_in=a.num_channels,1==r.channels_in&&(a.mode=MPEGMode.MONO),r.channels_out=a.mode==MPEGMode.MONO?1:2,r.mode_ext=de.MPG_MD_MS_LR,a.mode==MPEGMode.MONO&&(a.force_ms=!1),a.VBR==It.vbr_off&&128!=a.VBR_mean_bitrate_kbps&&0==a.brate&&(a.brate=a.VBR_mean_bitrate_kbps),a.VBR==It.vbr_off||a.VBR==It.vbr_mtrh||a.VBR==It.vbr_mt||(a.free_format=!1),a.VBR==It.vbr_off&&0==a.brate&&Ct.EQ(a.compression_ratio,0)&&(a.compression_ratio=11.025),a.VBR==It.vbr_off&&a.compression_ratio>0&&(0==a.out_samplerate&&(a.out_samplerate=map2MP3Frequency(int(.97*a.in_samplerate))),a.brate=0|16*a.out_samplerate*r.channels_out/(1e3*a.compression_ratio),r.samplerate_index=i(a.out_samplerate,a),a.free_format||(a.brate=o(a.brate,a.version,a.out_samplerate))),0!=a.out_samplerate&&(a.out_samplerate<16e3?(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,8),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,64)):a.out_samplerate<32e3?(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,8),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,160)):(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,32),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,320))),0==a.lowpassfreq){var n=16e3;switch(a.VBR){case It.vbr_off:c(p=new t,a.brate),n=p.lowerlimit;break;case It.vbr_abr:var p=new t;c(p,a.VBR_mean_bitrate_kbps),n=p.lowerlimit;break;case It.vbr_rh:b=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=a.VBR_q&&a.VBR_q<=9){var h=b[a.VBR_q],d=b[a.VBR_q+1],m=a.VBR_q_frac;n=linear_int(h,d,m)}else n=19500;break;default:var b=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=a.VBR_q&&a.VBR_q<=9){var h=b[a.VBR_q],d=b[a.VBR_q+1],m=a.VBR_q_frac;n=linear_int(h,d,m)}else n=19500}a.mode!=MPEGMode.MONO||a.VBR!=It.vbr_off&&a.VBR!=It.vbr_abr||(n*=1.5),a.lowpassfreq=0|n}if(0==a.out_samplerate&&(2*a.lowpassfreq>a.in_samplerate&&(a.lowpassfreq=a.in_samplerate/2),a.out_samplerate=s(0|a.lowpassfreq,a.in_samplerate)),a.lowpassfreq=Math.min(20500,a.lowpassfreq),a.lowpassfreq=Math.min(a.out_samplerate/2,a.lowpassfreq),a.VBR==It.vbr_off&&(a.compression_ratio=16*a.out_samplerate*r.channels_out/(1e3*a.brate)),a.VBR==It.vbr_abr&&(a.compression_ratio=16*a.out_samplerate*r.channels_out/(1e3*a.VBR_mean_bitrate_kbps)),a.bWriteVbrTag||(a.findReplayGain=!1,a.decode_on_the_fly=!1,r.findPeakSample=!1),r.findReplayGain=a.findReplayGain,r.decode_on_the_fly=a.decode_on_the_fly,r.decode_on_the_fly&&(r.findPeakSample=!0),r.findReplayGain&&w.InitGainAnalysis(r.rgdata,a.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return a.internal_flags=null,-6;switch(r.decode_on_the_fly&&!a.decode_only&&(null!=r.hip&&O.hip_decode_exit(r.hip),r.hip=O.hip_decode_init()),r.mode_gr=a.out_samplerate<=24e3?1:2,a.framesize=576*r.mode_gr,a.encoder_delay=de.ENCDELAY,r.resample_ratio=a.in_samplerate/a.out_samplerate,a.VBR){case It.vbr_mt:case It.vbr_rh:case It.vbr_mtrh:var v=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];a.compression_ratio=v[a.VBR_q];break;case It.vbr_abr:a.compression_ratio=16*a.out_samplerate*r.channels_out/(1e3*a.VBR_mean_bitrate_kbps);break;default:a.compression_ratio=16*a.out_samplerate*r.channels_out/(1e3*a.brate)}if(a.mode==MPEGMode.NOT_SET&&(a.mode=MPEGMode.JOINT_STEREO),a.highpassfreq>0?(r.highpass1=2*a.highpassfreq,a.highpasswidth>=0?r.highpass2=2*(a.highpassfreq+a.highpasswidth):r.highpass2=2*a.highpassfreq,r.highpass1/=a.out_samplerate,r.highpass2/=a.out_samplerate):(r.highpass1=0,r.highpass2=0),a.lowpassfreq>0?(r.lowpass2=2*a.lowpassfreq,a.lowpasswidth>=0?(r.lowpass1=2*(a.lowpassfreq-a.lowpasswidth),r.lowpass1<0&&(r.lowpass1=0)):r.lowpass1=2*a.lowpassfreq,r.lowpass1/=a.out_samplerate,r.lowpass2/=a.out_samplerate):(r.lowpass1=0,r.lowpass2=0),_(a),r.samplerate_index=i(a.out_samplerate,a),r.samplerate_index<0)return a.internal_flags=null,-1;if(a.VBR==It.vbr_off){if(a.free_format)r.bitrate_index=0;else if(a.brate=o(a.brate,a.version,a.out_samplerate),r.bitrate_index=l(a.brate,a.version,a.out_samplerate),r.bitrate_index<=0)return a.internal_flags=null,-1}else r.bitrate_index=1;a.analysis&&(a.bWriteVbrTag=!1),null!=r.pinfo&&(a.bWriteVbrTag=!1),E.init_bit_stream_w(r);for(var g=r.samplerate_index+3*a.version+6*(a.out_samplerate<16e3?1:0),S=0;S<de.SBMAX_l+1;S++)r.scalefac_band.l[S]=k.sfBandIndex[g].l[S];for(S=0;S<de.PSFB21+1;S++){var R=(r.scalefac_band.l[22]-r.scalefac_band.l[21])/de.PSFB21,y=r.scalefac_band.l[21]+S*R;r.scalefac_band.psfb21[S]=y}r.scalefac_band.psfb21[de.PSFB21]=576;for(S=0;S<de.SBMAX_s+1;S++)r.scalefac_band.s[S]=k.sfBandIndex[g].s[S];for(S=0;S<de.PSFB12+1;S++){var R=(r.scalefac_band.s[13]-r.scalefac_band.s[12])/de.PSFB12,y=r.scalefac_band.s[12]+S*R;r.scalefac_band.psfb12[S]=y}r.scalefac_band.psfb12[de.PSFB12]=192,1==a.version?r.sideinfo_len=1==r.channels_out?21:36:r.sideinfo_len=1==r.channels_out?13:21,a.error_protection&&(r.sideinfo_len+=2),u(a),r.Class_ID=L;var T;for(T=0;T<19;T++)r.nsPsy.pefirbuf[T]=700*r.mode_gr*r.channels_out;switch(-1==a.ATHtype&&(a.ATHtype=4),Ht(a.VBR_q<=9),Ht(a.VBR_q>=0),a.VBR){case It.vbr_mt:a.VBR=It.vbr_mtrh;case It.vbr_mtrh:null==a.useTemporal&&(a.useTemporal=!1),A.apply_preset(a,500-10*a.VBR_q,0),a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),a.quality<5&&(a.quality=0),a.quality>5&&(a.quality=5),r.PSY.mask_adjust=a.maskingadjust,r.PSY.mask_adjust_short=a.maskingadjust_short,a.experimentalY?r.sfb21_extra=!1:r.sfb21_extra=a.out_samplerate>44e3,r.iteration_loop=new VBRNewIterationLoop(B);break;case It.vbr_rh:A.apply_preset(a,500-10*a.VBR_q,0),r.PSY.mask_adjust=a.maskingadjust,r.PSY.mask_adjust_short=a.maskingadjust_short,a.experimentalY?r.sfb21_extra=!1:r.sfb21_extra=a.out_samplerate>44e3,a.quality>6&&(a.quality=6),a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),r.iteration_loop=new VBROldIterationLoop(B);break;default:var M;r.sfb21_extra=!1,a.quality<0&&(a.quality=LAME_DEFAULT_QUALITY),(M=a.VBR)==It.vbr_off&&(a.VBR_mean_bitrate_kbps=a.brate),A.apply_preset(a,a.VBR_mean_bitrate_kbps,0),a.VBR=M,r.PSY.mask_adjust=a.maskingadjust,r.PSY.mask_adjust_short=a.maskingadjust_short,M==It.vbr_off?r.iteration_loop=new ft(B):r.iteration_loop=new ABRIterationLoop(B)}if(Ht(a.scale>=0),a.VBR!=It.vbr_off){if(r.VBR_min_bitrate=1,r.VBR_max_bitrate=14,a.out_samplerate<16e3&&(r.VBR_max_bitrate=8),0!=a.VBR_min_bitrate_kbps&&(a.VBR_min_bitrate_kbps=o(a.VBR_min_bitrate_kbps,a.version,a.out_samplerate),r.VBR_min_bitrate=l(a.VBR_min_bitrate_kbps,a.version,a.out_samplerate),r.VBR_min_bitrate<0))return-1;if(0!=a.VBR_max_bitrate_kbps&&(a.VBR_max_bitrate_kbps=o(a.VBR_max_bitrate_kbps,a.version,a.out_samplerate),r.VBR_max_bitrate=l(a.VBR_max_bitrate_kbps,a.version,a.out_samplerate),r.VBR_max_bitrate<0))return-1;a.VBR_min_bitrate_kbps=pt.bitrate_table[a.version][r.VBR_min_bitrate],a.VBR_max_bitrate_kbps=pt.bitrate_table[a.version][r.VBR_max_bitrate],a.VBR_mean_bitrate_kbps=Math.min(pt.bitrate_table[a.version][r.VBR_max_bitrate],a.VBR_mean_bitrate_kbps),a.VBR_mean_bitrate_kbps=Math.max(pt.bitrate_table[a.version][r.VBR_min_bitrate],a.VBR_mean_bitrate_kbps)}return a.tune&&(r.PSY.mask_adjust+=a.tune_value_a,r.PSY.mask_adjust_short+=a.tune_value_a),f(a),Ht(a.scale>=0),a.athaa_type<0?r.ATH.useAdjust=3:r.ATH.useAdjust=a.athaa_type,r.ATH.aaSensitivityP=Math.pow(10,a.athaa_sensitivity/-10),null==a.short_blocks&&(a.short_blocks=Lt.short_block_allowed),a.short_blocks!=Lt.short_block_allowed||a.mode!=MPEGMode.JOINT_STEREO&&a.mode!=MPEGMode.STEREO||(a.short_blocks=Lt.short_block_coupled),a.quant_comp<0&&(a.quant_comp=1),a.quant_comp_short<0&&(a.quant_comp_short=0),a.msfix<0&&(a.msfix=0),a.exp_nspsytune=1|a.exp_nspsytune,a.internal_flags.nsPsy.attackthre<0&&(a.internal_flags.nsPsy.attackthre=ke.NSATTACKTHRE),a.internal_flags.nsPsy.attackthre_s<0&&(a.internal_flags.nsPsy.attackthre_s=ke.NSATTACKTHRE_S),Ht(a.scale>=0),a.scale<0&&(a.scale=1),a.ATHtype<0&&(a.ATHtype=4),a.ATHcurve<0&&(a.ATHcurve=4),a.athaa_loudapprox<0&&(a.athaa_loudapprox=2),a.interChRatio<0&&(a.interChRatio=0),null==a.useTemporal&&(a.useTemporal=!0),r.slot_lag=r.frac_SpF=0,a.VBR==It.vbr_off&&(r.slot_lag=r.frac_SpF=72e3*(a.version+1)*a.brate%a.out_samplerate|0),k.iteration_init(a),I.psymodel_init(a),Ht(a.scale>=0),0},this.lame_encode_flush=function(e,t,a,r){var n,s,i,o,l=e.internal_flags,c=Vt([2,1152]),_=0,f=l.mf_samples_to_encode-de.POSTDELAY,u=h(e);if(l.mf_samples_to_encode<1)return 0;for(n=0,e.in_samplerate!=e.out_samplerate&&(f+=16*e.out_samplerate/e.in_samplerate),(i=e.framesize-f%e.framesize)<576&&(i+=e.framesize),e.encoder_padding=i,o=(f+i)/e.framesize;o>0&&_>=0;){var p=u-l.mf_size,d=e.frameNum;p*=e.in_samplerate,(p/=e.out_samplerate)>1152&&(p=1152),p<1&&(p=1),s=r-n,0==r&&(s=0),a+=_=this.lame_encode_buffer(e,c[0],c[1],p,t,a,s),n+=_,o-=d!=e.frameNum?1:0}if(l.mf_samples_to_encode=0,_<0)return _;if(s=r-n,0==r&&(s=0),E.flush_bitstream(e),(_=E.copy_buffer(l,t,a,s,1))<0)return _;if(a+=_,n+=_,s=r-n,0==r&&(s=0),e.write_id3tag_automatic){if(C.id3tag_write_v1(e),(_=E.copy_buffer(l,t,a,s,0))<0)return _;n+=_}return n},this.lame_encode_buffer=function(e,t,a,r,n,s,i){var o=e.internal_flags,l=[null,null];if(o.Class_ID!=L)return-3;if(0==r)return 0;p(o,r),l[0]=o.in_buffer_0,l[1]=o.in_buffer_1;for(var c=0;c<r;c++)l[0][c]=t[c],o.channels_in>1&&(l[1][c]=a[c]);return d(e,l[0],l[1],r,n,s,i)}}function y(){function e(e,t){if(e.nVbrNumFrames++,e.sum+=t,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var a=1;a<e.size;a+=2)e.bag[a/2]=e.bag[a];e.want*=2,e.pos/=2}}function t(e,t){if(!(e.pos<=0))for(var a=1;a<h;++a){var r,n,s=a/h,i=0|Math.floor(s*e.pos);i>e.pos-1&&(i=e.pos-1);var o=0|256*(r=e.bag[i])/(n=e.sum);o>255&&(o=255),t[a]=255&o}}function a(e,t){var a=255&e[t+0];return a<<=8,a|=255&e[t+1],a<<=8,a|=255&e[t+2],a<<=8,a|=255&e[t+3]}function r(e,t,a){e[t+0]=255&a>>24,e[t+1]=255&a>>16,e[t+2]=255&a>>8,e[t+3]=255&a}function n(e,t,a){e[t+0]=255&a>>8,e[t+1]=255&a}function s(e,t){return new String(e,t,R.length(),S).equals(R)||new String(e,t,T.length(),S).equals(T)}function i(e,t,a){return 255&(e<<t|a&~(-1<<t))}function o(e,t){var a=e.internal_flags;t[0]=i(t[0],8,255),t[1]=i(t[1],3,7),t[1]=i(t[1],1,e.out_samplerate<16e3?0:1),t[1]=i(t[1],1,e.version),t[1]=i(t[1],2,1),t[1]=i(t[1],1,e.error_protection?0:1),t[2]=i(t[2],4,a.bitrate_index),t[2]=i(t[2],2,a.samplerate_index),t[2]=i(t[2],1,0),t[2]=i(t[2],1,e.extension),t[3]=i(t[3],2,e.mode.ordinal()),t[3]=i(t[3],2,a.mode_ext),t[3]=i(t[3],1,e.copyright),t[3]=i(t[3],1,e.original),t[3]=i(t[3],2,e.emphasis),t[0]=255;var r,n=241&t[1];r=1==e.version?b:e.out_samplerate<16e3?g:v,e.VBR==aa.vbr_off&&(r=e.brate);var s;s=e.free_format?0:255&16*f.BitrateIndex(r,e.version,e.out_samplerate),1==e.version?(t[1]=255&(10|n),n=13&t[2],t[2]=255&(s|n)):(t[1]=255&(2|n),n=13&t[2],t[2]=255&(s|n))}function l(e,t){return t=t>>8^M[255&(t^e)]}function c(e,t,a,s,i){var o,c,_,f=e.internal_flags,u=0,h=e.encoder_delay,d=e.encoder_padding,m=100-10*e.VBR_q-e.quality,b=p.getLameVeryShortVersion(),v=[1,5,3,2,4,0,3],g=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),S=0,R=0,y=e.internal_flags.noise_shaping,T=0,M=0,w=0,E=0,A=0,k=0!=(1&e.exp_nspsytune),B=0!=(2&e.exp_nspsytune),P=!1,x=!1,C=e.internal_flags.nogap_total,O=e.internal_flags.nogap_current,I=e.ATHtype,L=0;switch(e.VBR){case vbr_abr:_=e.VBR_mean_bitrate_kbps;break;case vbr_off:_=e.brate;break;default:_=e.VBR_min_bitrate_kbps}switch(o=e.VBR.ordinal()<v.length?v[e.VBR.ordinal()]:0,c=0+o,f.findReplayGain&&(f.RadioGain>510&&(f.RadioGain=510),f.RadioGain<-510&&(f.RadioGain=-510),R=8192,R|=3072,f.RadioGain>=0?R|=f.RadioGain:(R|=512,R|=-f.RadioGain)),f.findPeakSample&&(S=Math.abs(0|f.PeakSample/32767*Math.pow(2,23)+.5)),-1!=C&&(O>0&&(x=!0),O<C-1&&(P=!0)),L=I+((k?1:0)<<4)+((B?1:0)<<5)+((P?1:0)<<6)+((x?1:0)<<7),m<0&&(m=0),e.mode){case MONO:T=0;break;case STEREO:T=1;break;case DUAL_CHANNEL:T=2;break;case JOINT_STEREO:T=e.force_ms?4:3;break;case NOT_SET:default:T=7}w=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==ra.short_block_forced||e.short_blocks==ra.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==I||e.in_samplerate<=32e3)&&(M=1),E=y+(T<<2)+(M<<5)+(w<<6),A=f.nMusicCRC,r(a,s+u,m),u+=4;for(var D=0;D<9;D++)a[s+u+D]=255&b.charAt(D);a[s+(u+=9)]=255&c,a[s+ ++u]=255&g,r(a,s+ ++u,S),n(a,s+(u+=4),R),n(a,s+(u+=2),0),a[s+(u+=2)]=255&L,a[s+ ++u]=_>=255?255:255&_,a[s+ ++u]=255&h>>4,a[s+u+1]=255&(h<<4)+(d>>8),a[s+u+2]=255&d,a[s+(u+=3)]=255&E,u++,a[s+u++]=0,n(a,s+u,e.preset),r(a,s+(u+=2),t),n(a,s+(u+=4),A),u+=2;for(var N=0;N<u;N++)i=l(a[s+N],i);return n(a,s+u,i),u+=2}function _(e){e.seek(0);var t=sa(10);e.readFully(t);return new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}var f,u,p;this.setModules=function(e,t,a){f=e,u=t,p=a};var h=y.NUMTOCENTRIES,d=y.MAXFRAMESIZE,m=h+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2,b=128,v=64,g=32,S=null,R="Xing",T="Info",M=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];this.addVbrFrame=function(t){var a=t.internal_flags,r=Tables.bitrate_table[t.version][a.bitrate_index];ia(null!=a.VBR_seek_table.bag),e(a.VBR_seek_table,r)},this.getVbrTag=function(e){var t=new VBRTagData,r=0;t.flags=0;var n=e[r+1]>>3&1,i=e[r+2]>>2&3,o=e[r+3]>>6&3,l=e[r+2]>>4&15;if(l=Tables.bitrate_table[n][l],e[r+1]>>4==14?t.samprate=Tables.samplerate_table[2][i]:t.samprate=Tables.samplerate_table[n][i],r+=0!=n?3!=o?36:21:3!=o?21:13,!s(e,r))return null;r+=4,t.hId=n;var c=t.flags=a(e,r);if(r+=4,0!=(1&c)&&(t.frames=a(e,r),r+=4),0!=(2&c)&&(t.bytes=a(e,r),r+=4),0!=(4&c)){if(null!=t.toc)for(var _=0;_<h;_++)t.toc[_]=e[r+_];r+=h}t.vbrScale=-1,0!=(8&c)&&(t.vbrScale=a(e,r),r+=4),t.headersize=72e3*(n+1)*l/t.samprate;var f=e[(r+=21)+0]<<4;f+=e[r+1]>>4;var u=(15&e[r+1])<<8;return u+=255&e[r+2],(f<0||f>3e3)&&(f=-1),(u<0||u>3e3)&&(u=-1),t.encDelay=f,t.encPadding=u,t},this.InitVbrTag=function(e){var t,a=e.internal_flags;t=1==e.version?b:e.out_samplerate<16e3?g:v,e.VBR==aa.vbr_off&&(t=e.brate);var r=72e3*(e.version+1)*t/e.out_samplerate,n=a.sideinfo_len+m;if(a.VBR_seek_table.TotalFrameSize=r,r<n||r>d)e.bWriteVbrTag=!1;else{a.VBR_seek_table.nVbrNumFrames=0,a.VBR_seek_table.nBytesWritten=0,a.VBR_seek_table.sum=0,a.VBR_seek_table.seen=0,a.VBR_seek_table.want=1,a.VBR_seek_table.pos=0,null==a.VBR_seek_table.bag&&(a.VBR_seek_table.bag=new int[400],a.VBR_seek_table.size=400);var s=sa(d);o(e,s);for(var i=a.VBR_seek_table.TotalFrameSize,l=0;l<i;++l)u.add_dummy_byte(e,255&s[l],1)}},this.updateMusicCRC=function(e,t,a,r){for(var n=0;n<r;++n)e[0]=l(t[a+n],e[0])},this.getLameTagFrame=function(e,a){var n=e.internal_flags;if(!e.bWriteVbrTag)return 0;if(n.Class_ID!=Lame.LAME_ID)return 0;if(n.VBR_seek_table.pos<=0)return 0;if(a.length<n.VBR_seek_table.TotalFrameSize)return n.VBR_seek_table.TotalFrameSize;na.fill(a,0,n.VBR_seek_table.TotalFrameSize,0),o(e,a);var s=sa(h);if(e.free_format)for(p=1;p<h;++p)s[p]=255&255*p/100;else t(n.VBR_seek_table,s);var i=n.sideinfo_len;e.error_protection&&(i-=2),e.VBR==aa.vbr_off?(a[i++]=255&T.charAt(0),a[i++]=255&T.charAt(1),a[i++]=255&T.charAt(2),a[i++]=255&T.charAt(3)):(a[i++]=255&R.charAt(0),a[i++]=255&R.charAt(1),a[i++]=255&R.charAt(2),a[i++]=255&R.charAt(3)),r(a,i,15),r(a,i+=4,n.VBR_seek_table.nVbrNumFrames),i+=4;var _=n.VBR_seek_table.nBytesWritten+n.VBR_seek_table.TotalFrameSize;r(a,i,0|_),i+=4,ta.arraycopy(s,0,a,i,s.length),i+=s.length,e.error_protection&&u.CRC_writeheader(n,a);for(var f=0,p=0;p<i;p++)f=l(a[p],f);return i+=c(e,_,a,i,f),n.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(e,t){if(e.internal_flags.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var a=_(t);t.seek(a);var r=sa(d),n=getLameTagFrame(e,r);return n>r.length?-1:n<1?0:(t.write(r,0,n),0)}}function T(){var e,t;this.setModules=function(a,r){e=a,t=r}}function M(){var e,t,a;this.setModules=function(r,n,s){e=r,t=n,a=s}}function w(){}function E(){var e,t;this.setModules=function(a,r){e=a,t=r}}function A(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function k(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}var B="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},P=!0,x=!0,C={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(P=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(x=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(P)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){x&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,a){var r=e.match(t);return r&&r.length>=a&&parseInt(r[a],10)},detectBrowser:function(e){var t=e&&e.navigator,a={};if(a.browser=null,a.version=null,void 0===e||!e.navigator)return a.browser="Not a browser.",a;if(t.mozGetUserMedia)a.browser="firefox",a.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)a.browser="chrome",a.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return a.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",a;a.browser="safari",a.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))a.browser="edge",a.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return a.browser="Not a supported browser.",a;a.browser="safari",a.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return a},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype){var a=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),n=new Map,s=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++s;return n.set(t,e),C.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return a(e)},t.revokeObjectURL=function(e){r(e),n.delete(e)};var i=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return i.get.apply(this)},set:function(e){return this.srcObject=n.get(e)||null,i.set.apply(this,[e])}});var o=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=n.get(arguments[1])||null),o.apply(this,arguments)}}}},O={log:C.log,deprecated:C.deprecated,disableLog:C.disableLog,disableWarnings:C.disableWarnings,extractVersion:C.extractVersion,shimCreateObjectURL:C.shimCreateObjectURL,detectBrowser:C.detectBrowser.bind(C)},I=O.log,L=O.log,D={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){var a=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=t),this.addEventListener("addstream",this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var n;n=e.RTCPeerConnection.prototype.getReceivers?a.getReceivers().find(function(e){return e.track.id===r.track.id}):{track:r.track};var s=new Event("track");s.track=r.track,s.receiver=n,s.streams=[t.stream],a.dispatchEvent(s)}),t.stream.getTracks().forEach(function(r){var n;n=e.RTCPeerConnection.prototype.getReceivers?a.getReceivers().find(function(e){return e.track.id===r.id}):{track:r};var s=new Event("track");s.track=r,s.receiver=n,s.streams=[t.stream],this.dispatchEvent(s)}.bind(this))}.bind(this))}})},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders||[]};var t=e.RTCPeerConnection.prototype.addStream,a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.addTrack||(e.RTCPeerConnection.prototype.addTrack=function(t,a){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r._senders=r._senders||[],r._senders.find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{};var s=r._streams[a.id];if(s)s.addTrack(t),r.removeStream(s),r.addStream(s);else{var i=new e.MediaStream([t]);r._streams[a.id]=i,r.addStream(i)}var o={track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=r.createDTMFSender(t):this._dtmf=null),this._dtmf}};return r._senders.push(o),o}),e.RTCPeerConnection.prototype.addStream=function(e){var a=this;a._senders=a._senders||[],t.apply(a,[e]),e.getTracks().forEach(function(e){a._senders.push({track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=a.createDTMFSender(e):this._dtmf=null),this._dtmf}})})},e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],a.apply(t,[e]),e.getTracks().forEach(function(e){var a=t._senders.find(function(t){return t.track===e});a&&t._senders.splice(t._senders.indexOf(a),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=r.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var a=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){a.src&&t.revokeObjectURL(a.src),a.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){a.src&&t.revokeObjectURL(a.src),a.src=t.createObjectURL(e)})):this.src=""}}))},shimPeerConnection:function(e){var t=O.detectBrowser(e);if(e.RTCPeerConnection){var a=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],n=0;n<e.iceServers.length;n++){var s=e.iceServers[n];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(console.warn("RTCIceServer.url is deprecated! Use urls instead."),(s=JSON.parse(JSON.stringify(s))).urls=s.url,r.push(s)):r.push(e.iceServers[n])}e.iceServers=r}return new a(e,t)},e.RTCPeerConnection.prototype=a.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return a.generateCertificate}})}else e.RTCPeerConnection=function(t,a){return L("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,a)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,a){var n=this,s=arguments;if(arguments.length>0&&"function"==typeof e)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof arguments[0]))return r.apply(this,[]);var i=function(e){var t={};return e.result().forEach(function(e){var a={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){a[t]=e.stat(t)}),t[a.id]=a}),t},o=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return r.apply(this,[function(e){s[1](o(i(e)))},arguments[0]])}return new Promise(function(e,t){r.apply(n,[function(t){e(o(i(t)))},t])}).then(t,a)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,n){a.apply(t,[e[0],r,n])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,n){a.apply(e,[r,n,t])})}return a.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},N={shimMediaStream:D.shimMediaStream,shimOnTrack:D.shimOnTrack,shimGetSendersWithDtmf:D.shimGetSendersWithDtmf,shimSourceObject:D.shimSourceObject,shimPeerConnection:D.shimPeerConnection,shimGetUserMedia:function(e){var t=O.detectBrowser(e),a=e&&e.navigator,r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(a){if("require"!==a&&"advanced"!==a&&"mediaSource"!==a){var r="object"==typeof e[a]?e[a]:{ideal:e[a]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var s={};"number"==typeof r.ideal?(s[n("min",a)]=r.ideal,t.optional.push(s),(s={})[n("max",a)]=r.ideal,t.optional.push(s)):(s[n("",a)]=r.ideal,t.optional.push(s))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",a)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,a)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},n=function(e,n){if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var s=function(e,t,a){t in e&&!(a in e)&&(e[a]=e[t],delete e[t])};s((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){var i=e.video.facingMode;i=i&&("object"==typeof i?i:{ideal:i});var o=t.version<61;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!a.mediaDevices.getSupportedConstraints||!a.mediaDevices.getSupportedConstraints().facingMode||o)){delete e.video.facingMode;var l;if("environment"===i.exact||"environment"===i.ideal?l=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(l=["front"]),l)return a.mediaDevices.enumerateDevices().then(function(t){var a=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return l.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!a&&t.length&&-1!==l.indexOf("back")&&(a=t[t.length-1]),a&&(e.video.deviceId=i.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),I("chrome: "+JSON.stringify(e)),n(e)})}e.video=r(e.video)}return I("chrome: "+JSON.stringify(e)),n(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};a.getUserMedia=function(e,t,r){n(e,function(e){a.webkitGetUserMedia(e,t,function(e){r(s(e))})})};var i=function(e){return new Promise(function(t,r){a.getUserMedia(e,t,r)})};if(a.mediaDevices||(a.mediaDevices={getUserMedia:i,enumerateDevices:function(){return new Promise(function(t){var a={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:a[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),a.mediaDevices.getUserMedia){var o=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(e){return n(e,function(e){return o(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else a.mediaDevices.getUserMedia=function(e){return i(e)};void 0===a.mediaDevices.addEventListener&&(a.mediaDevices.addEventListener=function(){I("Dummy mediaDevices.addEventListener called.")}),void 0===a.mediaDevices.removeEventListener&&(a.mediaDevices.removeEventListener=function(){I("Dummy mediaDevices.removeEventListener called.")})}},V={};V.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},V.localCName=V.generateIdentifier(),V.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},V.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},V.matchPrefix=function(e,t){return V.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},V.parseCandidate=function(e){for(var t,a={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":a.relatedAddress=t[r+1];break;case"rport":a.relatedPort=parseInt(t[r+1],10);break;case"tcptype":a.tcpType=t[r+1];break;default:a[t[r]]=t[r+1]}return a},V.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var a=e.type;return t.push("typ"),t.push(a),"host"!==a&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},V.parseIceOptions=function(e){return e.substr(14).split(" ")},V.parseRtpMap=function(e){var t=e.substr(9).split(" "),a={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),a.name=t[0],a.clockRate=parseInt(t[1],10),a.numChannels=3===t.length?parseInt(t[2],10):1,a},V.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},V.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},V.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},V.parseFmtp=function(e){for(var t,a={},r=e.substr(e.indexOf(" ")+1).split(";"),n=0;n<r.length;n++)a[(t=r[n].trim().split("="))[0].trim()]=t[1];return a},V.writeFmtp=function(e){var t="",a=e.payloadType;if(void 0!==e.preferredPayloadType&&(a=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+a+" "+r.join(";")+"\r\n"}return t},V.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},V.writeRtcpFb=function(e){var t="",a=e.payloadType;return void 0!==e.preferredPayloadType&&(a=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+a+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},V.parseSsrcMedia=function(e){var t=e.indexOf(" "),a={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(a.attribute=e.substr(t+1,r-t-1),a.value=e.substr(r+1)):a.attribute=e.substr(t+1),a},V.getMid=function(e){var t=V.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},V.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},V.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:V.matchPrefix(e+t,"a=fingerprint:").map(V.parseFingerprint)}},V.writeDtlsParameters=function(e,t){var a="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){a+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),a},V.getIceParameters=function(e,t){var a=V.splitLines(e);return{usernameFragment:(a=a.concat(V.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:a.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},V.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},V.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=V.splitLines(e)[0].split(" "),r=3;r<a.length;r++){var n=a[r],s=V.matchPrefix(e,"a=rtpmap:"+n+" ")[0];if(s){var i=V.parseRtpMap(s),o=V.matchPrefix(e,"a=fmtp:"+n+" ");switch(i.parameters=o.length?V.parseFmtp(o[0]):{},i.rtcpFeedback=V.matchPrefix(e,"a=rtcp-fb:"+n+" ").map(V.parseRtcpFb),t.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(i.name.toUpperCase())}}}return V.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(V.parseExtmap(e))}),t},V.writeRtpDescription=function(e,t){var a="";a+="m="+e+" ",a+=t.codecs.length>0?"9":"0",a+=" UDP/TLS/RTP/SAVPF ",a+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",a+="c=IN IP4 0.0.0.0\r\n",a+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){a+=V.writeRtpMap(e),a+=V.writeFmtp(e),a+=V.writeRtcpFb(e)});var r=0;return t.codecs.forEach(function(e){e.maxptime>r&&(r=e.maxptime)}),r>0&&(a+="a=maxptime:"+r+"\r\n"),a+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){a+=V.writeExtmap(e)}),a},V.parseRtpEncodingParameters=function(e){var t,a=[],r=V.parseRtpParameters(e),n=-1!==r.fecMechanisms.indexOf("RED"),s=-1!==r.fecMechanisms.indexOf("ULPFEC"),i=V.matchPrefix(e,"a=ssrc:").map(function(e){return V.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),o=i.length>0&&i[0].ssrc,l=V.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});l.length>0&&l[0].length>1&&l[0][0]===o&&(t=l[0][1]),r.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:o,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};a.push(r),n&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:t,mechanism:s?"red+ulpfec":"red"},a.push(r))}}),0===a.length&&o&&a.push({ssrc:o});var c=V.matchPrefix(e,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,a.forEach(function(e){e.maxBitrate=c})),a},V.parseRtcpParameters=function(e){var t={},a=V.matchPrefix(e,"a=ssrc:").map(function(e){return V.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];a&&(t.cname=a.value,t.ssrc=a.ssrc);var r=V.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=0===r.length;var n=V.matchPrefix(e,"a=rtcp-mux");return t.mux=n.length>0,t},V.parseMsid=function(e){var t,a=V.matchPrefix(e,"a=msid:");if(1===a.length)return t=a[0].substr(7).split(" "),{stream:t[0],track:t[1]};var r=V.matchPrefix(e,"a=ssrc:").map(function(e){return V.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return r.length>0?(t=r[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},V.generateSessionId=function(){return Math.random().toString().substr(2,21)},V.writeSessionBoilerplate=function(e,t){var a=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||V.generateSessionId())+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},V.writeMediaSection=function(e,t,a,r){var n=V.writeRtpDescription(e.kind,t);if(n+=V.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=V.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===a?"actpass":"active"),n+="a=mid:"+e.mid+"\r\n",e.direction?n+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?n+="a=sendrecv\r\n":e.rtpSender?n+="a=sendonly\r\n":e.rtpReceiver?n+="a=recvonly\r\n":n+="a=inactive\r\n",e.rtpSender){var s="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";n+="a="+s,n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+V.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+V.localCName+"\r\n"),n},V.getDirection=function(e,t){for(var a=V.splitLines(e),r=0;r<a.length;r++)switch(a[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[r].substr(2)}return t?V.getDirection(t):"sendrecv"},V.getKind=function(e){return V.splitLines(e)[0].split(" ")[0].substr(2)},V.isRejected=function(e){return"0"===e.split(" ",2)[1]};var H=V,j=function(n,s){var i=function(e){var a=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){a[e]=r[e].bind(r)}),this.needNegotiation=!1,this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return a.localStreams},this.getRemoteStreams=function(){return a.remoteStreams},this.localDescription=new n.RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new n.RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy}this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers&&(this.iceOptions.iceServers=t(e.iceServers,s)),this._config=e||{},this.transceivers=[],this._localIceCandidatesBuffer=[],this._sdpSessionId=H.generateSessionId()};return i.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},i.prototype._emitBufferedCandidates=function(){var e=this,t=H.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(a){if(!a.candidate||0===Object.keys(a.candidate).length)for(var r=1;r<t.length;r++)-1===t[r].indexOf("\r\na=end-of-candidates\r\n")&&(t[r]+="a=end-of-candidates\r\n");else t[a.candidate.sdpMLineIndex+1]+="a="+a.candidate.candidate+"\r\n";e.localDescription.sdp=t.join(""),e.dispatchEvent(a),null!==e.onicecandidate&&e.onicecandidate(a),a.candidate||"complete"===e.iceGatheringState||e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&"complete"!==e.iceGatheringStateChange&&(e.iceGatheringState="complete",e._emitGatheringStateChange())}),this._localIceCandidatesBuffer=[]},i.prototype.getConfiguration=function(){return this._config},i.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&t)a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();a.iceTransport=r.iceTransport,a.dtlsTransport=r.dtlsTransport}return this.transceivers.push(a),a},i.prototype.addTrack=function(e,t){for(var a,r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==e.kind||(a=this.transceivers[r]);return a||(a=this._createTransceiver(e.kind)),a.track=e,a.stream=t,a.rtpSender=new n.RTCRtpSender(e,a.dtlsTransport),this._maybeFireNegotiationNeeded(),a.rtpSender},i.prototype.addStream=function(e){var t=this;if(s>=15025)this.localStreams.push(e),e.getTracks().forEach(function(a){t.addTrack(a,e)});else{var a=e.clone();e.getTracks().forEach(function(e,t){var r=a.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),a.getTracks().forEach(function(e){t.addTrack(e,a)}),this.localStreams.push(a)}this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},i.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},i.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},i.prototype._createIceGatherer=function(e,t){var a=this,r=new n.RTCIceGatherer(a.iceOptions);return r.onlocalcandidate=function(n){var s=new Event("icecandidate");s.candidate={sdpMid:e,sdpMLineIndex:t};var i=n.candidate,o=!i||0===Object.keys(i).length;o?void 0===r.state&&(r.state="completed"):(i.component=1,s.candidate.candidate=H.writeCandidate(i));var l=H.splitSections(a.localDescription.sdp);l[s.candidate.sdpMLineIndex+1]+=o?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",a.localDescription.sdp=l.join("");var c=(a._pendingOffer?a._pendingOffer:a.transceivers).every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(a.iceGatheringState){case"new":o||a._localIceCandidatesBuffer.push(s),o&&c&&a._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":a._emitBufferedCandidates(),o||(a.dispatchEvent(s),null!==a.onicecandidate&&a.onicecandidate(s)),c&&(a.dispatchEvent(new Event("icecandidate")),null!==a.onicecandidate&&a.onicecandidate(new Event("icecandidate")),a.iceGatheringState="complete",a._emitGatheringStateChange())}},r},i.prototype._createIceAndDtlsTransports=function(){var e=this,t=new n.RTCIceTransport(null);t.onicestatechange=function(){e._updateConnectionState()};var a=new n.RTCDtlsTransport(t);return a.ondtlsstatechange=function(){e._updateConnectionState()},a.onerror=function(){Object.defineProperty(a,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:a}},i.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var a=this.transceivers[e].iceTransport;a&&(delete a.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlssttatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},i.prototype._transceive=function(e,t,r){var n=a(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(n.encodings=e.sendEncodingParameters,n.rtcp={cname:H.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(n.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(n)),r&&e.rtpReceiver&&("video"===e.kind&&e.recvEncodingParameters&&s<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),n.encodings=e.recvEncodingParameters,n.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound},e.sendEncodingParameters.length&&(n.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(n))},i.prototype.setLocalDescription=function(e){var t=this;if(!r("setLocalDescription",e.type,this.signalingState)){var s=new Error("Can not set local "+e.type+" in state "+this.signalingState);return s.name="InvalidStateError",arguments.length>2&&"function"==typeof arguments[2]&&n.setTimeout(arguments[2],0,s),Promise.reject(s)}var i,o;if("offer"===e.type)this._pendingOffer&&(i=H.splitSections(e.sdp),o=i.shift(),i.forEach(function(e,a){var r=H.parseRtpParameters(e);t._pendingOffer[a].localCapabilities=r}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){i=H.splitSections(t.remoteDescription.sdp),o=i.shift();var l=H.matchPrefix(o,"a=ice-lite").length>0;i.forEach(function(e,r){var n=t.transceivers[r],s=n.iceGatherer,i=n.iceTransport,c=n.dtlsTransport,_=n.localCapabilities,f=n.remoteCapabilities;if(!H.isRejected(e)&&!n.isDatachannel){var u=H.getIceParameters(e,o),p=H.getDtlsParameters(e,o);l&&(p.role="server"),t.usingBundle&&0!==r||(i.start(s,u,l?"controlling":"controlled"),c.start(p));var h=a(_,f);t._transceive(n,h.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var c=arguments.length>1&&"function"==typeof arguments[1];if(c){var _=arguments[1];n.setTimeout(function(){_(),"new"===t.iceGatheringState&&(t.iceGatheringState="gathering",t._emitGatheringStateChange()),t._emitBufferedCandidates()},0)}var f=Promise.resolve();return f.then(function(){c||("new"===t.iceGatheringState&&(t.iceGatheringState="gathering",t._emitGatheringStateChange()),n.setTimeout(t._emitBufferedCandidates.bind(t),500))}),f},i.prototype.setRemoteDescription=function(e){var t=this;if(!r("setRemoteDescription",e.type,this.signalingState)){var a=new Error("Can not set remote "+e.type+" in state "+this.signalingState);return a.name="InvalidStateError",arguments.length>2&&"function"==typeof arguments[2]&&n.setTimeout(arguments[2],0,a),Promise.reject(a)}var i={},o=[],l=H.splitSections(e.sdp),c=l.shift(),_=H.matchPrefix(c,"a=ice-lite").length>0,f=H.matchPrefix(c,"a=group:BUNDLE ").length>0;this.usingBundle=f;var u=H.matchPrefix(c,"a=ice-options:")[0];switch(this.canTrickleIceCandidates=!!u&&u.substr(14).split(" ").indexOf("trickle")>=0,l.forEach(function(a,r){var l=H.splitLines(a),u=H.getKind(a),p=H.isRejected(a),h=l[0].substr(2).split(" ")[2],d=H.getDirection(a,c),m=H.parseMsid(a),b=H.getMid(a)||H.generateIdentifier();if("application"!==u||"DTLS/SCTP"!==h){var v,g,S,R,y,T,M,w,E,A,k,B=H.parseRtpParameters(a);p||(A=H.getIceParameters(a,c),(k=H.getDtlsParameters(a,c)).role="client"),M=H.parseRtpEncodingParameters(a);var P=H.parseRtcpParameters(a),x=H.matchPrefix(a,"a=end-of-candidates",c).length>0,C=H.matchPrefix(a,"a=candidate:").map(function(e){return H.parseCandidate(e)}).filter(function(e){return"1"===e.component||1===e.component});("offer"===e.type||"answer"===e.type)&&!p&&f&&r>0&&t.transceivers[r]&&(t._disposeIceAndDtlsTransports(r),t.transceivers[r].iceGatherer=t.transceivers[0].iceGatherer,t.transceivers[r].iceTransport=t.transceivers[0].iceTransport,t.transceivers[r].dtlsTransport=t.transceivers[0].dtlsTransport,t.transceivers[r].rtpSender&&t.transceivers[r].rtpSender.setTransport(t.transceivers[0].dtlsTransport),t.transceivers[r].rtpReceiver&&t.transceivers[r].rtpReceiver.setTransport(t.transceivers[0].dtlsTransport)),"offer"!==e.type||p?"answer"!==e.type||p||(g=(v=t.transceivers[r]).iceGatherer,S=v.iceTransport,R=v.dtlsTransport,y=v.rtpReceiver,T=v.sendEncodingParameters,w=v.localCapabilities,t.transceivers[r].recvEncodingParameters=M,t.transceivers[r].remoteCapabilities=B,t.transceivers[r].rtcpParameters=P,(_||x)&&C.length&&S.setRemoteCandidates(C),f&&0!==r||(S.start(g,A,"controlling"),R.start(k)),t._transceive(v,"sendrecv"===d||"recvonly"===d,"sendrecv"===d||"sendonly"===d),!y||"sendrecv"!==d&&"sendonly"!==d?delete v.rtpReceiver:(E=y.track,m?(i[m.stream]||(i[m.stream]=new n.MediaStream),i[m.stream].addTrack(E),o.push([E,y,i[m.stream]])):(i.default||(i.default=new n.MediaStream),i.default.addTrack(E),o.push([E,y,i.default])))):((v=t.transceivers[r]||t._createTransceiver(u)).mid=b,v.iceGatherer||(v.iceGatherer=f&&r>0?t.transceivers[0].iceGatherer:t._createIceGatherer(b,r)),!x||f&&0!==r||v.iceTransport.setRemoteCandidates(C),w=n.RTCRtpReceiver.getCapabilities(u),s<15019&&(w.codecs=w.codecs.filter(function(e){return"rtx"!==e.name})),T=[{ssrc:1001*(2*r+2)}],"sendrecv"!==d&&"sendonly"!==d||(E=(y=new n.RTCRtpReceiver(v.dtlsTransport,u)).track,m?(i[m.stream]||(i[m.stream]=new n.MediaStream,Object.defineProperty(i[m.stream],"id",{get:function(){return m.stream}})),Object.defineProperty(E,"id",{get:function(){return m.track}}),i[m.stream].addTrack(E),o.push([E,y,i[m.stream]])):(i.default||(i.default=new n.MediaStream),i.default.addTrack(E),o.push([E,y,i.default]))),v.localCapabilities=w,v.remoteCapabilities=B,v.rtpReceiver=y,v.rtcpParameters=P,v.sendEncodingParameters=T,v.recvEncodingParameters=M,t._transceive(t.transceivers[r],!1,"sendrecv"===d||"sendonly"===d))}else t.transceivers[r]={mid:b,isDatachannel:!0}}),this.remoteDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return Object.keys(i).forEach(function(e){var a=i[e];if(a.getTracks().length){t.remoteStreams.push(a);var r=new Event("addstream");r.stream=a,t.dispatchEvent(r),null!==t.onaddstream&&n.setTimeout(function(){t.onaddstream(r)},0),o.forEach(function(e){var r=e[0],s=e[1];if(a.id===e[2].id){var i=new Event("track");i.track=r,i.receiver=s,i.streams=[a],t.dispatchEvent(i),null!==t.ontrack&&n.setTimeout(function(){t.ontrack(i)},0)}})}}),n.setTimeout(function(){t&&t.transceivers&&t.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),arguments.length>1&&"function"==typeof arguments[1]&&n.setTimeout(arguments[1],0),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},i.prototype._maybeFireNegotiationNeeded=function(){var e=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,n.setTimeout(function(){if(!1!==e.needNegotiation){e.needNegotiation=!1;var t=new Event("negotiationneeded");e.dispatchEvent(t),null!==e.onnegotiationneeded&&e.onnegotiationneeded(t)}},0))},i.prototype._updateConnectionState=function(){var e,t=this,a={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){a[e.iceTransport.state]++,a[e.dtlsTransport.state]++}),a.connected+=a.completed,e="new",a.failed>0?e="failed":a.connecting>0||a.checking>0?e="connecting":a.disconnected>0?e="disconnected":a.new>0?e="new":(a.connected>0||a.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this.dispatchEvent(r),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(r)}},i.prototype.createOffer=function(){var t=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var a;1===arguments.length&&"function"!=typeof arguments[0]?a=arguments[0]:3===arguments.length&&(a=arguments[2]);var r=this.transceivers.filter(function(e){return"audio"===e.kind}).length,i=this.transceivers.filter(function(e){return"video"===e.kind}).length;if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(r=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(i=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(this.transceivers.forEach(function(e){"audio"===e.kind?--r<0&&(e.wantReceive=!1):"video"===e.kind&&--i<0&&(e.wantReceive=!1)});r>0||i>0;)r>0&&(this._createTransceiver("audio"),r--),i>0&&(this._createTransceiver("video"),i--);var o=e(this.transceivers),l=H.writeSessionBoilerplate(this._sdpSessionId);o.forEach(function(e,a){var r=e.track,i=e.kind,l=H.generateIdentifier();e.mid=l,e.iceGatherer||(e.iceGatherer=t.usingBundle&&a>0?o[0].iceGatherer:t._createIceGatherer(l,a));var c=n.RTCRtpSender.getCapabilities(i);s<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var _=[{ssrc:1001*(2*a+1)}];r&&s>=15019&&"video"===i&&(_[0].rtx={ssrc:1001*(2*a+1)+1}),e.wantReceive&&(e.rtpReceiver=new n.RTCRtpReceiver(e.dtlsTransport,i)),e.localCapabilities=c,e.sendEncodingParameters=_}),"max-compat"!==this._config.bundlePolicy&&(l+="a=group:BUNDLE "+o.map(function(e){return e.mid}).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",o.forEach(function(e,t){l+=H.writeMediaSection(e,e.localCapabilities,"offer",e.stream),l+="a=rtcp-rsize\r\n"}),this._pendingOffer=o;var c=new n.RTCSessionDescription({type:"offer",sdp:l});return arguments.length&&"function"==typeof arguments[0]&&n.setTimeout(arguments[0],0,c),Promise.resolve(c)},i.prototype.createAnswer=function(){var e=H.writeSessionBoilerplate(this._sdpSessionId);this.usingBundle&&(e+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(t,r){if(t.isDatachannel)e+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+t.mid+"\r\n";else{if(t.stream){var n;"audio"===t.kind?n=t.stream.getAudioTracks()[0]:"video"===t.kind&&(n=t.stream.getVideoTracks()[0]),n&&s>=15019&&"video"===t.kind&&(t.sendEncodingParameters[0].rtx={ssrc:1001*(2*r+2)+1})}var i=a(t.localCapabilities,t.remoteCapabilities);!i.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&t.sendEncodingParameters[0].rtx&&delete t.sendEncodingParameters[0].rtx,e+=H.writeMediaSection(t,i,"answer",t.stream),t.rtcpParameters&&t.rtcpParameters.reducedSize&&(e+="a=rtcp-rsize\r\n")}});var t=new n.RTCSessionDescription({type:"answer",sdp:e});return arguments.length&&"function"==typeof arguments[0]&&n.setTimeout(arguments[0],0,t),Promise.resolve(t)},i.prototype.addIceCandidate=function(e){if(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<this.transceivers.length;a++)if(this.transceivers[a].mid===e.sdpMid){t=a;break}var r=this.transceivers[t];if(r){var s=Object.keys(e.candidate).length>0?H.parseCandidate(e.candidate):{};if("tcp"===s.protocol&&(0===s.port||9===s.port))return Promise.resolve();if(s.component&&"1"!==s.component&&1!==s.component)return Promise.resolve();r.iceTransport.addRemoteCandidate(s);var i=H.splitSections(this.remoteDescription.sdp);i[t+1]+=(s.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=i.join("")}}else for(var o=0;o<this.transceivers.length;o++)if(this.transceivers[o].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return arguments.length>1&&"function"==typeof arguments[1]&&n.setTimeout(arguments[1],0),Promise.resolve()},i.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(a){t[a]&&e.push(t[a].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],a=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(r){var s=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=a(e[t]),s.set(t,e[t])})}),t&&n.setTimeout(t,0,s),r(s)})})},i},X={shimGetUserMedia:function(e){var t=e&&e.navigator,a=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(a(e))})}},shimPeerConnection:function(e){var t=O.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var a=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){a.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCPeerConnection=j(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}},F=O.log,G={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var a=new Event("track");a.track=t,a.receiver={track:t},a.streams=[e.stream],this.dispatchEvent(a)}.bind(this))}.bind(this))}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=O.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(a,r){if(t.version<38&&a&&a.iceServers){for(var n=[],s=0;s<a.iceServers.length;s++){var i=a.iceServers[s];if(i.hasOwnProperty("urls"))for(var o=0;o<i.urls.length;o++){var l={url:i.urls[o]};0===i.urls[o].indexOf("turn")&&(l.username=i.username,l.credential=i.credential),n.push(l)}else n.push(a.iceServers[s])}a.iceServers=n}return new e.mozRTCPeerConnection(a,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var r=function(e){var t=new Map;return Object.keys(e).forEach(function(a){t.set(a,e[a]),t[a]=e[a]}),t},n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,a,i){return s.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=r(e)),t.version<53&&!a)try{e.forEach(function(e){e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,a){e.set(a,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(a,i)}}}},q={shimOnTrack:G.shimOnTrack,shimSourceObject:G.shimSourceObject,shimPeerConnection:G.shimPeerConnection,shimGetUserMedia:function(e){var t=O.detectBrowser(e),a=e&&e.navigator,r=e&&e.MediaStreamTrack,n=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,r,s){var i=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(a){if("require"!==a&&"advanced"!==a&&"mediaSource"!==a){var r=e[a]="object"==typeof e[a]?e[a]:{ideal:e[a]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(a),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[a]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var n={};"number"==typeof r.ideal?n[a]={min:r.ideal,max:r.ideal}:n[a]=r.ideal,e.advanced.push(n),delete r.ideal,Object.keys(r).length||delete e[a]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(F("spec: "+JSON.stringify(e)),e.audio&&(e.audio=i(e.audio)),e.video&&(e.video=i(e.video)),F("ff37: "+JSON.stringify(e))),a.mozGetUserMedia(e,r,function(e){s(n(e))})};if(a.mediaDevices||(a.mediaDevices={getUserMedia:function(e){return new Promise(function(t,a){s(e,t,a)})},addEventListener:function(){},removeEventListener:function(){}}),a.mediaDevices.enumerateDevices=a.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var i=a.mediaDevices.enumerateDevices.bind(a.mediaDevices);a.mediaDevices.enumerateDevices=function(){return i().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var o=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(e){return o(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(n(e))})}}if(!(t.version>55&&"autoGainControl"in a.mediaDevices.getSupportedConstraints())){var l=function(e,t,a){t in e&&!(a in e)&&(e[a]=e[t],delete e[t])},c=a.mediaDevices.getUserMedia.bind(a.mediaDevices);if(a.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),l(e.audio,"autoGainControl","mozAutoGainControl"),l(e.audio,"noiseSuppression","mozNoiseSuppression")),c(e)},r&&r.prototype.getSettings){var _=r.prototype.getSettings;r.prototype.getSettings=function(){var e=_.apply(this,arguments);return l(e,"mozAutoGainControl","autoGainControl"),l(e,"mozNoiseSuppression","noiseSuppression"),e}}if(r&&r.prototype.applyConstraints){var f=r.prototype.applyConstraints;r.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),l(e,"autoGainControl","mozAutoGainControl"),l(e,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[e])}}}a.getUserMedia=function(e,r,n){if(t.version<44)return s(e,r,n);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),a.mediaDevices.getUserMedia(e).then(r,n)}}},Y={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(a){a.id===e&&(t=a)}),this._remoteStreams&&this._remoteStreams.forEach(function(a){a.id===e&&(t=a)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var a=this;e.getTracks().forEach(function(r){t.call(a,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,a){a&&(this._localStreams?-1===this._localStreams.indexOf(a)&&this._localStreams.push(a):this._localStreams=[a]),t.call(this,e,a)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var a=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&a.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var a=new Event("addstream");a.stream=e.streams[0],this.dispatchEvent(a)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,a=t.createOffer,r=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,i=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],n=a.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){var a=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[a]);return t?(n.then(e,t),Promise.resolve()):n};var o=function(e,t,a){var r=n.apply(this,[e]);return a?(r.then(t,a),Promise.resolve()):r};t.setLocalDescription=o,o=function(e,t,a){var r=s.apply(this,[e]);return a?(r.then(t,a),Promise.resolve()):r},t.setRemoteDescription=o,o=function(e,t,a){var r=i.apply(this,[e]);return a?(r.then(t,a),Promise.resolve()):r},t.addIceCandidate=o}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,a,r){t.mediaDevices.getUserMedia(e).then(a,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,a){if(e&&e.iceServers){for(var r=[],n=0;n<e.iceServers.length;n++){var s=e.iceServers[n];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(O.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,r.push(s)):r.push(e.iceServers[n])}e.iceServers=r}return new t(e,a)},e.RTCPeerConnection.prototype=t.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}},U={shimCallbacksAPI:Y.shimCallbacksAPI,shimLocalStreamsAPI:Y.shimLocalStreamsAPI,shimRemoteStreamsAPI:Y.shimRemoteStreamsAPI,shimGetUserMedia:Y.shimGetUserMedia,shimRTCIceServerUrls:Y.shimRTCIceServerUrls},z=(function(e){var t=e&&e.window,a=O,r=a.log,n=a.detectBrowser(t),s={browserDetails:n,extractVersion:a.extractVersion,disableLog:a.disableLog,disableWarnings:a.disableWarnings},i=N||null,o=X||null,l=q||null,c=U||null;switch(n.browser){case"chrome":if(!i||!i.shimPeerConnection)return r("Chrome shim is not included in this adapter release."),s;r("adapter.js shimming chrome."),s.browserShim=i,i.shimGetUserMedia(t),i.shimMediaStream(t),a.shimCreateObjectURL(t),i.shimSourceObject(t),i.shimPeerConnection(t),i.shimOnTrack(t),i.shimGetSendersWithDtmf(t);break;case"firefox":if(!l||!l.shimPeerConnection)return r("Firefox shim is not included in this adapter release."),s;r("adapter.js shimming firefox."),s.browserShim=l,l.shimGetUserMedia(t),a.shimCreateObjectURL(t),l.shimSourceObject(t),l.shimPeerConnection(t),l.shimOnTrack(t);break;case"edge":if(!o||!o.shimPeerConnection)return r("MS edge shim is not included in this adapter release."),s;r("adapter.js shimming edge."),s.browserShim=o,o.shimGetUserMedia(t),a.shimCreateObjectURL(t),o.shimPeerConnection(t),o.shimReplaceTrack(t);break;case"safari":if(!c)return r("Safari shim is not included in this adapter release."),s;r("adapter.js shimming safari."),s.browserShim=c,a.shimCreateObjectURL(t),c.shimRTCIceServerUrls(t),c.shimCallbacksAPI(t),c.shimLocalStreamsAPI(t),c.shimRemoteStreamsAPI(t),c.shimGetUserMedia(t);break;default:r("Unsupported browser!")}}({window:B.window}),{});z.fill=function(e,t,a,r){if(2==arguments.length)for(n=0;n<e.length;n++)e[n]=arguments[1];else for(var n=t;n<a;n++)e[n]=r};var K={};K.arraycopy=function(e,t,a,r,n){for(var s=t+n;t<s;)a[r++]=e[t++]};var Z={};Z.SQRT2=1.4142135623730951,Z.FAST_LOG10=function(e){return Math.log10(e)},Z.FAST_LOG10_X=function(e,t){return Math.log10(e)*t},f.short_block_allowed=new f(0),f.short_block_coupled=new f(1),f.short_block_dispensed=new f(2),f.short_block_forced=new f(3);var Q={};Q.MAX_VALUE=3.4028235e38,u.vbr_off=new u(0),u.vbr_mt=new u(1),u.vbr_rh=new u(2),u.vbr_abr=new u(3),u.vbr_mtrh=new u(4),u.vbr_default=u.vbr_mtrh;var W={System:K,VbrMode:u,Float:Q,ShortBlock:f,Util:Z,Arrays:z,new_array_n:_,new_byte:function(e){return new Int8Array(e)},new_double:function(e){return new Float64Array(e)},new_float:i,new_float_n:o,new_int:s,new_int_n:l,new_short:n,new_short_n:c,assert:function(e){}},J=W.System,$=W.Util,ee=W.Arrays,te=W.new_float,ae=function(){function e(e,t,a){for(var n=10,s=t+238-14-286,i=-15;i<0;i++){var o;o=r[n+-10],l=e[s+-224]*o,c=e[t+224]*o,o=r[n+-9],l+=e[s+-160]*o,c+=e[t+160]*o,o=r[n+-8],l+=e[s+-96]*o,c+=e[t+96]*o,o=r[n+-7],l+=e[s+-32]*o,c+=e[t+32]*o,o=r[n+-6],l+=e[s+32]*o,c+=e[t+-32]*o,o=r[n+-5],l+=e[s+96]*o,c+=e[t+-96]*o,o=r[n+-4],l+=e[s+160]*o,c+=e[t+-160]*o,o=r[n+-3],l+=e[s+224]*o,c+=e[t+-224]*o,o=r[n+-2],l+=e[t+-256]*o,c-=e[s+256]*o,o=r[n+-1],l+=e[t+-192]*o,c-=e[s+192]*o,o=r[n+0],l+=e[t+-128]*o,c-=e[s+128]*o,o=r[n+1],l+=e[t+-64]*o,c-=e[s+64]*o,o=r[n+2],l+=e[t+0]*o,c-=e[s+0]*o,o=r[n+3],l+=e[t+64]*o,c-=e[s+-64]*o,o=r[n+4],l+=e[t+128]*o,c-=e[s+-128]*o,o=r[n+5],l+=e[t+192]*o,o=(c-=e[s+-192]*o)-(l*=r[n+6]),a[30+2*i]=c+l,a[31+2*i]=r[n+7]*o,n+=18,t--,s++}var l,c,_,f;c=e[t+-16]*r[n+-10],l=e[t+-32]*r[n+-2],c+=(e[t+-48]-e[t+16])*r[n+-9],l+=e[t+-96]*r[n+-1],c+=(e[t+-80]+e[t+48])*r[n+-8],l+=e[t+-160]*r[n+0],c+=(e[t+-112]-e[t+80])*r[n+-7],l+=e[t+-224]*r[n+1],c+=(e[t+-144]+e[t+112])*r[n+-6],l-=e[t+32]*r[n+2],c+=(e[t+-176]-e[t+144])*r[n+-5],l-=e[t+96]*r[n+3],c+=(e[t+-208]+e[t+176])*r[n+-4],l-=e[t+160]*r[n+4],c+=(e[t+-240]-e[t+208])*r[n+-3],_=(l-=e[t+224])-c,f=l+c,c=a[14],l=a[15]-c,a[31]=f+c,a[30]=_+l,a[15]=_-l,a[14]=f-c;var u;u=a[28]-a[0],a[0]+=a[28],a[28]=u*r[n+-36+7],u=a[29]-a[1],a[1]+=a[29],a[29]=u*r[n+-36+7],u=a[26]-a[2],a[2]+=a[26],a[26]=u*r[n+-72+7],u=a[27]-a[3],a[3]+=a[27],a[27]=u*r[n+-72+7],u=a[24]-a[4],a[4]+=a[24],a[24]=u*r[n+-108+7],u=a[25]-a[5],a[5]+=a[25],a[25]=u*r[n+-108+7],u=a[22]-a[6],a[6]+=a[22],a[22]=u*$.SQRT2,u=a[23]-a[7],a[7]+=a[23],a[23]=u*$.SQRT2-a[7],a[7]-=a[6],a[22]-=a[7],a[23]-=a[22],u=a[6],a[6]=a[31]-u,a[31]=a[31]+u,u=a[7],a[7]=a[30]-u,a[30]=a[30]+u,u=a[22],a[22]=a[15]-u,a[15]=a[15]+u,u=a[23],a[23]=a[14]-u,a[14]=a[14]+u,u=a[20]-a[8],a[8]+=a[20],a[20]=u*r[n+-180+7],u=a[21]-a[9],a[9]+=a[21],a[21]=u*r[n+-180+7],u=a[18]-a[10],a[10]+=a[18],a[18]=u*r[n+-216+7],u=a[19]-a[11],a[11]+=a[19],a[19]=u*r[n+-216+7],u=a[16]-a[12],a[12]+=a[16],a[16]=u*r[n+-252+7],u=a[17]-a[13],a[13]+=a[17],a[17]=u*r[n+-252+7],u=-a[20]+a[24],a[20]+=a[24],a[24]=u*r[n+-216+7],u=-a[21]+a[25],a[21]+=a[25],a[25]=u*r[n+-216+7],u=a[4]-a[8],a[4]+=a[8],a[8]=u*r[n+-216+7],u=a[5]-a[9],a[5]+=a[9],a[9]=u*r[n+-216+7],u=a[0]-a[12],a[0]+=a[12],a[12]=u*r[n+-72+7],u=a[1]-a[13],a[1]+=a[13],a[13]=u*r[n+-72+7],u=a[16]-a[28],a[16]+=a[28],a[28]=u*r[n+-72+7],u=-a[17]+a[29],a[17]+=a[29],a[29]=u*r[n+-72+7],u=$.SQRT2*(a[2]-a[10]),a[2]+=a[10],a[10]=u,u=$.SQRT2*(a[3]-a[11]),a[3]+=a[11],a[11]=u,u=$.SQRT2*(-a[18]+a[26]),a[18]+=a[26],a[26]=u-a[18],u=$.SQRT2*(-a[19]+a[27]),a[19]+=a[27],a[27]=u-a[19],u=a[2],a[19]-=a[3],a[3]-=u,a[2]=a[31]-u,a[31]+=u,u=a[3],a[11]-=a[19],a[18]-=u,a[3]=a[30]-u,a[30]+=u,u=a[18],a[27]-=a[11],a[19]-=u,a[18]=a[15]-u,a[15]+=u,u=a[19],a[10]-=u,a[19]=a[14]-u,a[14]+=u,u=a[10],a[11]-=u,a[10]=a[23]-u,a[23]+=u,u=a[11],a[26]-=u,a[11]=a[22]-u,a[22]+=u,u=a[26],a[27]-=u,a[26]=a[7]-u,a[7]+=u,u=a[27],a[27]=a[6]-u,a[6]+=u,u=$.SQRT2*(a[0]-a[4]),a[0]+=a[4],a[4]=u,u=$.SQRT2*(a[1]-a[5]),a[1]+=a[5],a[5]=u,u=$.SQRT2*(a[16]-a[20]),a[16]+=a[20],a[20]=u,u=$.SQRT2*(a[17]-a[21]),a[17]+=a[21],a[21]=u,u=-$.SQRT2*(a[8]-a[12]),a[8]+=a[12],a[12]=u-a[8],u=-$.SQRT2*(a[9]-a[13]),a[9]+=a[13],a[13]=u-a[9],u=-$.SQRT2*(a[25]-a[29]),a[25]+=a[29],a[29]=u-a[25],u=-$.SQRT2*(a[24]+a[28]),a[24]-=a[28],a[28]=u-a[24],u=a[24]-a[16],a[24]=u,u=a[20]-u,a[20]=u,u=a[28]-u,a[28]=u,u=a[25]-a[17],a[25]=u,u=a[21]-u,a[21]=u,u=a[29]-u,a[29]=u,u=a[17]-a[1],a[17]=u,u=a[9]-u,a[9]=u,u=a[25]-u,a[25]=u,u=a[5]-u,a[5]=u,u=a[21]-u,a[21]=u,u=a[13]-u,a[13]=u,u=a[29]-u,a[29]=u,u=a[1]-a[0],a[1]=u,u=a[16]-u,a[16]=u,u=a[17]-u,a[17]=u,u=a[8]-u,a[8]=u,u=a[9]-u,a[9]=u,u=a[24]-u,a[24]=u,u=a[25]-u,a[25]=u,u=a[4]-u,a[4]=u,u=a[5]-u,a[5]=u,u=a[20]-u,a[20]=u,u=a[21]-u,a[21]=u,u=a[12]-u,a[12]=u,u=a[13]-u,a[13]=u,u=a[28]-u,a[28]=u,u=a[29]-u,a[29]=u,u=a[0],a[0]+=a[31],a[31]-=u,u=a[1],a[1]+=a[30],a[30]-=u,u=a[16],a[16]+=a[15],a[15]-=u,u=a[17],a[17]+=a[14],a[14]-=u,u=a[8],a[8]+=a[23],a[23]-=u,u=a[9],a[9]+=a[22],a[22]-=u,u=a[24],a[24]+=a[7],a[7]-=u,u=a[25],a[25]+=a[6],a[6]-=u,u=a[4],a[4]+=a[27],a[27]-=u,u=a[5],a[5]+=a[26],a[26]-=u,u=a[20],a[20]+=a[11],a[11]-=u,u=a[21],a[21]+=a[10],a[10]-=u,u=a[12],a[12]+=a[19],a[19]-=u,u=a[13],a[13]+=a[18],a[18]-=u,u=a[28],a[28]+=a[3],a[3]-=u,u=a[29],a[29]+=a[2],a[2]-=u}function t(e,t){for(var a=0;a<3;a++){var r,s,i,o,l,c;s=(o=e[t+6]*n[de.SHORT_TYPE][0]-e[t+15])+(r=e[t+0]*n[de.SHORT_TYPE][2]-e[t+9]),i=o-r,l=(o=e[t+15]*n[de.SHORT_TYPE][0]+e[t+6])+(r=e[t+9]*n[de.SHORT_TYPE][2]+e[t+0]),c=-o+r,r=2.069978111953089e-11*(e[t+3]*n[de.SHORT_TYPE][1]-e[t+12]),o=2.069978111953089e-11*(e[t+12]*n[de.SHORT_TYPE][1]+e[t+3]),e[t+0]=1.90752519173728e-11*s+r,e[t+15]=1.90752519173728e-11*-l+o,i=.8660254037844387*i*1.907525191737281e-11,l=.5*l*1.907525191737281e-11+o,e[t+3]=i-l,e[t+6]=i+l,s=.5*s*1.907525191737281e-11-r,c=.8660254037844387*c*1.907525191737281e-11,e[t+9]=s+c,e[t+12]=s-c,t++}}function a(e,t,a){var r,n,s,o,l,c,_,f,u,p;s=a[17]-a[9],l=a[15]-a[11],c=a[14]-a[12],_=a[0]+a[8],f=a[1]+a[7],u=a[2]+a[6],p=a[3]+a[5],e[t+17]=_+u-p-(f-a[4]),n=(_+u-p)*i[19]+(f-a[4]),r=(s-l-c)*i[18],e[t+5]=r+n,e[t+6]=r-n,o=(a[16]-a[10])*i[18],f=f*i[19]+a[4],r=s*i[12]+o+l*i[13]+c*i[14],n=-_*i[16]+f-u*i[17]+p*i[15],e[t+1]=r+n,e[t+2]=r-n,r=s*i[13]-o-l*i[14]+c*i[12],n=-_*i[17]+f-u*i[15]+p*i[16],e[t+9]=r+n,e[t+10]=r-n,r=s*i[14]-o+l*i[12]-c*i[13],n=_*i[15]-f+u*i[16]-p*i[17],e[t+13]=r+n,e[t+14]=r-n;var h,d,m,b,v,g,S,R;h=a[8]-a[0],m=a[6]-a[2],b=a[5]-a[3],v=a[17]+a[9],g=a[16]+a[10],S=a[15]+a[11],R=a[14]+a[12],e[t+0]=v+S+R+(g+a[13]),r=(v+S+R)*i[19]-(g+a[13]),n=(h-m+b)*i[18],e[t+11]=r+n,e[t+12]=r-n,d=(a[7]-a[1])*i[18],g=a[13]-g*i[19],r=v*i[15]-g+S*i[16]+R*i[17],n=h*i[14]+d+m*i[12]+b*i[13],e[t+3]=r+n,e[t+4]=r-n,r=-v*i[17]+g-S*i[15]-R*i[16],n=h*i[13]+d-m*i[14]-b*i[12],e[t+7]=r+n,e[t+8]=r-n,r=-v*i[16]+g-S*i[17]-R*i[15],n=h*i[12]-d+m*i[13]-b*i[14],e[t+15]=r+n,e[t+16]=r-n}var r=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*$.SQRT2*.5/2384e-9,.017876148*$.SQRT2*.5/2384e-9,.003134727*$.SQRT2*.5/2384e-9,.002457142*$.SQRT2*.5/2384e-9,971317e-9*$.SQRT2*.5/2384e-9,218868e-9*$.SQRT2*.5/2384e-9,101566e-9*$.SQRT2*.5/2384e-9,13828e-9*$.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,49591e-9/2384e-9,1995.1556208053692,21458e-9/2384e-9,-69618e-9/2384e-9],n=[[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.40084909404969e-13,6.423305872147839e-13,2.382191739347918e-13,5.456116108943412e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758252e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558783e-12,8.371015190102974e-13,2.599706096327376e-13,-5.456116108943412e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758252e-12,-2.858043359288076e-12,-2.156177623817898e-12,-1.475637723558783e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347923e-13,-6.423305872147843e-13,-9.400849094049696e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049694e-13,-6.42330587214784e-13,-2.382191739347918e-13],[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.400849094049688e-13,6.423305872147841e-13,2.382191739347918e-13,5.456116108943413e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758253e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558782e-12,8.371015190102975e-13,2.599706096327376e-13,-5.461314069809755e-12,-4.921085770524055e-12,-4.343405037091838e-12,-3.732668368707687e-12,-3.093523840190885e-12,-2.430835727329465e-12,-1.734679010007751e-12,-9.74825365660928e-13,-2.797435120168326e-13,0,0,0,0,0,0,-2.283748241799531e-13,-4.037858874020686e-13,-2.146547464825323e-13],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2.283748241799531e-13,4.037858874020686e-13,2.146547464825323e-13,5.461314069809755e-12,4.921085770524055e-12,4.343405037091838e-12,3.732668368707687e-12,3.093523840190885e-12,2.430835727329466e-12,1.734679010007751e-12,9.74825365660928e-13,2.797435120168326e-13,-5.456116108943413e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758253e-12,-2.858043359288075e-12,-2.156177623817898e-12,-1.475637723558782e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347913e-13,-6.423305872147834e-13,-9.400849094049688e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049688e-13,-6.423305872147841e-13,-2.382191739347918e-13]],s=n[de.SHORT_TYPE],i=n[de.SHORT_TYPE],o=n[de.SHORT_TYPE],l=n[de.SHORT_TYPE],c=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];this.mdct_sub48=function(r,i,_){for(var f=i,u=286,p=0;p<r.channels_out;p++){for(var h=0;h<r.mode_gr;h++){for(var d,m=r.l3_side.tt[h][p],b=m.xr,v=0,g=r.sb_sample[p][1-h],S=0,R=0;R<9;R++)for(e(f,u,g[S]),e(f,u+32,g[S+1]),S+=2,u+=64,d=1;d<32;d+=2)g[S-1][d]*=-1;for(d=0;d<32;d++,v+=18){var y=m.block_type,T=r.sb_sample[p][h],M=r.sb_sample[p][1-h];if(0!=m.mixed_block_flag&&d<2&&(y=0),r.amp_filter[d]<1e-12)ee.fill(b,v+0,v+18,0);else{if(r.amp_filter[d]<1)for(R=0;R<18;R++)M[R][c[d]]*=r.amp_filter[d];if(y==de.SHORT_TYPE){for(R=-3;R<0;R++){var w=n[de.SHORT_TYPE][R+3];b[v+3*R+9]=T[9+R][c[d]]*w-T[8-R][c[d]],b[v+3*R+18]=T[14-R][c[d]]*w+T[15+R][c[d]],b[v+3*R+10]=T[15+R][c[d]]*w-T[14-R][c[d]],b[v+3*R+19]=M[2-R][c[d]]*w+M[3+R][c[d]],b[v+3*R+11]=M[3+R][c[d]]*w-M[2-R][c[d]],b[v+3*R+20]=M[8-R][c[d]]*w+M[9+R][c[d]]}t(b,v)}else{for(var E=te(18),R=-9;R<0;R++){var A,k;A=n[y][R+27]*M[R+9][c[d]]+n[y][R+36]*M[8-R][c[d]],k=n[y][R+9]*T[R+9][c[d]]-n[y][R+18]*T[8-R][c[d]],E[R+9]=A-k*s[3+R+9],E[R+18]=A*s[3+R+9]+k}a(b,v,E)}}if(y!=de.SHORT_TYPE&&0!=d)for(R=7;R>=0;--R){var B,P;B=b[v+R]*o[20+R]+b[v+-1-R]*l[28+R],P=b[v+R]*l[28+R]-b[v+-1-R]*o[20+R],b[v+-1-R]=B,b[v+R]=P}}}if(f=_,u=286,1==r.mode_gr)for(var x=0;x<18;x++)J.arraycopy(r.sb_sample[p][1][x],0,r.sb_sample[p][0][x],0,32)}}},re=W.System,ne=W.new_float,se=W.new_float_n,ie=function(){this.l=ne(de.SBMAX_l),this.s=se([de.SBMAX_s,3]);var e=this;this.assign=function(t){re.arraycopy(t.l,0,e.l,0,de.SBMAX_l);for(var a=0;a<de.SBMAX_s;a++)for(var r=0;r<3;r++)e.s[a][r]=t.s[a][r]}},oe=function(){this.thm=new ie,this.en=new ie},le=W.System,ce=W.VbrMode,_e=W.new_array_n,fe=W.new_float,ue=W.new_float_n,pe=W.new_int,he=W.assert;p.ENCDELAY=576,p.POSTDELAY=1152,p.MDCTDELAY=48,p.FFTOFFSET=224+p.MDCTDELAY,p.DECDELAY=528,p.SBLIMIT=32,p.CBANDS=64,p.SBPSY_l=21,p.SBPSY_s=12,p.SBMAX_l=22,p.SBMAX_s=13,p.PSFB21=6,p.PSFB12=6,p.BLKSIZE=1024,p.HBLKSIZE=p.BLKSIZE/2+1,p.BLKSIZE_s=256,p.HBLKSIZE_s=p.BLKSIZE_s/2+1,p.NORM_TYPE=0,p.START_TYPE=1,p.SHORT_TYPE=2,p.STOP_TYPE=3,p.MPG_MD_LR_LR=0,p.MPG_MD_LR_I=1,p.MPG_MD_MS_LR=2,p.MPG_MD_MS_I=3,p.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3.898045e-17,.0467745*5,.50455,.756825,.187098*5];var de=p,me=W.Util,be=W.new_float,ve=function(){function e(e,t,a){var n,s,i,o=0,l=t+(a<<=1);n=4;do{var c,_,f,u,p,h,d;d=n>>1,h=(p=n<<1)+(u=n),n=p<<1,i=(s=t)+d;do{y=e[s+0]-e[s+u],R=e[s+0]+e[s+u],E=e[s+p]-e[s+h],M=e[s+p]+e[s+h],e[s+p]=R-M,e[s+0]=R+M,e[s+h]=y-E,e[s+u]=y+E,y=e[i+0]-e[i+u],R=e[i+0]+e[i+u],E=me.SQRT2*e[i+h],M=me.SQRT2*e[i+p],e[i+p]=R-M,e[i+0]=R+M,e[i+h]=y-E,e[i+u]=y+E,i+=n,s+=n}while(s<l);for(_=r[o+0],c=r[o+1],f=1;f<d;f++){var m,b;m=1-2*c*c,b=2*c*_,s=t+f,i=t+u-f;do{var v,g,S,R,y,T,M,w,E,A;g=b*e[s+u]-m*e[i+u],v=m*e[s+u]+b*e[i+u],y=e[s+0]-v,R=e[s+0]+v,T=e[i+0]-g,S=e[i+0]+g,g=b*e[s+h]-m*e[i+h],v=m*e[s+h]+b*e[i+h],E=e[s+p]-v,M=e[s+p]+v,A=e[i+p]-g,w=e[i+p]+g,g=c*M-_*A,v=_*M+c*A,e[s+p]=R-v,e[s+0]=R+v,e[i+h]=T-g,e[i+u]=T+g,g=_*w-c*E,v=c*w+_*E,e[i+p]=S-v,e[i+0]=S+v,e[s+h]=y-g,e[s+u]=y+g,i+=n,s+=n}while(s<l);_=(m=_)*r[o+0]-c*r[o+1],c=m*r[o+1]+c*r[o+0]}o+=2}while(n<a)}var t=be(de.BLKSIZE),a=be(de.BLKSIZE_s/2),r=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475],n=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(t,r,s,i,o){for(var l=0;l<3;l++){var c=de.BLKSIZE_s/2,_=65535&192*(l+1),f=de.BLKSIZE_s/8-1;do{var u,p,h,d,m,b=255&n[f<<2];p=(u=a[b]*i[s][o+b+_])-(m=a[127-b]*i[s][o+b+_+128]),u+=m,d=(h=a[b+64]*i[s][o+b+_+64])-(m=a[63-b]*i[s][o+b+_+192]),h+=m,c-=4,r[l][c+0]=u+h,r[l][c+2]=u-h,r[l][c+1]=p+d,r[l][c+3]=p-d,p=(u=a[b+1]*i[s][o+b+_+1])-(m=a[126-b]*i[s][o+b+_+129]),u+=m,d=(h=a[b+65]*i[s][o+b+_+65])-(m=a[62-b]*i[s][o+b+_+193]),h+=m,r[l][c+de.BLKSIZE_s/2+0]=u+h,r[l][c+de.BLKSIZE_s/2+2]=u-h,r[l][c+de.BLKSIZE_s/2+1]=p+d,r[l][c+de.BLKSIZE_s/2+3]=p-d}while(--f>=0);e(r[l],c,de.BLKSIZE_s/2)}},this.fft_long=function(a,r,s,i,o){var l=de.BLKSIZE/8-1,c=de.BLKSIZE/2;do{var _,f,u,p,h,d=255&n[l];f=(_=t[d]*i[s][o+d])-(h=t[d+512]*i[s][o+d+512]),_+=h,p=(u=t[d+256]*i[s][o+d+256])-(h=t[d+768]*i[s][o+d+768]),u+=h,r[0+(c-=4)]=_+u,r[c+2]=_-u,r[c+1]=f+p,r[c+3]=f-p,f=(_=t[d+1]*i[s][o+d+1])-(h=t[d+513]*i[s][o+d+513]),_+=h,p=(u=t[d+257]*i[s][o+d+257])-(h=t[d+769]*i[s][o+d+769]),u+=h,r[c+de.BLKSIZE/2+0]=_+u,r[c+de.BLKSIZE/2+2]=_-u,r[c+de.BLKSIZE/2+1]=f+p,r[c+de.BLKSIZE/2+3]=f-p}while(--l>=0);e(r,c,de.BLKSIZE/2)},this.init_fft=function(e){for(r=0;r<de.BLKSIZE;r++)t[r]=.42-.5*Math.cos(2*Math.PI*(r+.5)/de.BLKSIZE)+.08*Math.cos(4*Math.PI*(r+.5)/de.BLKSIZE);for(var r=0;r<de.BLKSIZE_s/2;r++)a[r]=.5*(1-Math.cos(2*Math.PI*(r+.5)/de.BLKSIZE_s))}},ge=W.VbrMode,Se=W.Float,Re=W.ShortBlock,ye=W.Util,Te=W.Arrays,Me=W.new_float,we=W.new_float_n,Ee=W.new_int,Ae=W.assert,ke=function(){function e(e){return e}function t(e,t){for(var a=0,r=0;r<de.BLKSIZE/2;++r)a+=e[r]*t.ATH.eql_w[r];return a*=K}function a(a,r,n,s,i,o,l,c,_,f,u){var p=a.internal_flags;if(_<2)X.fft_long(p,s[i],_,f,u),X.fft_short(p,o[l],_,f,u);else if(2==_){for(S=de.BLKSIZE-1;S>=0;--S){var h=s[i+0][S],d=s[i+1][S];s[i+0][S]=(h+d)*ye.SQRT2*.5,s[i+1][S]=(h-d)*ye.SQRT2*.5}for(v=2;v>=0;--v)for(S=de.BLKSIZE_s-1;S>=0;--S){var h=o[l+0][v][S],d=o[l+1][v][S];o[l+0][v][S]=(h+d)*ye.SQRT2*.5,o[l+1][v][S]=(h-d)*ye.SQRT2*.5}}for(r[0]=e(s[i+0][0]),r[0]*=r[0],S=de.BLKSIZE/2-1;S>=0;--S){var m=s[i+0][de.BLKSIZE/2-S],b=s[i+0][de.BLKSIZE/2+S];r[de.BLKSIZE/2-S]=e(.5*(m*m+b*b))}for(var v=2;v>=0;--v)for(n[v][0]=o[l+0][v][0],n[v][0]*=n[v][0],S=de.BLKSIZE_s/2-1;S>=0;--S){var m=o[l+0][v][de.BLKSIZE_s/2-S],b=o[l+0][v][de.BLKSIZE_s/2+S];n[v][de.BLKSIZE_s/2-S]=e(.5*(m*m+b*b))}for(var g=0,S=11;S<de.HBLKSIZE;S++)g+=r[S];if(p.tot_ener[_]=g,a.analysis){for(S=0;S<de.HBLKSIZE;S++)p.pinfo.energy[c][_][S]=p.pinfo.energy_save[_][S],p.pinfo.energy_save[_][S]=r[S];p.pinfo.pe[c][_]=p.pe[_]}2==a.athaa_loudapprox&&_<2&&(p.loudness_sq[c][_]=p.loudness_sq_save[_],p.loudness_sq_save[_]=t(r,p))}function r(){V=Math.pow(10,(J+1)/16),H=Math.pow(10,($+1)/16),j=Math.pow(10,ee/10)}function n(e,t,a,r,n,s){var i;if(t>e){if(!(t<e*H))return e+t;i=t/e}else{if(e>=t*H)return e+t;i=e/t}if(Ae(e>=0),Ae(t>=0),e+=t,r+3<=6)return i>=V?e:(o=0|ye.FAST_LOG10_X(i,16),e*re[o]);var o=0|ye.FAST_LOG10_X(i,16);if(t=0!=s?n.ATH.cb_s[a]*n.ATH.adjust:n.ATH.cb_l[a]*n.ATH.adjust,Ae(t>=0),e<j*t){if(e>t){var l,c;return l=1,o<=13&&(l=ne[o]),c=ye.FAST_LOG10_X(e/t,10/15),e*((ae[o]-l)*c+l)}return o>13?e:e*ne[o]}return e*ae[o]}function s(e,t,a){var r;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(r=t>e?t/e:e/t,-2<=a&&a<=2){if(r>=V)return e+t;var n=0|ye.FAST_LOG10_X(r,16);return(e+t)*se[n]}return r<H?e+t:(e<t&&(e=t),e)}function i(e,t){var a=e.internal_flags;if(a.channels_out>1){for(s=0;s<de.SBMAX_l;s++){var r=a.thm[0].l[s],n=a.thm[1].l[s];a.thm[0].l[s]+=n*t,a.thm[1].l[s]+=r*t}for(var s=0;s<de.SBMAX_s;s++)for(var i=0;i<3;i++){var r=a.thm[0].s[s][i],n=a.thm[1].s[s][i];a.thm[0].s[s][i]+=n*t,a.thm[1].s[s][i]+=r*t}}}function o(e){for(r=0;r<de.SBMAX_l;r++)if(!(e.thm[0].l[r]>1.58*e.thm[1].l[r]||e.thm[1].l[r]>1.58*e.thm[0].l[r])){var t=e.mld_l[r]*e.en[3].l[r],a=Math.max(e.thm[2].l[r],Math.min(e.thm[3].l[r],t));t=e.mld_l[r]*e.en[2].l[r],s=Math.max(e.thm[3].l[r],Math.min(e.thm[2].l[r],t)),e.thm[2].l[r]=a,e.thm[3].l[r]=s}for(var r=0;r<de.SBMAX_s;r++)for(var n=0;n<3;n++)if(!(e.thm[0].s[r][n]>1.58*e.thm[1].s[r][n]||e.thm[1].s[r][n]>1.58*e.thm[0].s[r][n])){var t=e.mld_s[r]*e.en[3].s[r][n],a=Math.max(e.thm[2].s[r][n],Math.min(e.thm[3].s[r][n],t));t=e.mld_s[r]*e.en[2].s[r][n];var s=Math.max(e.thm[3].s[r][n],Math.min(e.thm[2].s[r][n],t));e.thm[2].s[r][n]=a,e.thm[3].s[r][n]=s}}function l(e,t,a){var r=t,n=Math.pow(10,a);for(t*=2,r*=2,s=0;s<de.SBMAX_l;s++)_=e.ATH.cb_l[e.bm_l[s]]*n,(o=Math.min(Math.max(e.thm[0].l[s],_),Math.max(e.thm[1].l[s],_)))*t<(l=Math.max(e.thm[2].l[s],_))+(c=Math.max(e.thm[3].l[s],_))&&Ae((l*=f=o*r/(l+c))+(c*=f)>0),e.thm[2].l[s]=Math.min(l,e.thm[2].l[s]),e.thm[3].l[s]=Math.min(c,e.thm[3].l[s]);n*=de.BLKSIZE_s/de.BLKSIZE;for(var s=0;s<de.SBMAX_s;s++)for(var i=0;i<3;i++){var o,l,c,_;if(_=e.ATH.cb_s[e.bm_s[s]]*n,o=Math.min(Math.max(e.thm[0].s[s][i],_),Math.max(e.thm[1].s[s][i],_)),l=Math.max(e.thm[2].s[s][i],_),c=Math.max(e.thm[3].s[s][i],_),o*t<l+c){var f=o*t/(l+c);Ae((l*=f)+(c*=f)>0)}e.thm[2].s[s][i]=Math.min(e.thm[2].s[s][i],l),e.thm[3].s[s][i]=Math.min(e.thm[3].s[s][i],c)}}function c(e,t,a,r,n){var s,i,o=0,l=0;for(s=i=0;s<de.SBMAX_s;++i,++s){for(var c=e.bo_s[s],_=e.npart_s,f=c<_?c:_;i<f;)Ae(t[i]>=0),Ae(a[i]>=0),o+=t[i],l+=a[i],i++;if(e.en[r].s[s][n]=o,e.thm[r].s[s][n]=l,i>=_){++s;break}Ae(t[i]>=0),Ae(a[i]>=0);var u=e.PSY.bo_s_weight[s],p=1-u;o=u*t[i],l=u*a[i],e.en[r].s[s][n]+=o,e.thm[r].s[s][n]+=l,o=p*t[i],l=p*a[i]}for(;s<de.SBMAX_s;++s)e.en[r].s[s][n]=0,e.thm[r].s[s][n]=0}function _(e,t,a,r){var n,s,i=0,o=0;for(n=s=0;n<de.SBMAX_l;++s,++n){for(var l=e.bo_l[n],c=e.npart_l,_=l<c?l:c;s<_;)Ae(t[s]>=0),Ae(a[s]>=0),i+=t[s],o+=a[s],s++;if(e.en[r].l[n]=i,e.thm[r].l[n]=o,s>=c){++n;break}Ae(t[s]>=0),Ae(a[s]>=0);var f=e.PSY.bo_l_weight[n],u=1-f;i=f*t[s],o=f*a[s],e.en[r].l[n]+=i,e.thm[r].l[n]+=o,i=u*t[s],o=u*a[s]}for(;n<de.SBMAX_l;++n)e.en[r].l[n]=0,e.thm[r].l[n]=0}function f(e,t,a,r,n,s){var i,o,l=e.internal_flags;for(o=i=0;o<l.npart_s;++o){for(var c=0,_=0,f=l.numlines_s[o],u=0;u<f;++u,++i){var p=t[s][i];c+=p,_<p&&(_=p)}a[o]=c}for(Ae(o==l.npart_s),Ae(129==i),i=o=0;o<l.npart_s;o++){var h=l.s3ind_s[o][0],d=l.s3_ss[i++]*a[h];for(++h;h<=l.s3ind_s[o][1];)d+=l.s3_ss[i]*a[h],++i,++h;if(m=Y*l.nb_s1[n][o],r[o]=Math.min(d,m),l.blocktype_old[1&n]==de.SHORT_TYPE){var m=U*l.nb_s2[n][o],b=r[o];r[o]=Math.min(m,b)}l.nb_s2[n][o]=l.nb_s1[n][o],l.nb_s1[n][o]=d,Ae(r[o]>=0)}for(;o<=de.CBANDS;++o)a[o]=0,r[o]=0}function u(e,t,a,r){var n=e.internal_flags;e.short_blocks!=Re.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var s=0;s<n.channels_out;s++)r[s]=de.NORM_TYPE,e.short_blocks==Re.short_block_dispensed&&(t[s]=1),e.short_blocks==Re.short_block_forced&&(t[s]=0),0!=t[s]?(Ae(n.blocktype_old[s]!=de.START_TYPE),n.blocktype_old[s]==de.SHORT_TYPE&&(r[s]=de.STOP_TYPE)):(r[s]=de.SHORT_TYPE,n.blocktype_old[s]==de.NORM_TYPE&&(n.blocktype_old[s]=de.START_TYPE),n.blocktype_old[s]==de.STOP_TYPE&&(n.blocktype_old[s]=de.SHORT_TYPE)),a[s]=n.blocktype_old[s],n.blocktype_old[s]=r[s]}function p(e,t,a){return a>=1?e:a<=0?t:t>0?Math.pow(e/t,a)*t:0}function h(e,t){for(var a=309.07,r=0;r<de.SBMAX_s-1;r++)for(var n=0;n<3;n++){var s=e.thm.s[r][n];if(Ae(r<ie.length),s>0){var i=s*t,o=e.en.s[r][n];o>i&&(o>1e10*i?a+=ie[r]*(10*F):(Ae(i>0),a+=ie[r]*ye.FAST_LOG10(o/i)))}}return a}function d(e,t){for(var a=281.0575,r=0;r<de.SBMAX_l-1;r++){var n=e.thm.l[r];if(Ae(r<oe.length),n>0){var s=n*t,i=e.en.l[r];i>s&&(i>1e10*s?a+=oe[r]*(10*F):(Ae(s>0),a+=oe[r]*ye.FAST_LOG10(i/s)))}}return a}function m(e,t,a,r,n){var s,i;for(s=i=0;s<e.npart_l;++s){var o,l=0,c=0;for(o=0;o<e.numlines_l[s];++o,++i){var _=t[i];Ae(_>=0),l+=_,c<_&&(c=_)}a[s]=l,r[s]=c,n[s]=l*e.rnumlines_l[s],Ae(e.rnumlines_l[s]>=0),Ae(l>=0),Ae(a[s]>=0),Ae(r[s]>=0),Ae(n[s]>=0)}}function b(e,t,a,r){var n=te.length-1,s=0,i=a[s]+a[s+1];for(Ae(i>=0),i>0?((o=t[s])<t[s+1]&&(o=t[s+1]),Ae(e.numlines_l[s]+e.numlines_l[s+1]-1>0),(l=0|(i=20*(2*o-i)/(i*(e.numlines_l[s]+e.numlines_l[s+1]-1))))>n&&(l=n),r[s]=l):r[s]=0,s=1;s<e.npart_l-1;s++)i=a[s-1]+a[s]+a[s+1],Ae(i>=0),i>0?((o=t[s-1])<t[s]&&(o=t[s]),o<t[s+1]&&(o=t[s+1]),Ae(e.numlines_l[s-1]+e.numlines_l[s]+e.numlines_l[s+1]-1>0),(l=0|(i=20*(3*o-i)/(i*(e.numlines_l[s-1]+e.numlines_l[s]+e.numlines_l[s+1]-1))))>n&&(l=n),r[s]=l):r[s]=0;if(Ae(s>0),Ae(s==e.npart_l-1),i=a[s-1]+a[s],Ae(i>=0),i>0){var o=t[s-1];o<t[s]&&(o=t[s]),Ae(e.numlines_l[s-1]+e.numlines_l[s]-1>0);var l=0|(i=20*(2*o-i)/(i*(e.numlines_l[s-1]+e.numlines_l[s]-1)));l>n&&(l=n),r[s]=l}else r[s]=0;Ae(s==e.npart_l-1)}function v(t,a,r,n,s,i,o,l){var c=t.internal_flags;if(n<2)X.fft_long(c,o[l],n,a,r);else if(2==n)for(d=de.BLKSIZE-1;d>=0;--d){var _=o[l+0][d],f=o[l+1][d];o[l+0][d]=(_+f)*ye.SQRT2*.5,o[l+1][d]=(_-f)*ye.SQRT2*.5}for(i[0]=e(o[l+0][0]),i[0]*=i[0],d=de.BLKSIZE/2-1;d>=0;--d){var u=o[l+0][de.BLKSIZE/2-d],p=o[l+0][de.BLKSIZE/2+d];i[de.BLKSIZE/2-d]=e(.5*(u*u+p*p))}for(var h=0,d=11;d<de.HBLKSIZE;d++)h+=i[d];if(c.tot_ener[n]=h,t.analysis){for(d=0;d<de.HBLKSIZE;d++)c.pinfo.energy[s][n][d]=c.pinfo.energy_save[n][d],c.pinfo.energy_save[n][d]=i[d];c.pinfo.pe[s][n]=c.pe[n]}}function g(t,a,r,n,s,i,o,l){var c=t.internal_flags;if(0==s&&n<2&&X.fft_short(c,o[l],n,a,r),2==n)for(u=de.BLKSIZE_s-1;u>=0;--u){var _=o[l+0][s][u],f=o[l+1][s][u];o[l+0][s][u]=(_+f)*ye.SQRT2*.5,o[l+1][s][u]=(_-f)*ye.SQRT2*.5}i[s][0]=o[l+0][s][0],i[s][0]*=i[s][0];for(var u=de.BLKSIZE_s/2-1;u>=0;--u){var p=o[l+0][s][de.BLKSIZE_s/2-u],h=o[l+0][s][de.BLKSIZE_s/2+u];i[s][de.BLKSIZE_s/2-u]=e(.5*(p*p+h*h))}}function S(e,a,r,n){var s=e.internal_flags;2==e.athaa_loudapprox&&r<2&&(s.loudness_sq[a][r]=s.loudness_sq_save[r],s.loudness_sq_save[r]=t(n,s))}function R(e,t,a,r,n,s,i,o,l,c){for(var _=we([2,576]),f=e.internal_flags,u=f.channels_out,p=e.mode==MPEGMode.JOINT_STEREO?4:u,h=0;h<u;h++){firbuf=t[h];var d=a+576-350-Q+192;for(Ae(ce.length==(Q-1)/2),w=0;w<576;w++){var m,b;for(m=firbuf[d+w+10],b=0,E=0;E<(Q-1)/2-1;E+=2)m+=ce[E]*(firbuf[d+w+E]+firbuf[d+w+Q-E]),b+=ce[E+1]*(firbuf[d+w+E+1]+firbuf[d+w+Q-E-1]);_[h][w]=m+b}n[r][h].en.assign(f.en[h]),n[r][h].thm.assign(f.thm[h]),p>2&&(s[r][h].en.assign(f.en[h+2]),s[r][h].thm.assign(f.thm[h+2]))}for(h=0;h<p;h++){var v=Me(12),g=Me(12),S=[0,0,0,0],R=_[1&h],y=0,T=3==h?f.nsPsy.attackthre_s:f.nsPsy.attackthre,M=1;if(2==h)for(var w=0,E=576;E>0;++w,--E){var A=_[0][w],k=_[1][w];_[0][w]=A+k,_[1][w]=A-k}for(w=0;w<3;w++)g[w]=f.nsPsy.last_en_subshort[h][w+6],Ae(f.nsPsy.last_en_subshort[h][w+4]>0),v[w]=g[w]/f.nsPsy.last_en_subshort[h][w+4],S[0]+=g[w];for(w=0;w<9;w++){for(var B=y+64,P=1;y<B;y++)P<Math.abs(R[y])&&(P=Math.abs(R[y]));f.nsPsy.last_en_subshort[h][w]=g[w+3]=P,S[1+w/3]+=P,P>g[w+3-2]?(Ae(g[w+3-2]>0),P/=g[w+3-2]):g[w+3-2]>10*P?(Ae(P>0),P=g[w+3-2]/(10*P)):P=0,v[w+3]=P}for(w=0;w<3;++w){var x=g[3*w+3]+g[3*w+4]+g[3*w+5],C=1;6*g[3*w+5]<x&&(C*=.5,6*g[3*w+4]<x&&(C*=.5)),o[h][w]=C}if(e.analysis){for(var O=v[0],w=1;w<12;w++)O<v[w]&&(O=v[w]);f.pinfo.ers[r][h]=f.pinfo.ers_save[h],f.pinfo.ers_save[h]=O}for(w=0;w<12;w++)0==l[h][w/3]&&v[w]>T&&(l[h][w/3]=w%3+1);for(w=1;w<4;w++){var I=S[w-1],L=S[w];Math.max(I,L)<4e4&&I<1.7*L&&L<1.7*I&&(1==w&&l[h][0]<=l[h][w]&&(l[h][0]=0),l[h][w]=0)}l[h][0]<=f.nsPsy.lastAttacks[h]&&(l[h][0]=0),3!=f.nsPsy.lastAttacks[h]&&l[h][0]+l[h][1]+l[h][2]+l[h][3]==0||(M=0,0!=l[h][1]&&0!=l[h][0]&&(l[h][1]=0),0!=l[h][2]&&0!=l[h][1]&&(l[h][2]=0),0!=l[h][3]&&0!=l[h][2]&&(l[h][3]=0)),h<2?c[h]=M:0==M&&(c[0]=c[1]=0),i[h]=f.tot_ener[h]}}function y(e,t,a){if(0==a)for(var r=0;r<e.npart_s;r++)e.nb_s2[t][r]=e.nb_s1[t][r],e.nb_s1[t][r]=0}function T(e,t){for(var a=0;a<e.npart_l;a++)e.nb_2[t][a]=e.nb_1[t][a],e.nb_1[t][a]=0}function M(e,t,a,r){var n=te.length-1,s=0,i=a[s]+a[s+1];for(Ae(i>=0),i>0?((o=t[s])<t[s+1]&&(o=t[s+1]),Ae(e.numlines_s[s]+e.numlines_s[s+1]-1>0),(l=0|(i=20*(2*o-i)/(i*(e.numlines_s[s]+e.numlines_s[s+1]-1))))>n&&(l=n),r[s]=l):r[s]=0,s=1;s<e.npart_s-1;s++)i=a[s-1]+a[s]+a[s+1],Ae(s+1<e.npart_s),Ae(i>=0),i>0?((o=t[s-1])<t[s]&&(o=t[s]),o<t[s+1]&&(o=t[s+1]),Ae(e.numlines_s[s-1]+e.numlines_s[s]+e.numlines_s[s+1]-1>0),(l=0|(i=20*(3*o-i)/(i*(e.numlines_s[s-1]+e.numlines_s[s]+e.numlines_s[s+1]-1))))>n&&(l=n),r[s]=l):r[s]=0;if(Ae(s>0),Ae(s==e.npart_s-1),i=a[s-1]+a[s],Ae(i>=0),i>0){var o=t[s-1];o<t[s]&&(o=t[s]),Ae(e.numlines_s[s-1]+e.numlines_s[s]-1>0);var l=0|(i=20*(2*o-i)/(i*(e.numlines_s[s-1]+e.numlines_s[s]-1)));l>n&&(l=n),r[s]=l}else r[s]=0;Ae(s==e.npart_s-1)}function w(e,t,a,r,n,i){var o,l,c,_=e.internal_flags,f=new float[de.CBANDS],u=Me(de.CBANDS),p=new int[de.CBANDS];for(c=l=0;c<_.npart_s;++c){var h=0,d=0,m=_.numlines_s[c];for(o=0;o<m;++o,++l){var b=t[i][l];h+=b,d<b&&(d=b)}a[c]=h,Ae(h>=0),f[c]=d,Ae(m>0),u[c]=h/m,Ae(u[c]>=0)}for(Ae(c==_.npart_s),Ae(129==l);c<de.CBANDS;++c)f[c]=0,u[c]=0;for(M(_,f,u,p),l=c=0;c<_.npart_s;c++){var v,g,S,R,y,T=_.s3ind_s[c][0],w=_.s3ind_s[c][1];for(v=p[T],g=1,R=_.s3_ss[l]*a[T]*te[p[T]],++l,++T;T<=w;)v+=p[T],g+=1,R=s(R,S=_.s3_ss[l]*a[T]*te[p[T]],T-c),++l,++T;R*=y=.5*te[v=(1+2*v)/(2*g)],r[c]=R,_.nb_s2[n][c]=_.nb_s1[n][c],_.nb_s1[n][c]=R,S=f[c],S*=_.minval_s[c],S*=y,r[c]>S&&(r[c]=S),_.masking_lower>1&&(r[c]*=_.masking_lower),r[c]>a[c]&&(r[c]=a[c]),_.masking_lower<1&&(r[c]*=_.masking_lower),Ae(r[c]>=0)}for(;c<de.CBANDS;++c)a[c]=0,r[c]=0}function E(e,t,a,r,n){var i,o=Me(de.CBANDS),l=Me(de.CBANDS),c=Ee(de.CBANDS+2);m(e,t,a,o,l),b(e,o,l,c);var _=0;for(i=0;i<e.npart_l;i++){var f,u,p,h=e.s3ind[i][0],d=e.s3ind[i][1],v=0,g=0;for(v=c[h],g+=1,u=e.s3_ll[_]*a[h]*te[c[h]],++_,++h;h<=d;)v+=c[h],g+=1,u=s(u,f=e.s3_ll[_]*a[h]*te[c[h]],h-i),++_,++h;if(v=(1+2*v)/(2*g),p=.5*te[v],u*=p,e.blocktype_old[1&n]==de.SHORT_TYPE)S=G*e.nb_1[n][i],r[i]=S>0?Math.min(u,S):Math.min(u,a[i]*Z);else{var S,R=q*e.nb_2[n][i],y=G*e.nb_1[n][i];R<=0&&(R=u),y<=0&&(y=u),S=e.blocktype_old[1&n]==de.NORM_TYPE?Math.min(y,R):y,r[i]=Math.min(u,S)}e.nb_2[n][i]=e.nb_1[n][i],e.nb_1[n][i]=u,f=o[i],f*=e.minval_l[i],f*=p,r[i]>f&&(r[i]=f),e.masking_lower>1&&(r[i]*=e.masking_lower),r[i]>a[i]&&(r[i]=a[i]),e.masking_lower<1&&(r[i]*=e.masking_lower),Ae(r[i]>=0)}for(;i<de.CBANDS;++i)a[i]=0,r[i]=0}function A(e,t){var a=e.internal_flags;e.short_blocks!=Re.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var r=0;r<a.channels_out;r++)e.short_blocks==Re.short_block_dispensed&&(t[r]=1),e.short_blocks==Re.short_block_forced&&(t[r]=0)}function k(e,t,a){for(var r=e.internal_flags,n=0;n<r.channels_out;n++){var s=de.NORM_TYPE;0!=t[n]?(Ae(r.blocktype_old[n]!=de.START_TYPE),r.blocktype_old[n]==de.SHORT_TYPE&&(s=de.STOP_TYPE)):(s=de.SHORT_TYPE,r.blocktype_old[n]==de.NORM_TYPE&&(r.blocktype_old[n]=de.START_TYPE),r.blocktype_old[n]==de.STOP_TYPE&&(r.blocktype_old[n]=de.SHORT_TYPE)),a[n]=r.blocktype_old[n],r.blocktype_old[n]=s}}function B(e,t,a,r,n,s,i){for(var o,l,c=2*s,_=s>0?Math.pow(10,n):1,f=0;f<i;++f){var u=e[2][f],p=e[3][f],h=t[0][f],d=t[1][f],m=t[2][f],b=t[3][f];if(h<=1.58*d&&d<=1.58*h){var v=a[f]*p,g=a[f]*u;l=Math.max(m,Math.min(b,v)),o=Math.max(b,Math.min(m,g))}else l=m,o=b;if(s>0){var S,R,y=r[f]*_;if(S=Math.min(Math.max(h,y),Math.max(d,y)),m=Math.max(l,y),b=Math.max(o,y),(R=m+b)>0&&S*c<R){var T=S*c/R;m*=T,b*=T,Ae(R>0)}l=Math.min(m,l),o=Math.min(b,o)}l>u&&(l=u),o>p&&(o=p),t[2][f]=l,t[3][f]=o}}function P(e,t){var a,r=e;return(a=r>=0?27*-r:r*t)<=-72?0:Math.exp(a*W)}function x(e){var t=0,a=0,r=0;for(r=0;P(r,e)>1e-20;r-=1);for(n=r,s=0;Math.abs(s-n)>1e-12;)P(r=(s+n)/2,e)>0?s=r:n=r;t=n;var n,s,r=0;for(r=0;P(r,e)>1e-20;r+=1);for(n=0,s=r;Math.abs(s-n)>1e-12;)P(r=(s+n)/2,e)>0?n=r:s=r;a=s;var i,o=0;for(i=0;i<=1e3;++i)o+=P(r=t+i*(a-t)/1e3,e);return 1001/(o*(a-t))}function C(e){var t,a,r,n;return t=e,t*=t>=0?3:1.5,a=t>=.5&&t<=2.5?8*((n=t-.5)*n-2*n):0,t+=.474,(r=15.811389+7.5*t-17.5*Math.sqrt(1+t*t))<=-60?0:(t=Math.exp((a+r)*W),t/=.6609193)}function O(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function I(e,t,a,r,n,s,i,o,l,c,_,f){var u,p=Me(de.CBANDS+1),h=o/(f>15?1152:384),d=Ee(de.HBLKSIZE);o/=l;var m=0,b=0;for(u=0;u<de.CBANDS;u++){var v;for(A=O(o*m),p[u]=o*m,v=m;O(o*v)-A<z&&v<=l/2;v++);for(e[u]=v-m,b=u+1;m<v;)Ae(m<de.HBLKSIZE),d[m++]=u;if(m>l/2){m=l/2,++u;break}}Ae(u<de.CBANDS),p[u]=o*m;for(var g=0;g<f;g++){var S,R,y,T,M;y=c[g],T=c[g+1],(S=0|Math.floor(.5+_*(y-.5)))<0&&(S=0),(R=0|Math.floor(.5+_*(T-.5)))>l/2&&(R=l/2),a[g]=(d[S]+d[R])/2,t[g]=d[R];var w=h*T;i[g]=(w-p[t[g]])/(p[t[g]+1]-p[t[g]]),i[g]<0?i[g]=0:i[g]>1&&(i[g]=1),M=O(o*c[g]*_),M=Math.min(M,15.5)/15.5,s[g]=Math.pow(10,1.25*(1-Math.cos(Math.PI*M))-2.5)}m=0;for(var E=0;E<b;E++){var A,k,B=e[E];A=O(o*m),k=O(o*(m+B-1)),r[E]=.5*(A+k),A=O(o*(m-.5)),k=O(o*(m+B-.5)),n[E]=k-A,m+=B}return b}function L(e,t,a,r,n,s){var i,o=we([de.CBANDS,de.CBANDS]),l=0;if(s)for(f=0;f<t;f++)for(i=0;i<t;i++)u=C(a[f]-a[i])*r[i],o[f][i]=u*n[f];else for(i=0;i<t;i++)for(var c=15+Math.min(21/a[i],12),_=x(c),f=0;f<t;f++){var u=_*P(a[f]-a[i],c)*r[i];o[f][i]=u*n[f]}for(f=0;f<t;f++){for(i=0;i<t&&!(o[f][i]>0);i++);for(e[f][0]=i,i=t-1;i>0&&!(o[f][i]>0);i--);e[f][1]=i,l+=e[f][1]-e[f][0]+1}for(var p=Me(l),h=0,f=0;f<t;f++)for(i=e[f][0];i<=e[f][1];i++)p[h++]=o[f][i];return p}function D(e){var t=O(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function N(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}var V,H,j,X=new ve,F=2.302585092994046,G=2,q=16,Y=2,U=16,z=.34,K=1/217621504/(de.BLKSIZE/2),Z=.3,Q=21,W=.2302585093,J=8,$=23,ee=15,te=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],ae=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],re=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],ne=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276],se=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],ie=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130],oe=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1],le=[-1.730326e-17,-.01703172,-1.349528e-17,.0418072,-6.73278e-17,-.0876324,-3.0835e-17,.1863476,-1.104424e-16,-.627638];this.L3psycho_anal_ns=function(e,t,r,s,v,g,S,R,y,T){var M,w,E,A,k,B,P,x,C,O=e.internal_flags,I=we([2,de.BLKSIZE]),L=we([2,3,de.BLKSIZE_s]),D=Me(de.CBANDS+1),N=Me(de.CBANDS+1),V=Me(de.CBANDS+2),H=Ee(2),j=Ee(2),X=we([2,576]),F=Ee(de.CBANDS+2),Y=Ee(de.CBANDS+2);for(Te.fill(Y,0),M=O.channels_out,e.mode==MPEGMode.JOINT_STEREO&&(M=4),C=e.VBR==ge.vbr_off?0==O.ResvMax?0:O.ResvSize/O.ResvMax*.5:e.VBR==ge.vbr_rh||e.VBR==ge.vbr_mtrh||e.VBR==ge.vbr_mt?.6:1,w=0;w<O.channels_out;w++){var U=t[w],z=r+576-350-Q+192;for(Ae(le.length==(Q-1)/2),A=0;A<576;A++){var K,W;for(K=U[z+A+10],W=0,k=0;k<(Q-1)/2-1;k+=2)K+=le[k]*(U[z+A+k]+U[z+A+Q-k]),W+=le[k+1]*(U[z+A+k+1]+U[z+A+Q-k-1]);X[w][A]=K+W}v[s][w].en.assign(O.en[w]),v[s][w].thm.assign(O.thm[w]),M>2&&(g[s][w].en.assign(O.en[w+2]),g[s][w].thm.assign(O.thm[w+2]))}for(w=0;w<M;w++){var J,$=Me(12),ee=[0,0,0,0],ae=Me(12),re=1,ne=Me(de.CBANDS),se=Me(de.CBANDS),ie=[0,0,0,0],oe=Me(de.HBLKSIZE),ce=we([3,de.HBLKSIZE_s]);for(Ae(O.npart_s<=de.CBANDS),Ae(O.npart_l<=de.CBANDS),A=0;A<3;A++)$[A]=O.nsPsy.last_en_subshort[w][A+6],Ae(O.nsPsy.last_en_subshort[w][A+4]>0),ae[A]=$[A]/O.nsPsy.last_en_subshort[w][A+4],ee[0]+=$[A];if(2==w)for(A=0;A<576;A++){var _e,fe;_e=X[0][A],fe=X[1][A],X[0][A]=_e+fe,X[1][A]=_e-fe}var ue=X[1&w],pe=0;for(A=0;A<9;A++){for(var he=pe+64,me=1;pe<he;pe++)me<Math.abs(ue[pe])&&(me=Math.abs(ue[pe]));O.nsPsy.last_en_subshort[w][A]=$[A+3]=me,ee[1+A/3]+=me,me>$[A+3-2]?(Ae($[A+3-2]>0),me/=$[A+3-2]):$[A+3-2]>10*me?(Ae(me>0),me=$[A+3-2]/(10*me)):me=0,ae[A+3]=me}if(e.analysis){var be=ae[0];for(A=1;A<12;A++)be<ae[A]&&(be=ae[A]);O.pinfo.ers[s][w]=O.pinfo.ers_save[w],O.pinfo.ers_save[w]=be}for(J=3==w?O.nsPsy.attackthre_s:O.nsPsy.attackthre,A=0;A<12;A++)0==ie[A/3]&&ae[A]>J&&(ie[A/3]=A%3+1);for(A=1;A<4;A++){var ve;ee[A-1]>ee[A]?(Ae(ee[A]>0),ve=ee[A-1]/ee[A]):(Ae(ee[A-1]>0),ve=ee[A]/ee[A-1]),ve<1.7&&(ie[A]=0,1==A&&(ie[0]=0))}for(0!=ie[0]&&0!=O.nsPsy.lastAttacks[w]&&(ie[0]=0),3!=O.nsPsy.lastAttacks[w]&&ie[0]+ie[1]+ie[2]+ie[3]==0||(re=0,0!=ie[1]&&0!=ie[0]&&(ie[1]=0),0!=ie[2]&&0!=ie[1]&&(ie[2]=0),0!=ie[3]&&0!=ie[2]&&(ie[3]=0)),w<2?j[w]=re:0==re&&(j[0]=j[1]=0),y[w]=O.tot_ener[w],a(e,oe,ce,I,1&w,L,1&w,s,w,t,r),m(O,oe,D,ne,se),b(O,ne,se,F),x=0;x<3;x++){var Se,Re;for(f(e,ce,N,V,w,x),c(O,N,V,w,x),P=0;P<de.SBMAX_s;P++){if(Re=O.thm[w].s[P][x],Re*=.8,ie[x]>=2||1==ie[x+1]){var ye=0!=x?x-1:2,me=p(O.thm[w].s[P][ye],Re,.6*C);Re=Math.min(Re,me)}if(1==ie[x]){var ye=0!=x?x-1:2,me=p(O.thm[w].s[P][ye],Re,Z*C);Re=Math.min(Re,me)}else if(0!=x&&3==ie[x-1]||0==x&&3==O.nsPsy.lastAttacks[w]){var ye=2!=x?x+1:0,me=p(O.thm[w].s[P][ye],Re,Z*C);Re=Math.min(Re,me)}Se=$[3*x+3]+$[3*x+4]+$[3*x+5],6*$[3*x+5]<Se&&(Re*=.5,6*$[3*x+4]<Se&&(Re*=.5)),O.thm[w].s[P][x]=Re}}for(O.nsPsy.lastAttacks[w]=ie[2],B=0,E=0;E<O.npart_l;E++){for(var ke=O.s3ind[E][0],Be=D[ke]*te[F[ke]],Pe=O.s3_ll[B++]*Be;++ke<=O.s3ind[E][1];)Be=D[ke]*te[F[ke]],Pe=n(Pe,O.s3_ll[B++]*Be,ke,ke-E,O,0);Pe*=.158489319246111,O.blocktype_old[1&w]==de.SHORT_TYPE?V[E]=Pe:V[E]=p(Math.min(Pe,Math.min(G*O.nb_1[w][E],q*O.nb_2[w][E])),Pe,C),O.nb_2[w][E]=O.nb_1[w][E],O.nb_1[w][E]=Pe}for(;E<=de.CBANDS;++E)D[E]=0,V[E]=0;_(O,D,V,w)}if(e.mode!=MPEGMode.STEREO&&e.mode!=MPEGMode.JOINT_STEREO||e.interChRatio>0&&i(e,e.interChRatio),e.mode==MPEGMode.JOINT_STEREO){var xe;o(O),xe=e.msfix,Math.abs(xe)>0&&l(O,xe,e.ATHlower*O.ATH.adjust)}for(u(e,j,T,H),w=0;w<M;w++){var Ce,Oe,Ie,Le=0;w>1?(Ce=R,Le=-2,Oe=de.NORM_TYPE,T[0]!=de.SHORT_TYPE&&T[1]!=de.SHORT_TYPE||(Oe=de.SHORT_TYPE),Ie=g[s][w-2]):(Ce=S,Le=0,Oe=T[w],Ie=v[s][w]),Oe==de.SHORT_TYPE?Ce[Le+w]=h(Ie,O.masking_lower):Ce[Le+w]=d(Ie,O.masking_lower),e.analysis&&(O.pinfo.pe[s][w]=Ce[Le+w])}return 0};var ce=[-1.730326e-17,-.01703172,-1.349528e-17,.0418072,-6.73278e-17,-.0876324,-3.0835e-17,.1863476,-1.104424e-16,-.627638];this.L3psycho_anal_vbr=function(e,t,a,r,n,s,i,o,l,f){var u=e.internal_flags,m=Me(de.HBLKSIZE),b=we([3,de.HBLKSIZE_s]),M=we([2,de.BLKSIZE]),P=we([2,3,de.BLKSIZE_s]),x=we([4,de.CBANDS]),C=we([4,de.CBANDS]),O=we([4,3]),I=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],L=Ee(2),D=e.mode==MPEGMode.JOINT_STEREO?4:u.channels_out;for(R(e,t,a,r,n,s,l,O,I,L),A(e,L),q=0;q<D;q++)v(e,t,a,q,r,m,M,N=1&q),S(e,r,q,m),0!=L[N]?E(u,m,x[q],C[q],q):T(u,q);for(L[0]+L[1]==2&&e.mode==MPEGMode.JOINT_STEREO&&B(x,C,u.mld_cb_l,u.ATH.cb_l,e.ATHlower*u.ATH.adjust,e.msfix,u.npart_l),q=0;q<D;q++)0!=L[N=1&q]&&_(u,x[q],C[q],q);for(j=0;j<3;j++){for(q=0;q<D;++q)0!=L[N=1&q]?y(u,q,j):(g(e,t,a,q,j,b,P,N),w(e,b,x[q],C[q],q,j));for(L[0]+L[1]==0&&e.mode==MPEGMode.JOINT_STEREO&&B(x,C,u.mld_cb_s,u.ATH.cb_s,e.ATHlower*u.ATH.adjust,e.msfix,u.npart_s),q=0;q<D;++q)0==L[N=1&q]&&c(u,x[q],C[q],q,j)}for(q=0;q<D;q++){var N=1&q;if(0==L[N])for(var V=0;V<de.SBMAX_s;V++){for(var H=Me(3),j=0;j<3;j++){var X=u.thm[q].s[V][j];if(X*=.8,I[q][j]>=2||1==I[q][j+1]){var F=0!=j?j-1:2,G=p(u.thm[q].s[V][F],X,.36);X=Math.min(X,G)}else if(1==I[q][j]){var F=0!=j?j-1:2,G=p(u.thm[q].s[V][F],X,.6*Z);X=Math.min(X,G)}else if(0!=j&&3==I[q][j-1]||0==j&&3==u.nsPsy.lastAttacks[q]){var F=2!=j?j+1:0,G=p(u.thm[q].s[V][F],X,.6*Z);X=Math.min(X,G)}X*=O[q][j],H[j]=X}for(j=0;j<3;j++)u.thm[q].s[V][j]=H[j]}}for(q=0;q<D;q++)u.nsPsy.lastAttacks[q]=I[q][2];k(e,L,f);for(var q=0;q<D;q++){var Y,U,z,K;q>1?(Y=o,U=-2,z=de.NORM_TYPE,f[0]!=de.SHORT_TYPE&&f[1]!=de.SHORT_TYPE||(z=de.SHORT_TYPE),K=s[r][q-2]):(Y=i,U=0,z=f[q],K=n[r][q]),z==de.SHORT_TYPE?Y[U+q]=h(K,u.masking_lower):Y[U+q]=d(K,u.masking_lower),e.analysis&&(u.pinfo.pe[r][q]=Y[U+q])}return 0},this.psymodel_init=function(e){var t,a=e.internal_flags,n=!0,s=13,i=0,o=0,l=-8.25,c=-4.5,_=Me(de.CBANDS),f=Me(de.CBANDS),u=Me(de.CBANDS),p=e.out_samplerate;switch(e.experimentalZ){default:case 0:n=!0;break;case 1:n=e.VBR!=ge.vbr_mtrh&&e.VBR!=ge.vbr_mt;break;case 2:n=!1;break;case 3:s=8,i=-1.75,o=-.0125,l=-8.25,c=-2.25}for(a.ms_ener_ratio_old=.25,a.blocktype_old[0]=a.blocktype_old[1]=de.NORM_TYPE,t=0;t<4;++t){for(d=0;d<de.CBANDS;++d)a.nb_1[t][d]=1e20,a.nb_2[t][d]=1e20,a.nb_s1[t][d]=a.nb_s2[t][d]=1;for(h=0;h<de.SBMAX_l;h++)a.en[t].l[h]=1e20,a.thm[t].l[h]=1e20;for(d=0;d<3;++d){for(var h=0;h<de.SBMAX_s;h++)a.en[t].s[h][d]=1e20,a.thm[t].s[h][d]=1e20;a.nsPsy.lastAttacks[t]=0}for(d=0;d<9;d++)a.nsPsy.last_en_subshort[t][d]=10}for(a.loudness_sq_save[0]=a.loudness_sq_save[1]=0,a.npart_l=I(a.numlines_l,a.bo_l,a.bm_l,_,f,a.mld_l,a.PSY.bo_l_weight,p,de.BLKSIZE,a.scalefac_band.l,de.BLKSIZE/1152,de.SBMAX_l),Ae(a.npart_l<de.CBANDS),t=0;t<a.npart_l;t++)b=i,_[t]>=s&&(b=o*(_[t]-s)/(24-s)+i*(24-_[t])/(24-s)),u[t]=Math.pow(10,b/10),a.numlines_l[t]>0?a.rnumlines_l[t]=1/a.numlines_l[t]:a.rnumlines_l[t]=0;a.s3_ll=L(a.s3ind,a.npart_l,_,f,u,n);var d=0;for(t=0;t<a.npart_l;t++){for(m=Se.MAX_VALUE,v=0;v<a.numlines_l[t];v++,d++)S=p*d/(1e3*de.BLKSIZE),g=this.ATHformula(1e3*S,e)-20,g=Math.pow(10,.1*g),m>(g*=a.numlines_l[t])&&(m=g);a.ATH.cb_l[t]=m,(m=20*_[t]/10-20)>6&&(m=100),m<-15&&(m=-15),m-=8,a.minval_l[t]=Math.pow(10,m/10)*a.numlines_l[t]}for(a.npart_s=I(a.numlines_s,a.bo_s,a.bm_s,_,f,a.mld_s,a.PSY.bo_s_weight,p,de.BLKSIZE_s,a.scalefac_band.s,de.BLKSIZE_s/384,de.SBMAX_s),Ae(a.npart_s<de.CBANDS),d=0,t=0;t<a.npart_s;t++){var m,b=l;_[t]>=s&&(b=c*(_[t]-s)/(24-s)+l*(24-_[t])/(24-s)),u[t]=Math.pow(10,b/10),m=Se.MAX_VALUE;for(var v=0;v<a.numlines_s[t];v++,d++){var g,S=p*d/(1e3*de.BLKSIZE_s);g=this.ATHformula(1e3*S,e)-20,g=Math.pow(10,.1*g),m>(g*=a.numlines_s[t])&&(m=g)}a.ATH.cb_s[t]=m,m=7*_[t]/12-7,_[t]>12&&(m*=1+3.1*Math.log(1+m)),_[t]<12&&(m*=1+2.3*Math.log(1-m)),m<-15&&(m=-15),m-=8,a.minval_s[t]=Math.pow(10,m/10)*a.numlines_s[t]}a.s3_ss=L(a.s3ind_s,a.npart_s,_,f,u,n),r(),X.init_fft(a),a.decay=Math.exp(-1*F/(.01*p/192));var R;for(R=3.5,0!=(2&e.exp_nspsytune)&&(R=1),Math.abs(e.msfix)>0&&(R=e.msfix),e.msfix=R,w=0;w<a.npart_l;w++)a.s3ind[w][1]>a.npart_l-1&&(a.s3ind[w][1]=a.npart_l-1);var y=576*a.mode_gr/p;if(a.ATH.decay=Math.pow(10,-1.2*y),a.ATH.adjust=.01,a.ATH.adjustLimit=1,Ae(a.bo_l[de.SBMAX_l-1]<=a.npart_l),Ae(a.bo_s[de.SBMAX_s-1]<=a.npart_s),-1!=e.ATHtype){var T=e.out_samplerate/de.BLKSIZE,M=0;for(S=0,t=0;t<de.BLKSIZE/2;++t)S+=T,a.ATH.eql_w[t]=1/Math.pow(10,this.ATHformula(S,e)/10),M+=a.ATH.eql_w[t];for(M=1/M,t=de.BLKSIZE/2;--t>=0;)a.ATH.eql_w[t]*=M}for(w=d=0;w<a.npart_s;++w)for(t=0;t<a.numlines_s[w];++t)++d;Ae(129==d);for(var w=d=0;w<a.npart_l;++w)for(t=0;t<a.numlines_l[w];++t)++d;for(Ae(513==d),d=0,t=0;t<a.npart_l;t++)S=p*(d+a.numlines_l[t]/2)/(1*de.BLKSIZE),a.mld_cb_l[t]=D(S),d+=a.numlines_l[t];for(;t<de.CBANDS;++t)a.mld_cb_l[t]=1;for(d=0,t=0;t<a.npart_s;t++)S=p*(d+a.numlines_s[t]/2)/(1*de.BLKSIZE_s),a.mld_cb_s[t]=D(S),d+=a.numlines_s[t];for(;t<de.CBANDS;++t)a.mld_cb_s[t]=1;return 0},this.ATHformula=function(e,t){var a;switch(t.ATHtype){case 0:a=N(e,9);break;case 1:a=N(e,-1);break;case 2:a=N(e,0);break;case 3:a=N(e,1)+6;break;case 4:a=N(e,t.ATHcurve);break;default:a=N(e,0)}return a}};h.STEREO=new h(0),h.JOINT_STEREO=new h(1),h.DUAL_CHANNEL=new h(2),h.MONO=new h(3),h.NOT_SET=new h(4);var Be=h,Pe=function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=Be.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null},xe={};xe.SFBMAX=3*de.SBMAX_s;var Ce=xe,Oe=W.new_float,Ie=W.new_int,Le=function(){function e(e){return new Int32Array(e)}function t(e){return new Float32Array(e)}this.xr=Oe(576),this.l3_enc=Ie(576),this.scalefac=Ie(Ce.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=Ie(3),this.subblock_gain=Ie(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=Ie(Ce.SFBMAX),this.window=Ie(Ce.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=Ie(4),this.max_nonzero_coeff=0;var a=this;this.assign=function(r){a.xr=t(r.xr),a.l3_enc=e(r.l3_enc),a.scalefac=e(r.scalefac),a.xrpow_max=r.xrpow_max,a.part2_3_length=r.part2_3_length,a.big_values=r.big_values,a.count1=r.count1,a.global_gain=r.global_gain,a.scalefac_compress=r.scalefac_compress,a.block_type=r.block_type,a.mixed_block_flag=r.mixed_block_flag,a.table_select=e(r.table_select),a.subblock_gain=e(r.subblock_gain),a.region0_count=r.region0_count,a.region1_count=r.region1_count,a.preflag=r.preflag,a.scalefac_scale=r.scalefac_scale,a.count1table_select=r.count1table_select,a.part2_length=r.part2_length,a.sfb_lmax=r.sfb_lmax,a.sfb_smin=r.sfb_smin,a.psy_lmax=r.psy_lmax,a.sfbmax=r.sfbmax,a.psymax=r.psymax,a.sfbdivide=r.sfbdivide,a.width=e(r.width),a.window=e(r.window),a.count1bits=r.count1bits,a.sfb_partition_table=r.sfb_partition_table.slice(0),a.slen=e(r.slen),a.max_nonzero_coeff=r.max_nonzero_coeff}},De=W.new_int,Ne=function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[De(4),De(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new Le},Ve=W.System,He=W.new_int,je=function(e,t,a,r){this.l=He(1+de.SBMAX_l),this.s=He(1+de.SBMAX_s),this.psfb21=He(1+de.PSFB21),this.psfb12=He(1+de.PSFB12);var n=this.l,s=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],Ve.arraycopy(this.arrL,0,n,0,Math.min(this.arrL.length,this.l.length)),Ve.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),Ve.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),Ve.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))},Xe=W.new_float,Fe=W.new_float_n,Ge=W.new_int,qe=function(){this.last_en_subshort=Fe([4,9]),this.lastAttacks=Ge(4),this.pefirbuf=Xe(19),this.longfact=Xe(de.SBMAX_l),this.shortfact=Xe(de.SBMAX_s),this.attackthre=0,this.attackthre_s=0},Ye=function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0},Ue=W.new_byte,ze=W.new_double,Ke=W.new_float,Ze=W.new_float_n,Qe=W.new_int,We=W.new_int_n;d.MFSIZE=3456+de.ENCDELAY-de.MDCTDELAY,d.MAX_HEADER_BUF=256,d.MAX_BITS_PER_CHANNEL=4095,d.MAX_BITS_PER_GRANULE=7680,d.BPC=320;var Je=d,$e=W.new_float,et=function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=$e(de.SBMAX_l),this.s=$e(de.SBMAX_s),this.psfb21=$e(de.PSFB21),this.psfb12=$e(de.PSFB12),this.cb_l=$e(de.CBANDS),this.cb_s=$e(de.CBANDS),this.eql_w=$e(de.BLKSIZE/2)},tt=W.System,at=W.Arrays;m.STEPS_per_dB=100,m.MAX_dB=120,m.GAIN_NOT_ENOUGH_SAMPLES=-24601,m.GAIN_ANALYSIS_ERROR=0,m.GAIN_ANALYSIS_OK=1,m.INIT_GAIN_ANALYSIS_ERROR=0,m.INIT_GAIN_ANALYSIS_OK=1,m.YULE_ORDER=10,m.MAX_ORDER=m.YULE_ORDER,m.MAX_SAMP_FREQ=48e3,m.RMS_WINDOW_TIME_NUMERATOR=1,m.RMS_WINDOW_TIME_DENOMINATOR=20,m.MAX_SAMPLES_PER_WINDOW=m.MAX_SAMP_FREQ*m.RMS_WINDOW_TIME_NUMERATOR/m.RMS_WINDOW_TIME_DENOMINATOR+1;var rt=m,nt=W.new_float,st=W.new_int,it=function(){this.linprebuf=nt(2*rt.MAX_ORDER),this.linpre=0,this.lstepbuf=nt(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.lstep=0,this.loutbuf=nt(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.lout=0,this.rinprebuf=nt(2*rt.MAX_ORDER),this.rinpre=0,this.rstepbuf=nt(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.rstep=0,this.routbuf=nt(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=st(0|rt.STEPS_per_dB*rt.MAX_dB),this.B=st(0|rt.STEPS_per_dB*rt.MAX_dB)},ot=function(e){this.bits=e},lt=W.new_float,ct=W.new_int,_t=W.assert,ft=function(e){var t=e;this.quantize=t,this.iteration_loop=function(e,t,a,r){var n,s=e.internal_flags,i=lt(Ce.SFBMAX),o=lt(576),l=ct(2),c=0,_=s.l3_side,f=new ot(c);this.quantize.rv.ResvFrameBegin(e,f),c=f.bits;for(var u=0;u<s.mode_gr;u++){n=this.quantize.qupvt.on_pe(e,t,l,c,u,u),s.mode_ext==de.MPG_MD_MS_LR&&(this.quantize.ms_convert(s.l3_side,u),this.quantize.qupvt.reduce_side(l,a[u],c,n));for(var p=0;p<s.channels_out;p++){var h,d,m=_.tt[u][p];m.block_type!=de.SHORT_TYPE?(h=0,d=s.PSY.mask_adjust-h):(h=0,d=s.PSY.mask_adjust_short-h),s.masking_lower=Math.pow(10,.1*d),this.quantize.init_outer_loop(s,m),this.quantize.init_xrpow(s,m,o)&&(this.quantize.qupvt.calc_xmin(e,r[u][p],m,i),this.quantize.outer_loop(e,m,i,o,p,l[p])),this.quantize.iteration_finish_one(s,u,p),_t(m.part2_3_length<=Je.MAX_BITS_PER_CHANNEL),_t(m.part2_3_length<=l[p])}}this.quantize.rv.ResvFrameEnd(s,c)}},ut={};ut.t1HB=[1,1,1,0],ut.t2HB=[1,2,1,3,1,1,3,2,0],ut.t3HB=[3,2,1,1,1,1,3,2,0],ut.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],ut.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],ut.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],ut.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],ut.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],ut.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],ut.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],ut.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],ut.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],ut.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],ut.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],ut.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],ut.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],ut.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],ut.t1l=[1,4,3,5],ut.t2l=[1,4,7,4,5,7,6,7,8],ut.t3l=[2,3,7,4,4,7,6,7,8],ut.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],ut.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],ut.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],ut.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],ut.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],ut.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],ut.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],ut.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],ut.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],ut.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],ut.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],ut.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],ut.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],ut.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],ut.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8],ut.ht=[new b(0,0,null,null),new b(2,0,ut.t1HB,ut.t1l),new b(3,0,ut.t2HB,ut.t2l),new b(3,0,ut.t3HB,ut.t3l),new b(0,0,null,null),new b(4,0,ut.t5HB,ut.t5l),new b(4,0,ut.t6HB,ut.t6l),new b(6,0,ut.t7HB,ut.t7l),new b(6,0,ut.t8HB,ut.t8l),new b(6,0,ut.t9HB,ut.t9l),new b(8,0,ut.t10HB,ut.t10l),new b(8,0,ut.t11HB,ut.t11l),new b(8,0,ut.t12HB,ut.t12l),new b(16,0,ut.t13HB,ut.t13l),new b(0,0,null,ut.t16_5l),new b(16,0,ut.t15HB,ut.t15l),new b(1,1,ut.t16HB,ut.t16l),new b(2,3,ut.t16HB,ut.t16l),new b(3,7,ut.t16HB,ut.t16l),new b(4,15,ut.t16HB,ut.t16l),new b(6,63,ut.t16HB,ut.t16l),new b(8,255,ut.t16HB,ut.t16l),new b(10,1023,ut.t16HB,ut.t16l),new b(13,8191,ut.t16HB,ut.t16l),new b(4,15,ut.t24HB,ut.t24l),new b(5,31,ut.t24HB,ut.t24l),new b(6,63,ut.t24HB,ut.t24l),new b(7,127,ut.t24HB,ut.t24l),new b(8,255,ut.t24HB,ut.t24l),new b(9,511,ut.t24HB,ut.t24l),new b(11,2047,ut.t24HB,ut.t24l),new b(13,8191,ut.t24HB,ut.t24l),new b(0,0,ut.t32HB,ut.t32l),new b(0,0,ut.t33HB,ut.t33l)],ut.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],ut.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],ut.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],ut.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],ut.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],ut.scfsi_band=[0,6,11,16,21];var pt=ut,ht=W.VbrMode,dt=W.Float,mt=W.Util,bt=W.new_float,vt=W.new_int,gt=W.assert;v.Q_MAX=257,v.Q_MAX2=116,v.LARGE_BITS=1e5,v.IXMAX_VAL=8206;var St=v,Rt=W.System,yt=W.Arrays,Tt=W.new_int,Mt=W.assert,wt=g,Et=W.System,At=W.Arrays,kt=W.new_byte,Bt=W.new_float_n,Pt=W.new_int,xt=W.assert;S.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},S.NEQ=function(e,t){return!S.EQ(e,t)};var Ct=S,Ot=W.System,It=W.VbrMode,Lt=W.ShortBlock,Dt=W.new_float,Nt=W.new_int_n,Vt=W.new_short_n,Ht=W.assert,jt=R,Xt=W.VbrMode,Ft=function(){var e,t;this.setModules=function(a,r){e=a,t=r}},Gt=function(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0},qt=W.new_float,Yt=W.new_int,Ut=function(){this.global_gain=0,this.sfb_count1=0,this.step=Yt(39),this.noise=qt(39),this.noise_log=qt(39)},zt=W.System,Kt=W.VbrMode,Zt=W.Util,Qt=W.Arrays,Wt=W.new_float,Jt=W.assert,$t=W.assert,ea=function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}},ta=W.System,aa=W.VbrMode,ra=W.ShortBlock,na=W.Arrays,sa=W.new_byte,ia=W.assert;y.NUMTOCENTRIES=100,y.MAXFRAMESIZE=2880;var oa=y,la=W.new_byte,ca=W.assert;Lame=jt,Presets=function(){function e(e,t,a,r,n,s,i,o,l,c,_,f,u,p,h){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=a,this.expY=r,this.st_lrm=n,this.st_s=s,this.masking_adj=i,this.masking_adj_short=o,this.ath_lower=l,this.ath_curve=c,this.ath_sensitivity=_,this.interch=f,this.safejoint=u,this.sfb21mod=p,this.msfix=h}function t(e,t,a,r,n,s,i,o,l,c,_,f,u,p){this.quant_comp=t,this.quant_comp_s=a,this.safejoint=r,this.nsmsfix=n,this.st_lrm=s,this.st_s=i,this.nsbass=o,this.scale=l,this.masking_adj=c,this.ath_lower=_,this.ath_curve=f,this.interch=u,this.sfscale=p}function a(e,t,a){var r=e.VBR==Xt.vbr_rh?i:o,s=e.VBR_q_frac,l=r[t],c=r[t+1],_=l;l.st_lrm=l.st_lrm+s*(c.st_lrm-l.st_lrm),l.st_s=l.st_s+s*(c.st_s-l.st_s),l.masking_adj=l.masking_adj+s*(c.masking_adj-l.masking_adj),l.masking_adj_short=l.masking_adj_short+s*(c.masking_adj_short-l.masking_adj_short),l.ath_lower=l.ath_lower+s*(c.ath_lower-l.ath_lower),l.ath_curve=l.ath_curve+s*(c.ath_curve-l.ath_curve),l.ath_sensitivity=l.ath_sensitivity+s*(c.ath_sensitivity-l.ath_sensitivity),l.interch=l.interch+s*(c.interch-l.interch),l.msfix=l.msfix+s*(c.msfix-l.msfix),n(e,_.vbr_q),0!=a?e.quant_comp=_.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=_.quant_comp),0!=a?e.quant_comp_short=_.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=_.quant_comp_s),0!=_.expY&&(e.experimentalY=0!=_.expY),0!=a?e.internal_flags.nsPsy.attackthre=_.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=_.st_lrm),0!=a?e.internal_flags.nsPsy.attackthre_s=_.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=_.st_s),0!=a?e.maskingadjust=_.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=_.masking_adj),0!=a?e.maskingadjust_short=_.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=_.masking_adj_short),0!=a?e.ATHlower=-_.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-_.ath_lower/10),0!=a?e.ATHcurve=_.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=_.ath_curve),0!=a?e.athaa_sensitivity=_.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=_.ath_sensitivity),_.interch>0&&(0!=a?e.interChRatio=_.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=_.interch)),_.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|_.safejoint),_.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|_.sfb21mod<<20),0!=a?e.msfix=_.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=_.msfix),0==a&&(e.VBR_q=t,e.VBR_q_frac=s)}function r(e,t,a){var r=t,n=s.nearestBitrateFullIndex(t);if(e.VBR=Xt.vbr_abr,e.VBR_mean_bitrate_kbps=r,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),l[n].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),l[n].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(l[n].nsbass)>0){var i=int(4*l[n].nsbass);i<0&&(i+=64),e.exp_nspsytune=e.exp_nspsytune|i<<2}return 0!=a?e.quant_comp=l[n].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=l[n].quant_comp),0!=a?e.quant_comp_short=l[n].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=l[n].quant_comp_s),0!=a?e.msfix=l[n].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=l[n].nsmsfix),0!=a?e.internal_flags.nsPsy.attackthre=l[n].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=l[n].st_lrm),0!=a?e.internal_flags.nsPsy.attackthre_s=l[n].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=l[n].st_s),0!=a?e.scale=l[n].scale:Math.abs(e.scale- -1)>0||(e.scale=l[n].scale),0!=a?e.maskingadjust=l[n].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=l[n].masking_adj),l[n].masking_adj>0?0!=a?e.maskingadjust_short=.9*l[n].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*l[n].masking_adj):0!=a?e.maskingadjust_short=1.1*l[n].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*l[n].masking_adj),0!=a?e.ATHlower=-l[n].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-l[n].ath_lower/10),0!=a?e.ATHcurve=l[n].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=l[n].ath_curve),0!=a?e.interChRatio=l[n].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=l[n].interch),t}function n(e,t){var a=0;return 0>t&&(a=-1,t=0),9<t&&(a=-1,t=9),e.VBR_q=t,e.VBR_q_frac=0,a}var s;this.setModules=function(e){s=e};var i=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],o=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)],l=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];this.apply_preset=function(e,t,n){switch(t){case Lame.R3MIX:t=Lame.V3,e.VBR=Xt.vbr_mtrh;break;case Lame.MEDIUM:t=Lame.V4,e.VBR=Xt.vbr_rh;break;case Lame.MEDIUM_FAST:t=Lame.V4,e.VBR=Xt.vbr_mtrh;break;case Lame.STANDARD:t=Lame.V2,e.VBR=Xt.vbr_rh;break;case Lame.STANDARD_FAST:t=Lame.V2,e.VBR=Xt.vbr_mtrh;break;case Lame.EXTREME:t=Lame.V0,e.VBR=Xt.vbr_rh;break;case Lame.EXTREME_FAST:t=Lame.V0,e.VBR=Xt.vbr_mtrh;break;case Lame.INSANE:return t=320,e.preset=t,r(e,t,n),e.VBR=Xt.vbr_off,t}switch(e.preset=t,t){case Lame.V9:return a(e,9,n),t;case Lame.V8:return a(e,8,n),t;case Lame.V7:return a(e,7,n),t;case Lame.V6:return a(e,6,n),t;case Lame.V5:return a(e,5,n),t;case Lame.V4:return a(e,4,n),t;case Lame.V3:return a(e,3,n),t;case Lame.V2:return a(e,2,n),t;case Lame.V1:return a(e,1,n),t;case Lame.V0:return a(e,0,n),t}return 8<=t&&t<=320?r(e,t,n):(e.preset=0,t)}},GainAnalysis=rt,QuantizePVT=St,Quantize=function(){function e(e,t,a,r){r=0;for(var n=0;n<=a;++n){var s=Math.abs(e.xr[n]);r+=s,t[n]=Math.sqrt(s*Math.sqrt(s)),t[n]>e.xrpow_max&&(e.xrpow_max=t[n])}return r}function t(e,t){var a=e.ATH,r=t.xr;if(t.block_type!=de.SHORT_TYPE)for(var n=!1,s=de.PSFB21-1;s>=0&&!n;s--){var i=e.scalefac_band.psfb21[s],o=e.scalefac_band.psfb21[s+1],l=h.athAdjust(a.adjust,a.psfb21[s],a.floor);for(e.nsPsy.longfact[21]>1e-12&&(l*=e.nsPsy.longfact[21]),f=o-1;f>=i;f--){if(!(Math.abs(r[f])<l)){n=!0;break}r[f]=0}}else for(var c=0;c<3;c++)for(var n=!1,s=de.PSFB12-1;s>=0&&!n;s--){var o=(i=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*c+(e.scalefac_band.psfb12[s]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[s+1]-e.scalefac_band.psfb12[s]),_=h.athAdjust(a.adjust,a.psfb12[s],a.floor);e.nsPsy.shortfact[12]>1e-12&&(_*=e.nsPsy.shortfact[12]);for(var f=o-1;f>=i;f--){if(!(Math.abs(r[f])<_)){n=!0;break}r[f]=0}}}function a(e){this.ordinal=e}function r(e,t,r,n,s){var i,o=e.CurrentStep[n],l=!1,c=e.OldValue[n],_=a.BINSEARCH_NONE;for(t.global_gain=c,r-=t.part2_length,Jt(0!=o);;){var f;if(i=d.count_bits(e,s,t,null),1==o||i==r)break;i>r?(_==a.BINSEARCH_DOWN&&(l=!0),l&&(o/=2),_=a.BINSEARCH_UP,f=o):(_==a.BINSEARCH_UP&&(l=!0),l&&(o/=2),_=a.BINSEARCH_DOWN,f=-o),t.global_gain+=f,t.global_gain<0&&(t.global_gain=0,l=!0),t.global_gain>255&&(t.global_gain=255,l=!0)}for(Jt(t.global_gain>=0),Jt(t.global_gain<256);i>r&&t.global_gain<255;)t.global_gain++,i=d.count_bits(e,s,t,null);return e.CurrentStep[n]=c-t.global_gain>=4?4:2,e.OldValue[n]=t.global_gain,t.part2_3_length=i,i}function n(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function s(e){return Zt.FAST_LOG10(.368+.632*e*e*e)}function i(e,t){for(var a=1e-37,r=0;r<t.psymax;r++)a+=s(e[r]);return Math.max(1e-20,a)}function o(e,t,a,r,n){var s;switch(e){default:case 9:t.over_count>0?(s=a.over_SSD<=t.over_SSD,a.over_SSD==t.over_SSD&&(s=a.bits<t.bits)):s=a.max_noise<0&&10*a.max_noise+a.bits<=10*t.max_noise+t.bits;break;case 0:s=a.over_count<t.over_count||a.over_count==t.over_count&&a.over_noise<t.over_noise||a.over_count==t.over_count&&BitStream.EQ(a.over_noise,t.over_noise)&&a.tot_noise<t.tot_noise;break;case 8:a.max_noise=i(n,r);case 1:s=a.max_noise<t.max_noise;break;case 2:s=a.tot_noise<t.tot_noise;break;case 3:s=a.tot_noise<t.tot_noise&&a.max_noise<t.max_noise;break;case 4:s=a.max_noise<=0&&t.max_noise>.2||a.max_noise<=0&&t.max_noise<0&&t.max_noise>a.max_noise-.2&&a.tot_noise<t.tot_noise||a.max_noise<=0&&t.max_noise>0&&t.max_noise>a.max_noise-.2&&a.tot_noise<t.tot_noise+t.over_noise||a.max_noise>0&&t.max_noise>-.05&&t.max_noise>a.max_noise-.1&&a.tot_noise+a.over_noise<t.tot_noise+t.over_noise||a.max_noise>0&&t.max_noise>-.1&&t.max_noise>a.max_noise-.15&&a.tot_noise+a.over_noise+a.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:s=a.over_noise<t.over_noise||BitStream.EQ(a.over_noise,t.over_noise)&&a.tot_noise<t.tot_noise;break;case 6:s=a.over_noise<t.over_noise||BitStream.EQ(a.over_noise,t.over_noise)&&(a.max_noise<t.max_noise||BitStream.EQ(a.max_noise,t.max_noise)&&a.tot_noise<=t.tot_noise);break;case 7:s=a.over_count<t.over_count||a.over_noise<t.over_noise}return 0==t.over_count&&(s=s&&a.bits<t.bits),s}function l(e,t,a,r,n){var s,i=e.internal_flags;s=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var o=0,l=0;l<t.sfbmax;l++)o<a[l]&&(o=a[l]);var c=i.noise_shaping_amp;switch(3==c&&(c=n?2:1),c){case 2:break;case 1:o>1?o=Math.pow(o,.5):o*=.95;break;case 0:default:o>1?o=1:o*=.95}for(var _=0,l=0;l<t.sfbmax;l++){var f,u=t.width[l];if(_+=u,!(a[l]<o)){if(0!=(2&i.substep_shaping)&&(i.pseudohalf[l]=0==i.pseudohalf[l]?1:0,0==i.pseudohalf[l]&&2==i.noise_shaping_amp))return;for(t.scalefac[l]++,f=-u;f<0;f++)r[_+f]*=s,r[_+f]>t.xrpow_max&&(t.xrpow_max=r[_+f]);if(2==i.noise_shaping_amp)return}}}function c(e,t){for(var a=0,r=0;r<e.sfbmax;r++){var n=e.width[r],s=e.scalefac[r];if(0!=e.preflag&&(s+=h.pretab[r]),a+=n,0!=(1&s)){s++;for(var i=-n;i<0;i++)t[a+i]*=1.2968395546510096,t[a+i]>e.xrpow_max&&(e.xrpow_max=t[a+i])}e.scalefac[r]=s>>1}e.preflag=0,e.scalefac_scale=1}function _(e,t,a){var r,n=t.scalefac;for(r=0;r<t.sfb_lmax;r++)if(n[r]>=16)return!0;for(var s=0;s<3;s++){var i=0,o=0;for(r=t.sfb_lmax+s;r<t.sfbdivide;r+=3)i<n[r]&&(i=n[r]);for(;r<t.sfbmax;r+=3)o<n[r]&&(o=n[r]);if(!(i<16&&o<8)){if(t.subblock_gain[s]>=7)return!0;t.subblock_gain[s]++;var l=e.scalefac_band.l[t.sfb_lmax];for(r=t.sfb_lmax+s;r<t.sfbmax;r+=3){var c=t.width[r],_=n[r];if(Jt(_>=0),(_-=4>>t.scalefac_scale)>=0)n[r]=_,l+=3*c;else{n[r]=0;var f=210+(_<<t.scalefac_scale+1);for(u=h.IPOW20(f),l+=c*(s+1),p=-c;p<0;p++)a[l+p]*=u,a[l+p]>t.xrpow_max&&(t.xrpow_max=a[l+p]);l+=c*(3-s-1)}}var u=h.IPOW20(202);l+=t.width[r]*(s+1);for(var p=-t.width[r];p<0;p++)a[l+p]*=u,a[l+p]>t.xrpow_max&&(t.xrpow_max=a[l+p])}}return!1}function f(e,t,a,r,s){var i=e.internal_flags;l(e,t,a,r,s);var o=n(t);return!(o||(o=2==i.mode_gr?d.scale_bitcount(t):d.scale_bitcount_lsf(i,t))&&(i.noise_shaping>1&&(Qt.fill(i.pseudohalf,0),0==t.scalefac_scale?(c(t,r),o=!1):t.block_type==de.SHORT_TYPE&&i.subblock_gain>0&&(o=_(i,t,r)||n(t))),o||(o=2==i.mode_gr?d.scale_bitcount(t):d.scale_bitcount_lsf(i,t)),o))}var u;this.rv=null;var p;this.qupvt=null;var h,d,m=new Ft;this.setModules=function(e,t,a,r){u=e,p=t,this.rv=t,h=a,this.qupvt=a,d=r,m.setModules(h,d)},this.ms_convert=function(e,t){for(var a=0;a<576;++a){var r=e.tt[t][0].xr[a],n=e.tt[t][1].xr[a];e.tt[t][0].xr[a]=(r+n)*(.5*Zt.SQRT2),e.tt[t][1].xr[a]=(r-n)*(.5*Zt.SQRT2)}},this.init_xrpow=function(t,a,r){var n=0,s=0|a.max_nonzero_coeff;if(Jt(null!=r),a.xrpow_max=0,Jt(0<=s&&s<=575),Qt.fill(r,s,576,0),(n=e(a,r,s,n))>1e-20){var i=0;0!=(2&t.substep_shaping)&&(i=1);for(var o=0;o<a.psymax;o++)t.pseudohalf[o]=i;return!0}return Qt.fill(a.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,a){for(a.part2_3_length=0,a.big_values=0,a.count1=0,a.global_gain=210,a.scalefac_compress=0,a.table_select[0]=0,a.table_select[1]=0,a.table_select[2]=0,a.subblock_gain[0]=0,a.subblock_gain[1]=0,a.subblock_gain[2]=0,a.subblock_gain[3]=0,a.region0_count=0,a.region1_count=0,a.preflag=0,a.scalefac_scale=0,a.count1table_select=0,a.part2_length=0,a.sfb_lmax=de.SBPSY_l,a.sfb_smin=de.SBPSY_s,a.psy_lmax=e.sfb21_extra?de.SBMAX_l:de.SBPSY_l,a.psymax=a.psy_lmax,a.sfbmax=a.sfb_lmax,a.sfbdivide=11,_=0;_<de.SBMAX_l;_++)a.width[_]=e.scalefac_band.l[_+1]-e.scalefac_band.l[_],a.window[_]=3;if(a.block_type==de.SHORT_TYPE){var r=Wt(576);a.sfb_smin=0,a.sfb_lmax=0,0!=a.mixed_block_flag&&(a.sfb_smin=3,a.sfb_lmax=2*e.mode_gr+4),a.psymax=a.sfb_lmax+3*((e.sfb21_extra?de.SBMAX_s:de.SBPSY_s)-a.sfb_smin),a.sfbmax=a.sfb_lmax+3*(de.SBPSY_s-a.sfb_smin),a.sfbdivide=a.sfbmax-18,a.psy_lmax=a.sfb_lmax;var n=e.scalefac_band.l[a.sfb_lmax];for(zt.arraycopy(a.xr,0,r,0,576),_=a.sfb_smin;_<de.SBMAX_s;_++)for(var s=e.scalefac_band.s[_],i=e.scalefac_band.s[_+1],o=0;o<3;o++)for(var l=s;l<i;l++)a.xr[n++]=r[3*l+o];for(var c=a.sfb_lmax,_=a.sfb_smin;_<de.SBMAX_s;_++)a.width[c]=a.width[c+1]=a.width[c+2]=e.scalefac_band.s[_+1]-e.scalefac_band.s[_],a.window[c]=0,a.window[c+1]=1,a.window[c+2]=2,c+=3}a.count1bits=0,a.sfb_partition_table=h.nr_of_sfb_block[0][0],a.slen[0]=0,a.slen[1]=0,a.slen[2]=0,a.slen[3]=0,a.max_nonzero_coeff=575,Qt.fill(a.scalefac,0),t(e,a)},a.BINSEARCH_NONE=new a(0),a.BINSEARCH_UP=new a(1),a.BINSEARCH_DOWN=new a(2),this.trancate_smallspectrums=function(e,t,a,r){var n=Wt(Ce.SFBMAX);if((0!=(4&e.substep_shaping)||t.block_type!=de.SHORT_TYPE)&&0==(128&e.substep_shaping)){for(h.calc_noise(t,a,n,new Gt,null),i=0;i<576;i++){var s=0;0!=t.l3_enc[i]&&(s=Math.abs(t.xr[i])),r[i]=s}var i=0,o=8;t.block_type==de.SHORT_TYPE&&(o=6);do{var l,c,_,f,u=t.width[o];if(i+=u,!(n[o]>=1||(Qt.sort(r,i-u,u),BitStream.EQ(r[i-1],0)))){l=(1-n[o])*a[o],c=0,f=0;do{var p;for(_=1;f+_<u&&!BitStream.NEQ(r[f+i-u],r[f+i+_-u]);_++);if(p=r[f+i-u]*r[f+i-u]*_,l<p){0!=f&&(c=r[f+i-u-1]);break}l-=p,f+=_}while(f<u);if(!BitStream.EQ(c,0))do{Math.abs(t.xr[i-u])<=c&&(t.l3_enc[i-u]=0)}while(--u>0)}}while(++o<t.psymax);t.part2_3_length=d.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,t,a,n,s,i){var l,c=e.internal_flags,_=new Le,u=Wt(576),p=Wt(Ce.SFBMAX),m=new Gt,b=new Ut,v=9999999,g=!1,S=!1,R=0;if(r(c,t,i,s,n),0==c.noise_shaping)return 100;h.calc_noise(t,a,p,m,b),m.bits=t.part2_3_length,_.assign(t);var y=0;for(zt.arraycopy(n,0,u,0,576);!g;){do{var T,M=new Gt,w=255;if(T=0!=(2&c.substep_shaping)?20:3,c.sfb21_extra){if(p[_.sfbmax]>1)break;if(_.block_type==de.SHORT_TYPE&&(p[_.sfbmax+1]>1||p[_.sfbmax+2]>1))break}if(!f(e,_,p,n,S))break;0!=_.scalefac_scale&&(w=254);var E=i-_.part2_length;if(E<=0)break;for(;(_.part2_3_length=d.count_bits(c,n,_,b))>E&&_.global_gain<=w;)_.global_gain++;if(_.global_gain>w)break;if(0==m.over_count){for(;(_.part2_3_length=d.count_bits(c,n,_,b))>v&&_.global_gain<=w;)_.global_gain++;if(_.global_gain>w)break}if(h.calc_noise(_,a,p,M,b),M.bits=_.part2_3_length,l=t.block_type!=de.SHORT_TYPE?e.quant_comp:e.quant_comp_short,0!=(l=o(l,m,M,_,p)?1:0))v=t.part2_3_length,m=M,t.assign(_),y=0,zt.arraycopy(n,0,u,0,576);else if(0==c.full_outer_loop){if(++y>T&&0==m.over_count)break;if(3==c.noise_shaping_amp&&S&&y>30)break;if(3==c.noise_shaping_amp&&S&&_.global_gain-R>15)break}}while(_.global_gain+_.scalefac_scale<255);3==c.noise_shaping_amp?S?g=!0:(_.assign(t),zt.arraycopy(u,0,n,0,576),y=0,R=_.global_gain,S=!0):g=!0}return Jt(t.global_gain+t.scalefac_scale<=255),e.VBR==Kt.vbr_rh||e.VBR==Kt.vbr_mtrh?zt.arraycopy(u,0,n,0,576):0!=(1&c.substep_shaping)&&trancate_smallspectrums(c,t,a,n),m.over_count},this.iteration_finish_one=function(e,t,a){var r=e.l3_side,n=r.tt[t][a];d.best_scalefac_store(e,t,a,r),1==e.use_best_huffman&&d.best_huffman_divide(e,n),p.ResvAdjust(e,n)},this.VBR_encode_granule=function(e,t,a,r,n,s,i){var o,l=e.internal_flags,c=new Le,_=Wt(576),f=i,u=i+1,p=(i+s)/2,h=0,d=l.sfb21_extra;Jt(f<=LameInternalFlags.MAX_BITS_PER_CHANNEL),Qt.fill(c.l3_enc,0);do{Jt(p>=s),Jt(p<=i),Jt(s<=i),l.sfb21_extra=!(p>f-42)&&d,outer_loop(e,t,a,r,n,p)<=0?(h=1,u=t.part2_3_length,c.assign(t),zt.arraycopy(r,0,_,0,576),o=(i=u-32)-s,p=(i+s)/2):(o=i-(s=p+32),p=(i+s)/2,0!=h&&(h=2,t.assign(c),zt.arraycopy(_,0,r,0,576)))}while(o>12);l.sfb21_extra=d,2==h&&zt.arraycopy(c.l3_enc,0,t.l3_enc,0,576),Jt(t.part2_3_length<=f)},this.get_framebits=function(e,t){var a=e.internal_flags;a.bitrate_index=a.VBR_min_bitrate;var r=u.getframebits(e);a.bitrate_index=1,r=u.getframebits(e);for(var n=1;n<=a.VBR_max_bitrate;n++){a.bitrate_index=n;var s=new MeanBits(r);t[n]=p.ResvFrameBegin(e,s),r=s.bits}},this.VBR_old_prepare=function(e,t,a,r,n,s,i,o,l){var c,_=e.internal_flags,f=0,u=1,d=0;_.bitrate_index=_.VBR_max_bitrate;var m=p.ResvFrameBegin(e,new MeanBits(0))/_.mode_gr;for(get_framebits(e,s),g=0;g<_.mode_gr;g++){var b=h.on_pe(e,t,o[g],m,g,0);for(_.mode_ext==de.MPG_MD_MS_LR&&(ms_convert(_.l3_side,g),h.reduce_side(o[g],a[g],m,b)),S=0;S<_.channels_out;++S){var v=_.l3_side.tt[g][S];v.block_type!=de.SHORT_TYPE?(f=1.28/(1+Math.exp(3.5-t[g][S]/300))-.05,c=_.PSY.mask_adjust-f):(f=2.56/(1+Math.exp(3.5-t[g][S]/300))-.14,c=_.PSY.mask_adjust_short-f),_.masking_lower=Math.pow(10,.1*c),init_outer_loop(_,v),l[g][S]=h.calc_xmin(e,r[g][S],v,n[g][S]),0!=l[g][S]&&(u=0),i[g][S]=126,d+=o[g][S]}}for(var g=0;g<_.mode_gr;g++)for(var S=0;S<_.channels_out;S++)d>s[_.VBR_max_bitrate]&&(o[g][S]*=s[_.VBR_max_bitrate],o[g][S]/=d),i[g][S]>o[g][S]&&(i[g][S]=o[g][S]);return u},this.bitpressure_strategy=function(e,t,a,r){for(var n=0;n<e.mode_gr;n++)for(var s=0;s<e.channels_out;s++){for(var i=e.l3_side.tt[n][s],o=t[n][s],l=0,c=0;c<i.psy_lmax;c++)o[l++]*=1+.029*c*c/de.SBMAX_l/de.SBMAX_l;if(i.block_type==de.SHORT_TYPE)for(c=i.sfb_smin;c<de.SBMAX_s;c++)o[l++]*=1+.029*c*c/de.SBMAX_s/de.SBMAX_s,o[l++]*=1+.029*c*c/de.SBMAX_s/de.SBMAX_s,o[l++]*=1+.029*c*c/de.SBMAX_s/de.SBMAX_s;r[n][s]=0|Math.max(a[n][s],.9*r[n][s])}},this.VBR_new_prepare=function(e,t,a,r,n,s){var i,o=e.internal_flags,l=1,c=0,_=0;if(e.free_format)o.bitrate_index=0,f=new MeanBits(c),i=p.ResvFrameBegin(e,f),c=f.bits,n[0]=i;else{o.bitrate_index=o.VBR_max_bitrate;var f=new MeanBits(c);p.ResvFrameBegin(e,f),c=f.bits,get_framebits(e,n),i=n[o.VBR_max_bitrate]}for(d=0;d<o.mode_gr;d++)for(h.on_pe(e,t,s[d],c,d,0),o.mode_ext==de.MPG_MD_MS_LR&&ms_convert(o.l3_side,d),m=0;m<o.channels_out;++m){var u=o.l3_side.tt[d][m];o.masking_lower=Math.pow(10,.1*o.PSY.mask_adjust),init_outer_loop(o,u),0!=h.calc_xmin(e,a[d][m],u,r[d][m])&&(l=0),_+=s[d][m]}for(var d=0;d<o.mode_gr;d++)for(var m=0;m<o.channels_out;m++)_>i&&(s[d][m]*=i,s[d][m]/=_);return l},this.calc_target_bits=function(e,t,a,r,n,s){var i,o,l,c,_=e.internal_flags,f=_.l3_side,d=0;_.bitrate_index=_.VBR_max_bitrate;var m=new MeanBits(d);for(s[0]=p.ResvFrameBegin(e,m),d=m.bits,_.bitrate_index=1,d=u.getframebits(e)-8*_.sideinfo_len,n[0]=d/(_.mode_gr*_.channels_out),d=e.VBR_mean_bitrate_kbps*e.framesize*1e3,0!=(1&_.substep_shaping)&&(d*=1.09),d/=e.out_samplerate,d-=8*_.sideinfo_len,d/=_.mode_gr*_.channels_out,(i=.93+.07*(11-e.compression_ratio)/5.5)<.9&&(i=.9),i>1&&(i=1),o=0;o<_.mode_gr;o++){var b=0;for(l=0;l<_.channels_out;l++){if(r[o][l]=int(i*d),t[o][l]>700){var v=int((t[o][l]-700)/1.4),g=f.tt[o][l];r[o][l]=int(i*d),g.block_type==de.SHORT_TYPE&&v<d/2&&(v=d/2),v>3*d/2?v=3*d/2:v<0&&(v=0),r[o][l]+=v}r[o][l]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(r[o][l]=LameInternalFlags.MAX_BITS_PER_CHANNEL),b+=r[o][l]}if(b>LameInternalFlags.MAX_BITS_PER_GRANULE)for(l=0;l<_.channels_out;++l)r[o][l]*=LameInternalFlags.MAX_BITS_PER_GRANULE,r[o][l]/=b}if(_.mode_ext==de.MPG_MD_MS_LR)for(o=0;o<_.mode_gr;o++)h.reduce_side(r[o],a[o],d*_.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(c=0,o=0;o<_.mode_gr;o++)for(l=0;l<_.channels_out;l++)r[o][l]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(r[o][l]=LameInternalFlags.MAX_BITS_PER_CHANNEL),c+=r[o][l];if(c>s[0])for(o=0;o<_.mode_gr;o++)for(l=0;l<_.channels_out;l++)r[o][l]*=s[0],r[o][l]/=c}},Takehiro=wt,Reservoir=function(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,a){var r,n=t.internal_flags,s=n.l3_side,i=e.getframebits(t);a.bits=(i-8*n.sideinfo_len)/n.mode_gr;var o=2048*n.mode_gr-8;t.brate>320?r=8*int(1e3*t.brate/(t.out_samplerate/1152)/8+.5):(r=11520,t.strict_ISO&&(r=8*int(32e4/(t.out_samplerate/1152)/8+.5))),n.ResvMax=r-i,n.ResvMax>o&&(n.ResvMax=o),(n.ResvMax<0||t.disable_reservoir)&&(n.ResvMax=0);var l=a.bits*n.mode_gr+Math.min(n.ResvSize,n.ResvMax);return l>r&&(l=r),$t(0==n.ResvMax%8),$t(n.ResvMax>=0),s.resvDrain_pre=0,null!=n.pinfo&&(n.pinfo.mean_bits=a.bits/2,n.pinfo.resvsize=n.ResvSize),l},this.ResvMaxBits=function(e,t,a,r){var n,s=e.internal_flags,i=s.ResvSize,o=s.ResvMax;0!=r&&(i+=t),0!=(1&s.substep_shaping)&&(o*=.9),a.bits=t,10*i>9*o?(n=i-9*o/10,a.bits+=n,s.substep_shaping|=128):(n=0,s.substep_shaping&=127,e.disable_reservoir||0!=(1&s.substep_shaping)||(a.bits-=.1*t));var l=i<6*s.ResvMax/10?i:6*s.ResvMax/10;return(l-=n)<0&&(l=0),l},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var a,r=e.l3_side;e.ResvSize+=t*e.mode_gr;var n=0;r.resvDrain_post=0,r.resvDrain_pre=0,0!=(a=e.ResvSize%8)&&(n+=a),(a=e.ResvSize-n-e.ResvMax)>0&&($t(0==a%8),$t(a>=0),n+=a);var s=Math.min(8*r.main_data_begin,n)/8;r.resvDrain_pre+=8*s,n-=8*s,e.ResvSize-=8*s,r.main_data_begin-=s,r.resvDrain_post+=n,e.ResvSize-=n}},MPEGMode=Be,BitStream=Ct,A.RIFF=k("RIFF"),A.WAVE=k("WAVE"),A.fmt_=k("fmt "),A.data=k("data"),A.readHeader=function(e){var t=new A,a=e.getUint32(0,!1);if(A.RIFF==a){e.getUint32(4,!0);if(A.WAVE==e.getUint32(8,!1)&&A.fmt_==e.getUint32(12,!1)){var r=e.getUint32(16,!0),n=20;switch(r){case 16:case 18:t.channels=e.getUint16(n+2,!0),t.sampleRate=e.getUint32(n+4,!0);break;default:throw"extended fmt chunk not implemented"}n+=r;for(var s=A.data,i=0;s!=a&&(a=e.getUint32(n,!1),i=e.getUint32(n+4,!0),s!=a);)n+=i+8;return t.dataLen=i,t.dataOffset=n+8,t}}};var _a=function(e,t,a){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,a=128);var r=new Lame,n=new T,s=new GainAnalysis,i=new BitStream,o=new Presets,l=new QuantizePVT,c=new Quantize,_=new oa,f=new ea,u=new E,p=new Reservoir,h=new Takehiro,d=new M,m=new w;r.setModules(s,i,o,l,c,_,f,u,m),i.setModules(s,m,f,_),u.setModules(i,f),o.setModules(r),c.setModules(i,p,l,h),l.setModules(h,p,r.enc.psy),p.setModules(i),h.setModules(l),_.setModules(r,i,f),n.setModules(d,m),d.setModules(f,u,o);var b=r.lame_init();b.num_channels=e,b.in_samplerate=t,b.brate=a,b.mode=MPEGMode.STEREO,b.quality=3,b.bWriteVbrTag=!1,b.disable_reservoir=!0,b.write_id3tag_automatic=!1;var v=r.lame_init_params(b);ca(0==v);var g=1152,S=0|1.25*g+7200,R=la(S);this.encodeBuffer=function(t,a){1==e&&(a=t),ca(t.length==a.length),t.length>g&&(g=t.length,R=la(S=0|1.25*g+7200));var n=r.lame_encode_buffer(b,t,a,t.length,R,0,S);return new Int8Array(R.subarray(0,n))},this.flush=function(){var e=r.lame_encode_flush(b,R,0,S);return new Int8Array(R.subarray(0,e))}},fa=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ua=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),pa=function(){function e(t){fa(this,e),this.config={sampleRate:44100,bitRate:128},Object.assign(this.config,t),this.mp3Encoder=new _a(1,this.config.sampleRate,this.config.bitRate),this.maxSamples=1152,this.samplesMono=null,this.clearBuffer()}return ua(e,[{key:"clearBuffer",value:function(){this.dataBuffer=[]}},{key:"appendToBuffer",value:function(e){this.dataBuffer.push(new Int8Array(e))}},{key:"floatTo16BitPCM",value:function(e,t){for(var a=0;a<e.length;a++){var r=Math.max(-1,Math.min(1,e[a]));t[a]=r<0?32768*r:32767*r}}},{key:"convertBuffer",value:function(e){var t=new Float32Array(e),a=new Int16Array(e.length);return this.floatTo16BitPCM(t,a),a}},{key:"encode",value:function(e){this.samplesMono=this.convertBuffer(e);for(var t=this.samplesMono.length,a=0;t>=0;a+=this.maxSamples){var r=this.samplesMono.subarray(a,a+this.maxSamples),n=this.mp3Encoder.encodeBuffer(r);this.appendToBuffer(n),t-=this.maxSamples}}},{key:"finish",value:function(){return this.appendToBuffer(this.mp3Encoder.flush()),this.dataBuffer}}]),e}();return function(){function e(t){fa(this,e),this.config={bitRate:128,startRecordingAt:300},this.activeStream=null,this.context=null,this.microphone=null,this.processor=null,this.startTime=0,Object.assign(this.config,t)}return ua(e,[{key:"addMicrophoneListener",value:function(e){var t=this;this.activeStream=e,this.timerToStart=setTimeout(function(){delete t.timerToStart},this.config.startRecordingAt),this.microphone=this.context.createMediaStreamSource(e),this.processor=this.context.createScriptProcessor(0,1,1),this.processor.onaudioprocess=function(e){t.timerToStart||t.lameEncoder.encode(e.inputBuffer.getChannelData(0))},this.microphone.connect(this.processor),this.processor.connect(this.context.destination)}},{key:"stop",value:function(){return this.processor&&this.microphone&&(this.microphone.disconnect(),this.processor.disconnect(),this.context.close(),this.processor.onaudioprocess=null,this.activeStream.getAudioTracks().forEach(function(e){return e.stop()})),this}},{key:"start",value:function(){var e=this;return this.context=new AudioContext,this.config.sampleRate=this.context.sampleRate,this.lameEncoder=new pa(this.config),new Promise(function(t,a){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(a){e.addMicrophoneListener(a),t(a)}).catch(function(e){a(e)})})}},{key:"getMp3",value:function(){var e=this,t=this.lameEncoder.finish();return new Promise(function(a,r){0===t.length?r(new Error("No buffer to send")):(a([t,new Blob(t,{type:"audio/mp3"})]),e.lameEncoder.clearBuffer())})}}]),e}()});
//# sourceMappingURL=index.min.js.map
